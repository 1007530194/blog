<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <title>spark-en汇总</title>
  <meta name="description" content="RDD creationIn this notebook we will introduce two different ways of getting data into the basic Spark data structure, the Resilient Distributed Dataset or R...">

  <link rel="canonical" href="https://1007530194.github.io/blog2/11ReadBook/12spark-en%E6%B1%87%E6%80%BB.html">
  <link rel="alternate" type="application/rss+xml" title="MyBook" href="https://1007530194.github.io/blog2/feed.xml">

  <meta property="og:url"         content="https://1007530194.github.io/blog2/11ReadBook/12spark-en%E6%B1%87%E6%80%BB.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="spark-en汇总" />
<meta property="og:description" content="RDD creationIn this notebook we will introduce two different ways of getting data into the basic Spark data structure, the Resilient Distributed Dataset or R..." />
<meta property="og:image"       content="" />


  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage":
    "https://1007530194.github.io/blog2/11ReadBook/12spark-en%E6%B1%87%E6%80%BB.html",
  "headline":
    "spark-en汇总",
  "datePublished":
    "2019-06-13T15:02:54+08:00",
  "dateModified":
    "2019-06-13T15:02:54+08:00",
  "description":
    "RDD creationIn this notebook we will introduce two different ways of getting data into the basic Spark data structure, the Resilient Distributed Dataset or R...",
  "author": {
    "@type": "Person",
    "name": "niult"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Data 100 at UC Berkeley",
    "logo": {
      "@type": "ImageObject",
      "url": "https://1007530194.github.io/blog2",
      "width": 60,
      "height": 60
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "https://1007530194.github.io/blog2",
    "height": 60,
    "width": 60
  }
}

  </script>
  <link rel="stylesheet" href="/blog2/assets/css/styles.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css ">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">

  <!-- <link rel="manifest" href="/manifest.json"> -->
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#efae0a"> -->
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#233947">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/blog2/assets/images/logo/favicon.ico">

  <!-- MathJax Config -->
  <!-- Allow inline math using $ and automatically break long math lines -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    CommonHTML: {
        linebreaks: {
            automatic: true,
        },
    },
});
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_CHTML' async></script>

  <!-- DOM updating function -->
  <script>
const runWhenDOMLoaded = cb => {
  if (document.readyState != 'loading') {
    cb()
  } else if (document.addEventListener) {
    document.addEventListener('DOMContentLoaded', cb)
  } else {
    document.attachEvent('onreadystatechange', function() {
      if (document.readyState == 'complete') cb()
    })
  }
}

// Helper function to init things quickly
initFunction = function(myfunc) {
  runWhenDOMLoaded(myfunc);
  document.addEventListener('turbolinks:load', myfunc);
};
</script>

  <!-- Define some javascript variables that will be useful in other javascript -->
  <script>
    const site_basename = '/blog2';
  </script>

  <!-- Add AnchorJS to let headers be linked -->
  <script src="/blog2/assets/js/anchor.min.js"  type="text/javascript"></script>
  <script>

initFunction(function () {
    anchors.add("main h1, main h2, main h3, main h4")
});

</script>

  <!-- Include Turbolinks to make page loads fast -->
  <!-- https://github.com/turbolinks/turbolinks -->
  <script src="/blog2/assets/js/turbolinks.js" async></script>
  <meta name="turbolinks-cache-control" content="no-cache">

  <!-- Load nbinteract for widgets -->
  

  <!-- Load Thebelab for interactive widgets -->
  <!-- Include Thebelab for interactive code if it's enabled -->


<!-- Display Thebelab button in each code cell -->
<script>
    /**
     * Set up thebelab button for code blocks
     */

    const thebelabCellButton = id =
    >
    `<a id="thebelab-cell-button-${id}" class="btn thebebtn o-tooltip--left" data-tooltip="Interactive Mode">
    <img src="https://raw.githubusercontent.com/1007530194/images/master/picgo/blog/logo/edit-button.svg" alt="Start interactive mode">
  </a>`


    const addThebelabButtonToCodeCells = () =
    >
    {

        const codeCells = document.querySelectorAll('div.input_area > div.highlighter-rouge:not(.output) pre')
        codeCells.forEach((codeCell, index) = > {
            const id = codeCellId(index)
            codeCell.setAttribute('id', id)
        if (document.getElementById("thebelab-cell-button-" + id) == null) {
            codeCell.insertAdjacentHTML('afterend', thebelabCellButton(id));
        }
    })
    }

    initFunction(addThebelabButtonToCodeCells);
</script>



<script type="text/x-thebe-config">
    {
      requestKernel: true,
      binderOptions: {
        repo: 'jupyter/jupyter-book',
        ref: 'gh-pages',
      },
      codeMirrorConfig: {
        theme: "abcdef"
      },
      kernelOptions: {
        name: 'python3',
      }
    }
</script>
<script src="https://unpkg.com/thebelab@0.4.0/lib/index.js"></script>
<script>
    /**
     * Add attributes to Thebelab blocks
     */

    const initThebelab = () => {
        const addThebelabToCodeCells = () => {
            console.log("Adding thebelab to code cells...");
            // If Thebelab hasn't loaded, wait a bit and try again. This
            // happens because we load ClipboardJS asynchronously.
            if (window.thebelab === undefined) {
                setTimeout(addThebelabToCodeCells, 250)
            return
            }

            // If we already detect a Thebelab cell, don't re-run
            if (document.querySelectorAll('div.thebelab-cell').length > 0) {
                return;
            }

            // Find all code cells, replace with Thebelab interactive code cells
            const codeCells = document.querySelectorAll('.input_area pre')
            codeCells.forEach((codeCell, index) => {
                const id = codeCellId(index)
                codeCell.setAttribute('data-executable', 'true')

                // Figure out the language it uses and add this too
                var parentDiv = codeCell.parentElement.parentElement;
                var arrayLength = parentDiv.classList.length;
                for (var ii = 0; ii < arrayLength; ii++) {
                    var parts = parentDiv.classList[ii].split('language-');
                    if (parts.length === 2) {
                        // If found, assign dataLanguage and break the loop
                        var dataLanguage = parts[1];
                        break;
                    }
                }
                codeCell.setAttribute('data-language', dataLanguage)

                // If the code cell is hidden, show it
                var inputCheckbox = document.querySelector(`input#hidebtn${codeCell.id}`);
                if (inputCheckbox !== null) {
                    setCodeCellVisibility(inputCheckbox, 'visible');
                }
            });

            // Remove the event listener from the page so keyboard press doesn't
            // Change page
            document.removeEventListener('keydown', initPageNav)
            keyboardListener = false;

            // Init thebelab
            thebelab.bootstrap();

            // Remove copy buttons since they won't work anymore
            const copyAndThebeButtons = document.querySelectorAll('.copybtn, .thebebtn')
            copyAndThebeButtons.forEach((button, index) => {
                button.remove();
            });

            // Remove outputs since they'll be stale
            const outputs = document.querySelectorAll('.output *, .output')
            outputs.forEach((output, index) => {
                output.remove();
            });
        }

        // Add event listener for the function to modify code cells
        const thebelabButtons = document.querySelectorAll('[id^=thebelab], [id$=thebelab]')
        thebelabButtons.forEach((thebelabButton,index) => {
            if (thebelabButton === null) {
                setTimeout(initThebelab, 250)
                return
            };
            thebelabButton.addEventListener('click', addThebelabToCodeCells);
        });
    }

    // Initialize Thebelab
    initFunction(initThebelab);
</script>



  <!-- Load the auto-generating TOC -->
  <script src="/blog2/assets/js/tocbot.min.js"  type="text/javascript"></script>
  <script>
var initToc = function () {
  tocbot.init({
    tocSelector: 'nav.onthispage',
    contentSelector: '.c-textbook__content',
    headingSelector: 'h2, h3',
    orderedList: false,
    collapseDepth: 6,
    listClass: 'toc__menu',
    activeListItemClass: "",  // Not using
    activeLinkClass: "", // Not using
  });
  tocbot.refresh();
}
initFunction(initToc);
</script>

  <!-- Google analytics -->
  <script src="/blog2/assets/js/ga.js" async></script>

  <!-- Clipboard copy button -->
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" async></script>

  <!-- Load JS that depends on site variables -->
  <script>
/**
 * Set up copy/paste for code blocks
 */
const codeCellId = index => `codecell${index}`

const clipboardButton = id =>
  `<a id="copy-button-${id}" class="btn copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#${id}">
    <img src="/blog2/assets/images/copy-button.svg" alt="Copy to clipboard">
  </a>`

// Clears selected text since ClipboardJS will select the text when copying
const clearSelection = () => {
  if (window.getSelection) {
    window.getSelection().removeAllRanges()
  } else if (document.selection) {
    document.selection.empty()
  }
}

// Changes tooltip text for two seconds, then changes it back
const temporarilyChangeTooltip = (el, newText) => {
  const oldText = el.getAttribute('data-tooltip')
  el.setAttribute('data-tooltip', newText)
  setTimeout(() => el.setAttribute('data-tooltip', oldText), 2000)
}

const addCopyButtonToCodeCells = () => {
  // If ClipboardJS hasn't loaded, wait a bit and try again. This
  // happens because we load ClipboardJS asynchronously.
  if (window.ClipboardJS === undefined) {
    setTimeout(addCopyButtonToCodeCells, 250)
    return
  }

  const codeCells = document.querySelectorAll('div.c-textbook__content > div.highlighter-rouge > div.highlight > pre, div.input_area pre')
  codeCells.forEach((codeCell, index) => {
    const id = codeCellId(index)
    codeCell.setAttribute('id', id)
    if (document.getElementById("copy-button" + id) == null) {
      codeCell.insertAdjacentHTML('afterend', clipboardButton(id));
    }
  })

  const clipboard = new ClipboardJS('.copybtn')
  clipboard.on('success', event => {
    clearSelection()
    temporarilyChangeTooltip(event.trigger, 'Copied!')
  })

  clipboard.on('error', event => {
    temporarilyChangeTooltip(event.trigger, 'Failed to copy')
  })

  // Get rid of clipboard before the next page visit to avoid memory leak
  document.addEventListener('turbolinks:before-visit', () =>
    clipboard.destroy()
  )
}

initFunction(addCopyButtonToCodeCells);
</script>


  <!-- Hide cell code -->
  
<script>
/**
Add buttons to hide code cells
*/


var setCodeCellVisibility = function(inputField, kind) {
    // Update the image and class for hidden
    var id = inputField.getAttribute('data-id');
    var codeCell = document.querySelector(`#${id} div.highlight`);

    if (kind === "visible") {
        codeCell.classList.remove('hidden');
        inputField.checked = true;
    } else {
        codeCell.classList.add('hidden');
        inputField.checked = false;
    }
}

var toggleCodeCellVisibility = function (event) {
    // The label is clicked, and now we decide what to do based on the input field's clicked status
    if (event.target.tagName === "LABEL") {
        var inputField = event.target.previousElementSibling;
    } else {
        // It is the span inside the target
        var inputField = event.target.parentElement.previousElementSibling;
    }

    if (inputField.checked === true) {
        setCodeCellVisibility(inputField, "visible");
    } else {
        setCodeCellVisibility(inputField, "hidden");
    }
}


// Button constructor
const hideCodeButton = id => `<input class="hidebtn" type="checkbox" id="hidebtn${id}" data-id="${id}"><label title="Toggle cell" for="hidebtn${id}" class="plusminus"><span class="pm_h"></span><span class="pm_v"></span></label>`

var addHideButton = function () {
  // If a hide button is already added, don't add another
  if (document.querySelector('div.hidecode input') !== null) {
      return;
  }

  // Find the input cells and add a hide button
  document.querySelectorAll('div.input_area').forEach(function (item, index) {
    if (!item.classList.contains("hidecode")) {
        // Skip the cell if it doesn't have a hidecode class
        return;
    }

    const id = codeCellId(index)
    item.setAttribute('id', id);
    // Insert the button just inside the end of the next div
    item.querySelector('div').insertAdjacentHTML('beforeend', hideCodeButton(id))

    // Set up the visibility toggle
    hideLink = document.querySelector(`#${id} div.highlight + input + label`);
    hideLink.addEventListener('click', toggleCodeCellVisibility)
  });
}


// Initialize the hide buttos
var initHiddenCells = function () {
    // Add hide buttons to the cells
    addHideButton();

    // Toggle the code cells that should be hidden
    document.querySelectorAll('div.hidecode input').forEach(function (item) {
        setCodeCellVisibility(item, 'hidden');
        item.checked = true;
    })
}

initFunction(initHiddenCells);

</script>


  <!-- Load custom website scripts -->
  <script src="/blog2/assets/js/scripts.js" async></script>

  <!-- Load custom user CSS and JS  -->
  <script src="/blog2/assets/custom/custom.js" async></script>
  <link rel="stylesheet" href="/blog2/assets/custom/custom.css">

  <!-- Update interact links w/ REST param, is defined in includes so we can use templates -->
  
<script>
/**
  * To auto-embed hub URLs in interact links if given in a RESTful fashion
 */

function getJsonFromUrl(url) {
  var query = url.split('?');
  if (query.length < 2) {
    // No queries so just return false
    return false;
  }
  query = query[1];
  // Collect REST params into a dictionary
  var result = {};
  query.split("&").forEach(function(part) {
    var item = part.split("=");
    result[item[0]] = decodeURIComponent(item[1]);
  });
  return result;
}
    
function dict2param(dict) {
    params = Object.keys(dict).map(function(k) {
        return encodeURIComponent(k) + '=' + encodeURIComponent(dict[k])
    });
    return params.join('&')
}

// Parse a Binder URL, converting it to the string needed for JupyterHub
function binder2Jupyterhub(url) {
  newUrl = {};
  parts = url.split('v2/gh/')[1];
  // Grab the base repo information
  repoinfo = parts.split('?')[0];
  var [org, repo, ref] = repoinfo.split('/');
  newUrl['repo'] = ['https://github.com', org, repo].join('/');
  newUrl['branch'] = ref
  // Grab extra parameters passed
  params = getJsonFromUrl(url);
  if (params['filepath'] !== undefined) {
    newUrl['subPath'] = params['filepath']
  }
  return dict2param(newUrl);
}

// Filter out potentially unsafe characters to prevent xss
function safeUrl(url)
{
   return String(encodeURIComponent(url))
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
}

function addParamToInternalLinks(hub) {
  var links = document.querySelectorAll("a").forEach(function(link) {
    var href = link.href;
    // If the link is an internal link...
    if (href.search("https://1007530194.github.io") !== -1 || href.startsWith('/') || href.search("127.0.0.1:") !== -1) {
      // Assume we're an internal link, add the hub param to it
      var params = getJsonFromUrl(href);
      if (params !== false) {
        // We have REST params, so append a new one
        params['jupyterhub'] = hub;
      } else {
        // Create the REST params
        params = {'jupyterhub': hub};
      }
      // Update the link
      var newHref = href.split('?')[0] + '?' + dict2param(params);
      link.setAttribute('href', decodeURIComponent(newHref));
    }
  });
  return false;
}


// Update interact links
function updateInteractLink() {
    // hack to make this work since it expects a ? in the URL
    rest = getJsonFromUrl("?" + location.search.substr(1));
    jupyterHubUrl = rest['jupyterhub'];
    var hubType = null;
    var hubUrl = null;
    if (jupyterHubUrl !== undefined) {
      hubType = 'jupyterhub';
      hubUrl = jupyterHubUrl;
    }

    if (hubType !== null) {
      // Sanitize the hubUrl
      hubUrl = safeUrl(hubUrl);

      // Add HTTP text if omitted
      if (hubUrl.indexOf('http') < 0) {hubUrl = 'http://' + hubUrl;}
      var interactButtons = document.querySelectorAll("button.interact-button")
      var lastButton = interactButtons[interactButtons.length-1];
      var link = lastButton.parentElement;

      // If we've already run this, skip the link updating
      if (link.nextElementSibling !== null) {
        return;
      }

      // Update the link and add context div
      var href = link.getAttribute('href');
      if (lastButton.id === 'interact-button-binder') {
        // If binder links exist, we need to re-work them for jupyterhub
        if (hubUrl.indexOf('http%3A%2F%2Flocalhost') > -1) {
          // If localhost, assume we're working from a local Jupyter server and remove `/hub`
          first = [hubUrl, 'git-sync'].join('/')
        } else {
          first = [hubUrl, 'hub', 'user-redirect', 'git-sync'].join('/')
        }
        href = first + '?' + binder2Jupyterhub(href);
      } else {
        // If interact button isn't binderhub, assume it's jupyterhub
        // If JupyterHub links, we only need to replace the hub url
        href = href.replace("", hubUrl);
        if (hubUrl.indexOf('http%3A%2F%2Flocalhost') > -1) {
          // Assume we're working from a local Jupyter server and remove `/hub`
          href = href.replace("/hub/user-redirect", "");
        }
      }
      link.setAttribute('href', decodeURIComponent(href));

      // Add text after interact link saying where we're launching
      hubUrlNoHttp = decodeURIComponent(hubUrl).replace('http://', '').replace('https://', '');
      link.insertAdjacentHTML('afterend', '<div class="interact-context">on ' + hubUrlNoHttp + '</div>');

      // Update internal links so we retain the hub url
      addParamToInternalLinks(hubUrl);
    }
}

runWhenDOMLoaded(updateInteractLink)
document.addEventListener('turbolinks:load', updateInteractLink)
</script>


  <!-- Lunr search code - will only be executed on the /search page -->
  <script src="/blog2/assets/js/lunr/lunr.min.js" type="text/javascript"></script>
  <script>var initQuery = function() {
  // See if we have a search box
  var searchInput = document.querySelector('input#lunr_search');
  if (searchInput === null) {
    return;
  }

  // Function to parse our lunr cache
  var idx = lunr(function () {
    this.field('title')
    this.field('excerpt')
    this.field('categories')
    this.field('tags')
    this.ref('id')

    this.pipeline.remove(lunr.trimmer)

    for (var item in store) {
      this.add({
        title: store[item].title,
        excerpt: store[item].excerpt,
        categories: store[item].categories,
        tags: store[item].tags,
        id: item
      })
    }
  });

  // Run search upon keyup
  searchInput.addEventListener('keyup', function () {
    var resultdiv = document.querySelector('#results');
    var query = document.querySelector("input#lunr_search").value.toLowerCase();
    var result =
      idx.query(function (q) {
        query.split(lunr.tokenizer.separator).forEach(function (term) {
          q.term(term, { boost: 100 })
          if(query.lastIndexOf(" ") != query.length-1){
            q.term(term, {  usePipeline: false, wildcard: lunr.Query.wildcard.TRAILING, boost: 10 })
          }
          if (term != ""){
            q.term(term, {  usePipeline: false, editDistance: 1, boost: 1 })
          }
        })
      });

      // Empty the results div
      while (resultdiv.firstChild) {
        resultdiv.removeChild(resultdiv.firstChild);
      }

    resultdiv.insertAdjacentHTML('afterbegin', '<p class="results__found">'+result.length+' Result(s) found</p>');
    for (var item in result) {
      var ref = result[item].ref;
      if(store[ref].teaser){
        var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<div class="archive__item-teaser">'+
                '<img src="'+store[ref].teaser+'" alt="">'+
              '</div>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      else{
    	  var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      resultdiv.insertAdjacentHTML('beforeend', searchitem);
    }
  });
};

initFunction(initQuery);
</script>
</head>

<body>
<!-- .js-show-sidebar shows sidebar by default -->
<div id="js-textbook" class="c-textbook js-show-sidebar">
    



<nav id="js-sidebar" class="c-textbook__sidebar">
  <a href="https://jupyter.org/jupyter-book/intro.html"><img src="/blog2/assets/images/logo/logo.png" class="textbook_logo" id="sidebar-logo" data-turbolinks-permanent/></a>
  <h2 class="c-sidebar__title">MyBook</h2>
  <ul class="c-sidebar__chapters">
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/blog2/00Todo/index.html"
        >
          
            1.
          
          Todo
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/00Todo/00Todo.html"
                >
                  
                    1.1
                  
                  Todo
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/00Todo/Example.html"
                >
                  
                    1.2
                  
                  Example
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/00Todo/jupyter-book-start.html"
                >
                  
                    1.3
                  
                  jupyter-book-start
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/blog2/01TensorFlow/index.html"
        >
          
            2.
          
          TensorFlow
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/01TensorFlow/DNN%E5%AE%9E%E4%BE%8B%E4%BB%A3%E7%A0%81%E5%9D%97.html"
                >
                  
                    2.1
                  
                  DNN实例代码块
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/01TensorFlow/DSSM%E5%8F%8C%E5%A1%94%E6%A8%A1%E5%9E%8B.html"
                >
                  
                    2.2
                  
                  DSSM双塔模型
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/01TensorFlow/keras-RNN%E5%AE%9E%E4%BE%8B.html"
                >
                  
                    2.3
                  
                  keras-RNN实例
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/01TensorFlow/KerasExample/index.html"
                >
                  
                    2.4
                  
                  KerasExample
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/addition_rnn.html"
                    >
                      
                        2.4.1
                        
                      
                      addition_rnn
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/antirectifier.html"
                    >
                      
                        2.4.2
                        
                      
                      antirectifier
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/babi_memnn.html"
                    >
                      
                        2.4.3
                        
                      
                      babi_memnn
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/babi_rnn.html"
                    >
                      
                        2.4.4
                        
                      
                      babi_rnn
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/image_ocr.html"
                    >
                      
                        2.4.5
                        
                      
                      image_ocr
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/imdb_bidirectional_lstm.html"
                    >
                      
                        2.4.6
                        
                      
                      imdb_bidirectional_lstm
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/imdb_cnn.html"
                    >
                      
                        2.4.7
                        
                      
                      imdb_cnn
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/imdb_cnn_lstm.html"
                    >
                      
                        2.4.8
                        
                      
                      imdb_cnn_lstm
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/imdb_lstm.html"
                    >
                      
                        2.4.9
                        
                      
                      imdb_lstm
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/lstm-seq2seq.html"
                    >
                      
                        2.4.10
                        
                      
                      lstm-seq2seq
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/mnist_acgan.html"
                    >
                      
                        2.4.11
                        
                      
                      mnist_acgan
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/mnist_mlp.html"
                    >
                      
                        2.4.12
                        
                      
                      mnist_mlp
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/README.html"
                    >
                      
                        2.4.13
                        
                      
                      README
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/reuters_mlp.html"
                    >
                      
                        2.4.14
                        
                      
                      reuters_mlp
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/KerasExample/tensorboard_embeddings_mnist.html"
                    >
                      
                        2.4.15
                        
                      
                      tensorboard_embeddings_mnist
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/01TensorFlow/keras%E6%97%A5%E5%B8%B8%E5%B0%8F%E5%B7%A5%E5%85%B7.html"
                >
                  
                    2.5
                  
                  keras日常小工具
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/01TensorFlow/kera%E5%AD%A6%E4%B9%A0-%E6%9B%B4%E6%96%B0.html"
                >
                  
                    2.6
                  
                  kera学习-更新
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/01TensorFlow/kera%E5%AE%9E%E4%BE%8B%E4%BA%8C.html"
                >
                  
                    2.7
                  
                  kera实例二
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/01TensorFlow/recommendation/index.html"
                >
                  
                    2.8
                  
                  recommendation
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/recommendation/DeepFM%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E5%92%8C%E5%AE%9E%E8%B7%B5.html"
                    >
                      
                        2.8.1
                        
                      
                      DeepFM模型理论和实践
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/recommendation/DIN%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E5%92%8C%E5%AE%9E%E8%B7%B5.html"
                    >
                      
                        2.8.2
                        
                      
                      DIN模型理论和实践
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/recommendation/LR.html"
                    >
                      
                        2.8.3
                        
                      
                      LR
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/recommendation/MLR%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E5%92%8C%E5%AE%9E%E8%B7%B5.html"
                    >
                      
                        2.8.4
                        
                      
                      MLR模型理论和实践
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/01TensorFlow/tensorflowExample/index.html"
                >
                  
                    2.9
                  
                  tensorflowExample
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0001-ml_introduction.html"
                    >
                      
                        2.9.1
                        
                      
                      ml_introduction
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0002-mnist_dataset_intro.html"
                    >
                      
                        2.9.2
                        
                      
                      mnist_dataset_intro
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0101-helloworld.html"
                    >
                      
                        2.9.3
                        
                      
                      helloworld
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0102-basic_eager_api.html"
                    >
                      
                        2.9.4
                        
                      
                      basic_eager_api
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0103-basic_operations.html"
                    >
                      
                        2.9.5
                        
                      
                      basic_operations
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0201-linear_regression_eager_api.html"
                    >
                      
                        2.9.6
                        
                      
                      linear_regression_eager_api
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0202-linear_regression.html"
                    >
                      
                        2.9.7
                        
                      
                      linear_regression
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0203-logistic_regression_eager_api.html"
                    >
                      
                        2.9.8
                        
                      
                      logistic_regression_eager_api
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0204-nearest_neighbor.html"
                    >
                      
                        2.9.9
                        
                      
                      nearest_neighbor
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0205-kmeans.html"
                    >
                      
                        2.9.10
                        
                      
                      kmeans
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0206-LR.html"
                    >
                      
                        2.9.11
                        
                      
                      LR
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0207-GBDT.html"
                    >
                      
                        2.9.12
                        
                      
                      GBDT
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0208-word2vec.html"
                    >
                      
                        2.9.13
                        
                      
                      word2vec
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0209-random_forest.html"
                    >
                      
                        2.9.14
                        
                      
                      random_forest
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0301-autoencoder.html"
                    >
                      
                        2.9.15
                        
                      
                      autoencoder
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0302-bidirectional_rnn.html"
                    >
                      
                        2.9.16
                        
                      
                      bidirectional_rnn
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0303-convolutional_network_raw.html"
                    >
                      
                        2.9.17
                        
                      
                      convolutional_network_raw
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0304-convolutional_network.html"
                    >
                      
                        2.9.18
                        
                      
                      convolutional_network
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0305-dcgan.html"
                    >
                      
                        2.9.19
                        
                      
                      dcgan
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0306-dynamic_rnn.html"
                    >
                      
                        2.9.20
                        
                      
                      dynamic_rnn
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0307-gan.html"
                    >
                      
                        2.9.21
                        
                      
                      gan
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0308-neural_network_eager_api.html"
                    >
                      
                        2.9.22
                        
                      
                      neural_network_eager_api
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0309-neural_network_raw.html"
                    >
                      
                        2.9.23
                        
                      
                      neural_network_raw
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0310-neural_network.html"
                    >
                      
                        2.9.24
                        
                      
                      neural_network
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0311-recurrent_network.html"
                    >
                      
                        2.9.25
                        
                      
                      recurrent_network
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0312-variational_autoencoder.html"
                    >
                      
                        2.9.26
                        
                      
                      variational_autoencoder
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0401-save_restore_model.html"
                    >
                      
                        2.9.27
                        
                      
                      save_restore_model
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0402-tensorboard_advanced.html"
                    >
                      
                        2.9.28
                        
                      
                      tensorboard_advanced
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0403-tensorboard_basic.html"
                    >
                      
                        2.9.29
                        
                      
                      tensorboard_basic
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0501-build_an_image_dataset.html"
                    >
                      
                        2.9.30
                        
                      
                      build_an_image_dataset
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0502-tensorflow_dataset_api.html"
                    >
                      
                        2.9.31
                        
                      
                      tensorflow_dataset_api
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0601-multigpu_basics.html"
                    >
                      
                        2.9.32
                        
                      
                      multigpu_basics
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/01TensorFlow/tensorflowExample/0602-multigpu_cnn.html"
                    >
                      
                        2.9.33
                        
                      
                      multigpu_cnn
                    </a>
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/blog2/11ReadBook/index.html"
        >
          
            3.
          
          ReadBook
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/11ReadBook/00%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/index.html"
                >
                  
                    3.1
                  
                  统计学习方法
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/00%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/00%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E6%A6%82%E8%AE%BA.html"
                    >
                      
                        3.1.1
                        
                      
                      统计学习方法概论
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/00%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/02%E6%84%9F%E7%9F%A5%E6%9C%BA.html"
                    >
                      
                        3.1.2
                        
                      
                      感知机
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/00%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/03k%E8%BF%91%E9%82%BB%E6%B3%95.html"
                    >
                      
                        3.1.3
                        
                      
                      k近邻法
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/00%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/04%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF.html"
                    >
                      
                        3.1.4
                        
                      
                      朴素贝叶斯
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/00%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/05%E5%86%B3%E7%AD%96%E6%A0%91.html"
                    >
                      
                        3.1.5
                        
                      
                      决策树
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/00%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/06%E9%80%BB%E8%BE%91%E6%96%AF%E8%B0%9B%E5%9B%9E%E5%BD%92.html"
                    >
                      
                        3.1.6
                        
                      
                      逻辑斯谛回归
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/00%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/07%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA.html"
                    >
                      
                        3.1.7
                        
                      
                      支持向量机
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/00%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/08%E6%8F%90%E5%8D%87%E6%96%B9%E6%B3%95.html"
                    >
                      
                        3.1.8
                        
                      
                      提升方法
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/00%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/09%E7%AE%97%E6%B3%95%E5%8F%8A%E5%85%B6%E6%8E%A8%E5%B9%BF.html"
                    >
                      
                        3.1.9
                        
                      
                      算法及其推广
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/00%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/10%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B.html"
                    >
                      
                        3.1.10
                        
                      
                      隐马尔可夫模型
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/00%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/11%E6%9D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA.html"
                    >
                      
                        3.1.11
                        
                      
                      条件随机场
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/11ReadBook/02deep-learning-with-python/index.html"
                >
                  
                    3.2
                  
                  deep-learning-with-python
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/21-a-first-look-at-a-neural-network.html"
                    >
                      
                        3.2.1
                        
                      
                      a-first-look-at-a-neural-network
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/35-classifying-movie-reviews.html"
                    >
                      
                        3.2.2
                        
                      
                      classifying-movie-reviews
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/36-classifying-newswires.html"
                    >
                      
                        3.2.3
                        
                      
                      classifying-newswires
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/37-predicting-house-prices.html"
                    >
                      
                        3.2.4
                        
                      
                      predicting-house-prices
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/44-overfitting-and-underfitting.html"
                    >
                      
                        3.2.5
                        
                      
                      overfitting-and-underfitting
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/51-introduction-to-convnets.html"
                    >
                      
                        3.2.6
                        
                      
                      introduction-to-convnets
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/52-using-convnets-with-small-datasets.html"
                    >
                      
                        3.2.7
                        
                      
                      using-convnets-with-small-datasets
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/53-using-a-pretrained-convnet.html"
                    >
                      
                        3.2.8
                        
                      
                      using-a-pretrained-convnet
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/54-visualizing-what-convnets-learn.html"
                    >
                      
                        3.2.9
                        
                      
                      visualizing-what-convnets-learn
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/61-one-hot-encoding-of-words-or-characters.html"
                    >
                      
                        3.2.10
                        
                      
                      one-hot-encoding-of-words-or-characters
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/61-using-word-embeddings.html"
                    >
                      
                        3.2.11
                        
                      
                      using-word-embeddings
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/62-understanding-recurrent-neural-networks.html"
                    >
                      
                        3.2.12
                        
                      
                      understanding-recurrent-neural-networks
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/63-advanced-usage-of-recurrent-neural-networks.html"
                    >
                      
                        3.2.13
                        
                      
                      advanced-usage-of-recurrent-neural-networks
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/64-sequence-processing-with-convnets.html"
                    >
                      
                        3.2.14
                        
                      
                      sequence-processing-with-convnets
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/81-text-generation-with-lstm.html"
                    >
                      
                        3.2.15
                        
                      
                      text-generation-with-lstm
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/82-deep-dream.html"
                    >
                      
                        3.2.16
                        
                      
                      deep-dream
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/83-neural-style-transfer.html"
                    >
                      
                        3.2.17
                        
                      
                      neural-style-transfer
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/84-generating-images-with-vaes.html"
                    >
                      
                        3.2.18
                        
                      
                      generating-images-with-vaes
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/02deep-learning-with-python/85-introduction-to-gans.html"
                    >
                      
                        3.2.19
                        
                      
                      introduction-to-gans
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/11ReadBook/03handbook-en/index.html"
                >
                  
                    3.3
                  
                  handbook-en
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/000-Preface.html"
                    >
                      
                        3.3.1
                        
                      
                      Preface
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/200-Introduction-to-NumPy.html"
                    >
                      
                        3.3.2
                        
                      
                      Introduction-to-NumPy
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/201-Understanding-Data-Types.html"
                    >
                      
                        3.3.3
                        
                      
                      Understanding-Data-Types
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/202-The-Basics-Of-NumPy-Arrays.html"
                    >
                      
                        3.3.4
                        
                      
                      The-Basics-Of-NumPy-Arrays
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/203-Computation-on-arrays-ufuncs.html"
                    >
                      
                        3.3.5
                        
                      
                      Computation-on-arrays-ufuncs
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/204-Computation-on-arrays-aggregates.html"
                    >
                      
                        3.3.6
                        
                      
                      Computation-on-arrays-aggregates
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/205-Computation-on-arrays-broadcasting.html"
                    >
                      
                        3.3.7
                        
                      
                      Computation-on-arrays-broadcasting
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/206-Boolean-Arrays-and-Masks.html"
                    >
                      
                        3.3.8
                        
                      
                      Boolean-Arrays-and-Masks
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/207-Fancy-Indexing.html"
                    >
                      
                        3.3.9
                        
                      
                      Fancy-Indexing
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/208-Sorting.html"
                    >
                      
                        3.3.10
                        
                      
                      Sorting
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/209-Structured-Data-NumPy.html"
                    >
                      
                        3.3.11
                        
                      
                      Structured-Data-NumPy
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/300-Introduction-to-Pandas.html"
                    >
                      
                        3.3.12
                        
                      
                      Introduction-to-Pandas
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/301-Introducing-Pandas-Objects.html"
                    >
                      
                        3.3.13
                        
                      
                      Introducing-Pandas-Objects
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/302-Data-Indexing-and-Selection.html"
                    >
                      
                        3.3.14
                        
                      
                      Data-Indexing-and-Selection
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/303-Operations-in-Pandas.html"
                    >
                      
                        3.3.15
                        
                      
                      Operations-in-Pandas
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/304-Missing-Values.html"
                    >
                      
                        3.3.16
                        
                      
                      Missing-Values
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/305-Hierarchical-Indexing.html"
                    >
                      
                        3.3.17
                        
                      
                      Hierarchical-Indexing
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/306-Concat-And-Append.html"
                    >
                      
                        3.3.18
                        
                      
                      Concat-And-Append
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/307-Merge-and-Join.html"
                    >
                      
                        3.3.19
                        
                      
                      Merge-and-Join
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/308-Aggregation-and-Grouping.html"
                    >
                      
                        3.3.20
                        
                      
                      Aggregation-and-Grouping
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/309-Pivot-Tables.html"
                    >
                      
                        3.3.21
                        
                      
                      Pivot-Tables
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/310-Working-With-Strings.html"
                    >
                      
                        3.3.22
                        
                      
                      Working-With-Strings
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/311-Working-with-Time-Series.html"
                    >
                      
                        3.3.23
                        
                      
                      Working-with-Time-Series
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/312-Performance-Eval-and-Query.html"
                    >
                      
                        3.3.24
                        
                      
                      Performance-Eval-and-Query
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/313-Further-Resources.html"
                    >
                      
                        3.3.25
                        
                      
                      Further-Resources
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/400-Introduction-To-Matplotlib.html"
                    >
                      
                        3.3.26
                        
                      
                      Introduction-To-Matplotlib
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/401-Simple-Line-Plots.html"
                    >
                      
                        3.3.27
                        
                      
                      Simple-Line-Plots
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/402-Simple-Scatter-Plots.html"
                    >
                      
                        3.3.28
                        
                      
                      Simple-Scatter-Plots
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/403-Errorbars.html"
                    >
                      
                        3.3.29
                        
                      
                      Errorbars
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/404-Density-and-Contour-Plots.html"
                    >
                      
                        3.3.30
                        
                      
                      Density-and-Contour-Plots
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/405-Histograms-and-Binnings.html"
                    >
                      
                        3.3.31
                        
                      
                      Histograms-and-Binnings
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/406-Customizing-Legends.html"
                    >
                      
                        3.3.32
                        
                      
                      Customizing-Legends
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/407-Customizing-Colorbars.html"
                    >
                      
                        3.3.33
                        
                      
                      Customizing-Colorbars
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/408-Multiple-Subplots.html"
                    >
                      
                        3.3.34
                        
                      
                      Multiple-Subplots
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/409-Text-and-Annotation.html"
                    >
                      
                        3.3.35
                        
                      
                      Text-and-Annotation
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/410-Customizing-Ticks.html"
                    >
                      
                        3.3.36
                        
                      
                      Customizing-Ticks
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/411-Settings-and-Stylesheets.html"
                    >
                      
                        3.3.37
                        
                      
                      Settings-and-Stylesheets
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/412-Three-Dimensional-Plotting.html"
                    >
                      
                        3.3.38
                        
                      
                      Three-Dimensional-Plotting
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/413-Geographic-Data-With-Basemap.html"
                    >
                      
                        3.3.39
                        
                      
                      Geographic-Data-With-Basemap
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/414-Visualization-With-Seaborn.html"
                    >
                      
                        3.3.40
                        
                      
                      Visualization-With-Seaborn
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/415-Further-Resources.html"
                    >
                      
                        3.3.41
                        
                      
                      Further-Resources
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/500-Machine-Learning.html"
                    >
                      
                        3.3.42
                        
                      
                      Machine-Learning
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/501-What-Is-Machine-Learning.html"
                    >
                      
                        3.3.43
                        
                      
                      What-Is-Machine-Learning
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/502-Introducing-Scikit-Learn.html"
                    >
                      
                        3.3.44
                        
                      
                      Introducing-Scikit-Learn
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/503-Hyperparameters-and-Model-Validation.html"
                    >
                      
                        3.3.45
                        
                      
                      Hyperparameters-and-Model-Validation
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/504-Feature-Engineering.html"
                    >
                      
                        3.3.46
                        
                      
                      Feature-Engineering
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/505-Naive-Bayes.html"
                    >
                      
                        3.3.47
                        
                      
                      Naive-Bayes
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/506-Linear-Regression.html"
                    >
                      
                        3.3.48
                        
                      
                      Linear-Regression
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/507-Support-Vector-Machines.html"
                    >
                      
                        3.3.49
                        
                      
                      Support-Vector-Machines
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/508-Random-Forests.html"
                    >
                      
                        3.3.50
                        
                      
                      Random-Forests
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/509-Principal-Component-Analysis.html"
                    >
                      
                        3.3.51
                        
                      
                      Principal-Component-Analysis
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/510-Manifold-Learning.html"
                    >
                      
                        3.3.52
                        
                      
                      Manifold-Learning
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/511-K-Means.html"
                    >
                      
                        3.3.53
                        
                      
                      K-Means
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/512-Gaussian-Mixtures.html"
                    >
                      
                        3.3.54
                        
                      
                      Gaussian-Mixtures
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/513-Kernel-Density-Estimation.html"
                    >
                      
                        3.3.55
                        
                      
                      Kernel-Density-Estimation
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/514-Image-Features.html"
                    >
                      
                        3.3.56
                        
                      
                      Image-Features
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/515-Learning-More.html"
                    >
                      
                        3.3.57
                        
                      
                      Learning-More
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/600-Figure-Code.html"
                    >
                      
                        3.3.58
                        
                      
                      Figure-Code
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/handbook-en-01.html"
                    >
                      
                        3.3.59
                        
                      
                      handbook-en-01
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/handbook-en-02.html"
                    >
                      
                        3.3.60
                        
                      
                      handbook-en-02
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/Index.html"
                    >
                      
                        3.3.61
                        
                      
                      Index
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/merge_3.html"
                    >
                      
                        3.3.62
                        
                      
                      merge_3
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/merge_4.html"
                    >
                      
                        3.3.63
                        
                      
                      merge_4
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/03handbook-en/merge_5.html"
                    >
                      
                        3.3.64
                        
                      
                      merge_5
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/11ReadBook/04MachineLearningPractice/index.html"
                >
                  
                    3.4
                  
                  MachineLearningPractice
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/00naive-bayes-discuss.html"
                    >
                      
                        3.4.1
                        
                      
                      naive-bayes-discuss
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/01%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80.html"
                    >
                      
                        3.4.2
                        
                      
                      机器学习基础
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/02k-%E8%BF%91%E9%82%BB%E7%AE%97%E6%B3%95.html"
                    >
                      
                        3.4.3
                        
                      
                      k-近邻算法
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/03%E5%86%B3%E7%AD%96%E6%A0%91.html"
                    >
                      
                        3.4.4
                        
                      
                      决策树
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/04%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF.html"
                    >
                      
                        3.4.5
                        
                      
                      朴素贝叶斯
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/05Logistic%E5%9B%9E%E5%BD%92.html"
                    >
                      
                        3.4.6
                        
                      
                      Logistic回归
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/06%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA.html"
                    >
                      
                        3.4.7
                        
                      
                      支持向量机
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/07%E9%9B%86%E6%88%90%E6%96%B9%E6%B3%95-%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%92%8CAdaBoost.html"
                    >
                      
                        3.4.8
                        
                      
                      集成方法-随机森林和AdaBoost
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/08%E9%A2%84%E6%B5%8B%E6%95%B0%E5%80%BC%E5%9E%8B%E6%95%B0%E6%8D%AE-%E5%9B%9E%E5%BD%92.html"
                    >
                      
                        3.4.9
                        
                      
                      预测数值型数据-回归
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/09%E6%A0%91%E5%9B%9E%E5%BD%92.html"
                    >
                      
                        3.4.10
                        
                      
                      树回归
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/10k-means%E8%81%9A%E7%B1%BB.html"
                    >
                      
                        3.4.11
                        
                      
                      k-means聚类
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/11Apriori-%E5%85%B3%E8%81%94%E5%88%86%E6%9E%90.html"
                    >
                      
                        3.4.12
                        
                      
                      Apriori-关联分析
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/12FP-growth-%E9%A2%91%E7%B9%81%E9%A1%B9%E9%9B%86.html"
                    >
                      
                        3.4.13
                        
                      
                      FP-growth-频繁项集
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/13%E5%88%A9%E7%94%A8PCA%E6%9D%A5%E7%AE%80%E5%8C%96%E6%95%B0%E6%8D%AE.html"
                    >
                      
                        3.4.14
                        
                      
                      利用PCA来简化数据
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/14%E5%88%A9%E7%94%A8SVD%E7%AE%80%E5%8C%96%E6%95%B0%E6%8D%AE.html"
                    >
                      
                        3.4.15
                        
                      
                      利用SVD简化数据
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/15%E5%A4%A7%E6%95%B0%E6%8D%AE%E4%B8%8EMapReduce.html"
                    >
                      
                        3.4.16
                        
                      
                      大数据与MapReduce
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/04MachineLearningPractice/16%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html"
                    >
                      
                        3.4.17
                        
                      
                      推荐系统
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/11ReadBook/05pydata-zh/index.html"
                >
                  
                    3.5
                  
                  pydata-zh
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/041%20%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%84%E5%AF%B9%E8%B1%A1.html"
                    >
                      
                        3.5.1
                        
                      
                      多维数组对象
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/042%20%E9%80%9A%E7%94%A8%E5%87%BD%E6%95%B0.html"
                    >
                      
                        3.5.2
                        
                      
                      通用函数
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/043%20%E6%95%B0%E7%BB%84%E5%AF%BC%E5%90%91%E7%BC%96%E7%A8%8B.html"
                    >
                      
                        3.5.3
                        
                      
                      数组导向编程
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/051%20pandas%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html"
                    >
                      
                        3.5.4
                        
                      
                      pandas的数据结构
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/052%20pandas%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD.html"
                    >
                      
                        3.5.5
                        
                      
                      pandas主要功能
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/053%20%E6%80%BB%E7%BB%93%E5%92%8C%E6%8F%8F%E8%BF%B0%E6%80%A7%E7%BB%9F%E8%AE%A1.html"
                    >
                      
                        3.5.6
                        
                      
                      总结和描述性统计
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/071%20%E5%A4%84%E7%90%86%E7%BC%BA%E5%A4%B1%E6%95%B0%E6%8D%AE.html"
                    >
                      
                        3.5.7
                        
                      
                      处理缺失数据
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/072%20%E6%95%B0%E6%8D%AE%E5%8F%98%E6%8D%A2.html"
                    >
                      
                        3.5.8
                        
                      
                      数据变换
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/073%20%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86.html"
                    >
                      
                        3.5.9
                        
                      
                      字符串处理
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/111%20%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8A%E5%85%B6%E5%B7%A5%E5%85%B7.html"
                    >
                      
                        3.5.10
                        
                      
                      日期和时间数据类型及其工具
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/112%20%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%9F%BA%E7%A1%80.html"
                    >
                      
                        3.5.11
                        
                      
                      时间序列基础
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/113%20%E6%97%A5%E6%9C%9F%E8%8C%83%E5%9B%B4,%E9%A2%91%E5%BA%A6,%E5%92%8C%E4%BD%8D%E7%A7%BB.html"
                    >
                      
                        3.5.12
                        
                      
                      日期范围，频度，和位移
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/121%20%E7%B1%BB%E5%88%AB%E6%95%B0%E6%8D%AE.html"
                    >
                      
                        3.5.13
                        
                      
                      类别数据
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/142%20MovieLens%201M%E6%95%B0%E6%8D%AE%E9%9B%86.html"
                    >
                      
                        3.5.14
                        
                      
                      MovieLens 1M数据集
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/11ReadBook/05pydata-zh/143%20%E4%BB%8E1880%E5%B9%B4%E8%87%B32010%E5%B9%B4%E7%BE%8E%E5%9B%BD%E5%A9%B4%E5%84%BF%E5%A7%93%E5%90%8D.html"
                    >
                      
                        3.5.15
                        
                      
                      从1880年至2010年美国婴儿姓名
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/11ReadBook/11%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%AD%E6%96%87%E7%89%88.html"
                >
                  
                    3.6
                  
                  深度学习中文版
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/11ReadBook/12spark-en%E6%B1%87%E6%80%BB.html"
                >
                  
                    3.7
                  
                  spark-en汇总
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/11ReadBook/51%E6%89%80%E8%B0%93%E6%83%85%E5%95%86%E9%AB%98,%E5%B0%B1%E6%98%AF%E4%BC%9A%E8%AF%B4%E8%AF%9D.html"
                >
                  
                    3.8
                  
                  所谓情商高，就是会说话
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/index.html"
        >
          
            4.
          
          常见算法
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/adaBoost/index.html"
                >
                  
                    4.1
                  
                  adaBoost
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/adaBoost/AdaBoost.html"
                    >
                      
                        4.1.1
                        
                      
                      AdaBoost
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/adaBoost/AdaBoost%E5%85%83%E7%AE%97%E6%B3%95%E6%8F%90%E9%AB%98%E5%88%86%E7%B1%BB%E6%80%A7%E8%83%BD.html"
                    >
                      
                        4.1.2
                        
                      
                      AdaBoost元算法提高分类性能
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/apriori/index.html"
                >
                  
                    4.2
                  
                  apriori
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/apriori/apriori.html"
                    >
                      
                        4.2.1
                        
                      
                      apriori
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/bayes/index.html"
                >
                  
                    4.3
                  
                  bayes
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/bayes/naiveBayes.html"
                    >
                      
                        4.3.1
                        
                      
                      naiveBayes
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/boost/index.html"
                >
                  
                    4.4
                  
                  boost
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/boost/Boost%E7%AE%80%E4%BB%8B.html"
                    >
                      
                        4.4.1
                        
                      
                      Boost简介
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/ES%E6%9F%A5%E8%AF%A2.html"
                >
                  
                    4.5
                  
                  ES查询
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/fp-growth/index.html"
                >
                  
                    4.6
                  
                  fp-growth
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/fp-growth/fp-growth.html"
                    >
                      
                        4.6.1
                        
                      
                      fp-growth
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/k-Nearest%20Neighbor/index.html"
                >
                  
                    4.7
                  
                  k-Nearest Neighbor
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/k-Nearest%20Neighbor/knn.html"
                    >
                      
                        4.7.1
                        
                      
                      knn
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/k-Nearest%20Neighbor/knn_%E5%8E%9F%E7%89%88.html"
                    >
                      
                        4.7.2
                        
                      
                      knn_原版
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/kmeans/index.html"
                >
                  
                    4.8
                  
                  kmeans
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/kmeans/kmeans.html"
                    >
                      
                        4.8.1
                        
                      
                      kmeans
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/line-regression/index.html"
                >
                  
                    4.9
                  
                  line-regression
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/line-regression/line_regression.html"
                    >
                      
                        4.9.1
                        
                      
                      line_regression
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/line-regression/LR.html"
                    >
                      
                        4.9.2
                        
                      
                      LR
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/logistic/index.html"
                >
                  
                    4.10
                  
                  logistic
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/logistic/logistic-code.html"
                    >
                      
                        4.10.1
                        
                      
                      logistic-code
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/logistic/logistic-%E7%90%86%E8%AE%BA.html"
                    >
                      
                        4.10.2
                        
                      
                      logistic-理论
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/logistic/temo.html"
                    >
                      
                        4.10.3
                        
                      
                      temo
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/pca/index.html"
                >
                  
                    4.11
                  
                  pca
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/pca/pca.html"
                    >
                      
                        4.11.1
                        
                      
                      pca
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/pca%E4%B8%8Esvd%E7%9A%84%E6%AF%94%E8%BE%83/index.html"
                >
                  
                    4.12
                  
                  pca与svd的比较
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/pca%E4%B8%8Esvd%E7%9A%84%E6%AF%94%E8%BE%83/pca.html"
                    >
                      
                        4.12.1
                        
                      
                      pca
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/README.html"
                >
                  
                    4.13
                  
                  README
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/regressionTree/index.html"
                >
                  
                    4.14
                  
                  regressionTree
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/regressionTree/CART.html"
                    >
                      
                        4.14.1
                        
                      
                      CART
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/svd/index.html"
                >
                  
                    4.15
                  
                  svd
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/svd/collaborative_filter.html"
                    >
                      
                        4.15.1
                        
                      
                      collaborative_filter
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/svd/svd.html"
                    >
                      
                        4.15.2
                        
                      
                      svd
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/svm/index.html"
                >
                  
                    4.16
                  
                  svm
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/svm/smo.html"
                    >
                      
                        4.16.1
                        
                      
                      smo
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/Untitled.html"
                >
                  
                    4.17
                  
                  Untitled
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/xgboost/index.html"
                >
                  
                    4.18
                  
                  xgboost
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/xgboost/xgboost.html"
                    >
                      
                        4.18.1
                        
                      
                      xgboost
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/xgboost/%E5%8D%81%E5%88%86%E9%92%9F%E4%B8%8A%E6%89%8Bxgboost.html"
                    >
                      
                        4.18.2
                        
                      
                      十分钟上手xgboost
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/%E5%86%B3%E7%AD%96%E6%A0%91(DecisionTree)/index.html"
                >
                  
                    4.19
                  
                  决策树(DecisionTree)
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/%E5%86%B3%E7%AD%96%E6%A0%91(DecisionTree)/decisionTree.html"
                    >
                      
                        4.19.1
                        
                      
                      decisionTree
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/%E5%86%B3%E7%AD%96%E6%A0%91(DecisionTree)/%E5%86%B3%E7%AD%96%E6%A0%91%E7%AE%80%E4%BB%8B.html"
                    >
                      
                        4.19.2
                        
                      
                      决策树简介
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/%E5%BB%BA%E6%A8%A1%E8%BF%87%E7%A8%8B.html"
                >
                  
                    4.20
                  
                  建模过程
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/index.html"
        >
          
            5.
          
          算法集锦
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/math/index.html"
                >
                  
                    5.1
                  
                  math
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/math/%E4%B8%BB%E6%88%90%E5%88%86%E5%88%86%E6%9E%90.html"
                    >
                      
                        5.1.1
                        
                      
                      主成分分析
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/math/%E6%9C%80%E5%B0%8F%E4%BA%8C%E4%B9%98%E6%B3%95.html"
                    >
                      
                        5.1.2
                        
                      
                      最小二乘法
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/math/%E7%9F%A9%E9%98%B5%E6%B1%82%E5%AF%BC.html"
                    >
                      
                        5.1.3
                        
                      
                      矩阵求导
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95/index.html"
                >
                  
                    5.2
                  
                  推荐算法
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95/%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93.html"
                    >
                      
                        5.2.1
                        
                      
                      协同过滤推荐算法总结
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95/%E7%9F%A9%E9%98%B5%E5%88%86%E8%A7%A3.html"
                    >
                      
                        5.2.2
                        
                      
                      矩阵分解
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/index.html"
                >
                  
                    5.3
                  
                  推荐系统
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/test.html"
                    >
                      
                        5.3.1
                        
                      
                      test
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%96%87%E6%9C%AC%E6%8C%96%E6%8E%98/index.html"
                >
                  
                    5.4
                  
                  文本挖掘
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%96%87%E6%9C%AC%E6%8C%96%E6%8E%98/LDA%E6%A8%A1%E5%9E%8B.html"
                    >
                      
                        5.4.1
                        
                      
                      LDA模型
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%96%87%E6%9C%AC%E6%8C%96%E6%8E%98/Word2Vec.html"
                    >
                      
                        5.4.2
                        
                      
                      Word2Vec
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%96%87%E6%9C%AC%E6%8C%96%E6%8E%98/%E6%96%87%E6%9C%AC%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%9E%8B%E4%B9%8B%E6%BD%9C%E5%9C%A8%E8%AF%AD%E4%B9%89%E7%B4%A2%E5%BC%95(LSI).html"
                    >
                      
                        5.4.3
                        
                      
                      文本主题模型之潜在语义索引(LSI)
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%96%87%E6%9C%AC%E6%8C%96%E6%8E%98/%E6%96%87%E6%9C%AC%E6%8C%96%E6%8E%98%E9%A2%84%E5%A4%84%E7%90%86%E4%B9%8BTF-IDF.html"
                    >
                      
                        5.4.4
                        
                      
                      文本挖掘预处理之TF-IDF
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%96%87%E6%9C%AC%E6%8C%96%E6%8E%98/%E9%9A%90%E9%A9%AC%E5%B0%94%E7%A7%91%E5%A4%AB%E6%A8%A1%E5%9E%8BHMM.html"
                    >
                      
                        5.4.5
                        
                      
                      隐马尔科夫模型HMM
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/index.html"
                >
                  
                    5.5
                  
                  深度学习
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/LSTM.html"
                    >
                      
                        5.5.1
                        
                      
                      LSTM
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/RNN.html"
                    >
                      
                        5.5.2
                        
                      
                      RNN
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/Seq2Seq.html"
                    >
                      
                        5.5.3
                        
                      
                      Seq2Seq
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/TensorFlow-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86.html"
                    >
                      
                        5.5.4
                        
                      
                      TensorFlow-字符串处理
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/tensorflow%E5%AD%A6%E4%B9%A0.html"
                    >
                      
                        5.5.5
                        
                      
                      tensorflow学习
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/TensorFlow%E5%B8%B8%E8%A7%81%E4%BB%A3%E7%A0%81%E5%9D%97.html"
                    >
                      
                        5.5.6
                        
                      
                      TensorFlow常见代码块
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/tf%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95.html"
                    >
                      
                        5.5.7
                        
                      
                      tf优化方法
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/tf%E5%87%BD%E6%95%B0.html"
                    >
                      
                        5.5.8
                        
                      
                      tf函数
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E4%BA%BA%E5%B7%A5%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C.html"
                    >
                      
                        5.5.9
                        
                      
                      人工神经网络
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/index.html"
                >
                  
                    5.6
                  
                  神经网络
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/AutoEncoder-%E8%87%AA%E7%BC%96%E7%A0%81%E5%AE%9E%E8%B7%B5.html"
                    >
                      
                        5.6.1
                        
                      
                      AutoEncoder-自编码实践
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/AutoEncoder-%E8%87%AA%E7%BC%96%E7%A0%81%E7%90%86%E8%AE%BA.html"
                    >
                      
                        5.6.2
                        
                      
                      AutoEncoder-自编码理论
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/CNN-%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%90%86%E8%AE%BA.html"
                    >
                      
                        5.6.3
                        
                      
                      CNN-卷积神经网络理论
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/DNN-%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C.html"
                    >
                      
                        5.6.4
                        
                      
                      DNN-深度神经网络
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/LSTM-%E9%95%BF%E7%9F%AD%E6%9C%9F%E8%AE%B0%E5%BF%86%E7%BD%91%E7%BB%9C%E7%90%86%E8%AE%BA.html"
                    >
                      
                        5.6.5
                        
                      
                      LSTM-长短期记忆网络理论
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/PCA-%E4%B8%BB%E6%88%90%E5%88%86%E5%88%86%E6%9E%90.html"
                    >
                      
                        5.6.6
                        
                      
                      PCA-主成分分析
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/RBM-%E5%8F%97%E9%99%90%E7%8E%BB%E5%B0%94%E5%85%B9%E6%9B%BC%E6%9C%BA%E5%AE%9E%E8%B7%B5.html"
                    >
                      
                        5.6.7
                        
                      
                      RBM-受限玻尔兹曼机实践
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/RBM-%E5%8F%97%E9%99%90%E7%8E%BB%E5%B0%94%E5%85%B9%E6%9B%BC%E6%9C%BA%E7%90%86%E8%AE%BA.html"
                    >
                      
                        5.6.8
                        
                      
                      RBM-受限玻尔兹曼机理论
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/RNN-%E9%80%92%E5%BD%92%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%90%86%E8%AE%BA.html"
                    >
                      
                        5.6.9
                        
                      
                      RNN-递归神经网络理论
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/%E5%90%91%E9%87%8F%E9%99%8D%E7%BB%B4.html"
                    >
                      
                        5.6.10
                        
                      
                      向量降维
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/%E5%B8%B8%E8%A7%81%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0%E6%B1%87%E6%80%BB.html"
                    >
                      
                        5.6.11
                        
                      
                      常见损失函数汇总
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/14%E7%AE%97%E6%B3%95%E9%9B%86%E9%94%A6/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/%E5%B8%B8%E8%A7%81%E6%BF%80%E5%8A%B1%E5%87%BD%E6%95%B0%E6%B1%87%E6%80%BB.html"
                    >
                      
                        5.6.12
                        
                      
                      常见激励函数汇总
                    </a>
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/blog2/15tools/index.html"
        >
          
            6.
          
          tools
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/15tools/colabHub/index.html"
                >
                  
                    6.1
                  
                  colabHub
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/colabHub/README.html"
                    >
                      
                        6.1.1
                        
                      
                      README
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/colabHub/%E5%88%9D%E5%A7%8B%E5%8C%96.html"
                    >
                      
                        6.1.2
                        
                      
                      初始化
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/15tools/DownLoadPicture.html"
                >
                  
                    6.2
                  
                  DownLoadPicture
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/15tools/latex/index.html"
                >
                  
                    6.3
                  
                  latex
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/latex/LaTeX%E5%85%AC%E5%BC%8F%E5%AE%9E%E4%BE%8B.html"
                    >
                      
                        6.3.1
                        
                      
                      LaTeX公式实例
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/latex/latex%E5%85%AC%E5%BC%8F%E7%BC%96%E5%8F%B7.html"
                    >
                      
                        6.3.2
                        
                      
                      latex公式编号
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/latex/%E5%8D%81%E5%88%86%E9%92%9F%E4%B8%8A%E6%89%8BLaTeX.html"
                    >
                      
                        6.3.3
                        
                      
                      十分钟上手LaTeX
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/15tools/numpy/index.html"
                >
                  
                    6.4
                  
                  numpy
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/numpy/numpy%E6%95%99%E7%A8%8B00.html"
                    >
                      
                        6.4.1
                        
                      
                      numpy教程00
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/numpy/numpy%E6%95%99%E7%A8%8B01.html"
                    >
                      
                        6.4.2
                        
                      
                      numpy教程01
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/numpy/numpy%E6%95%99%E7%A8%8B02.html"
                    >
                      
                        6.4.3
                        
                      
                      numpy教程02
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/numpy/numpy%E6%95%99%E7%A8%8B03.html"
                    >
                      
                        6.4.4
                        
                      
                      numpy教程03
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/15tools/pandas/index.html"
                >
                  
                    6.5
                  
                  pandas
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/pandas/pandas.html"
                    >
                      
                        6.5.1
                        
                      
                      pandas
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/pandas/pandas%E5%87%BD%E6%95%B0%E6%B7%B1%E5%85%A5.html"
                    >
                      
                        6.5.2
                        
                      
                      pandas函数深入
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/pandas/pandas%E6%95%99%E7%A8%8B01.html"
                    >
                      
                        6.5.3
                        
                      
                      pandas教程01
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/pandas/pandas%E6%95%99%E7%A8%8B02.html"
                    >
                      
                        6.5.4
                        
                      
                      pandas教程02
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/pandas/pandas%E6%95%99%E7%A8%8B03.html"
                    >
                      
                        6.5.5
                        
                      
                      pandas教程03
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/pandas/%E5%8D%81%E5%88%86%E9%92%9F%E4%B8%8A%E6%89%8BPandas.html"
                    >
                      
                        6.5.6
                        
                      
                      十分钟上手Pandas
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/pandas/%E5%8D%81%E5%88%86%E9%92%9F%E4%B8%8A%E6%89%8BPandas%E5%87%BD%E6%95%B0.html"
                    >
                      
                        6.5.7
                        
                      
                      十分钟上手Pandas函数
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/15tools/%E7%94%BB%E5%9B%BE/index.html"
                >
                  
                    6.6
                  
                  画图
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/%E7%94%BB%E5%9B%BE/python%E7%94%BB%E5%9B%BE%E4%B9%8Bfolium%E5%9C%B0%E5%9B%BE.html"
                    >
                      
                        6.6.1
                        
                      
                      python画图之folium地图
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/%E7%94%BB%E5%9B%BE/python%E7%94%BB%E5%9B%BE%E4%B9%8Bpycharts-3D%E5%9B%BE.html"
                    >
                      
                        6.6.2
                        
                      
                      python画图之pycharts-3D图
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/%E7%94%BB%E5%9B%BE/python%E7%94%BB%E5%9B%BE%E4%B9%8Bpycharts-kline.html"
                    >
                      
                        6.6.3
                        
                      
                      python画图之pycharts-kline
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/%E7%94%BB%E5%9B%BE/python%E7%94%BB%E5%9B%BE%E4%B9%8Bpycharts-%E5%85%B6%E4%BB%96.html"
                    >
                      
                        6.6.4
                        
                      
                      python画图之pycharts-其他
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/%E7%94%BB%E5%9B%BE/python%E7%94%BB%E5%9B%BE%E4%B9%8Bpycharts-%E5%85%B6%E4%BB%96%E5%9D%90%E6%A0%87%E7%B3%BB.html"
                    >
                      
                        6.6.5
                        
                      
                      python画图之pycharts-其他坐标系
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/%E7%94%BB%E5%9B%BE/python%E7%94%BB%E5%9B%BE%E4%B9%8Bpycharts-%E5%9C%B0%E5%9B%BE.html"
                    >
                      
                        6.6.6
                        
                      
                      python画图之pycharts-地图
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/%E7%94%BB%E5%9B%BE/python%E7%94%BB%E5%9B%BE%E4%B9%8Bpycharts-%E7%9B%B4%E8%A7%92%E5%9D%90%E6%A0%87%E7%B3%BB.html"
                    >
                      
                        6.6.7
                        
                      
                      python画图之pycharts-直角坐标系
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/%E7%94%BB%E5%9B%BE/python%E7%94%BB%E5%9B%BE%E4%B9%8Bpycharts-%E7%AE%80%E4%BB%8B.html"
                    >
                      
                        6.6.8
                        
                      
                      python画图之pycharts-简介
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/15tools/%E7%94%BB%E5%9B%BE/Untitled.html"
                    >
                      
                        6.6.9
                        
                      
                      Untitled
                    </a>
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/blog2/99Example/index.html"
        >
          
            7.
          
          Example
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/4/index.html"
                >
                  
                    7.1
                  
                  
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/4/computational-tools.html"
                    >
                      
                        7.1.1
                        
                      
                      computational-tools
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/4/endnote.html"
                    >
                      
                        7.1.2
                        
                      
                      endnote
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/4/establishing-causality.html"
                    >
                      
                        7.1.3
                        
                      
                      establishing-causality
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/4/intro.html"
                    >
                      
                        7.1.4
                        
                      
                      intro
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/4/observation-and-visualization-john-snow-and-the-broad-street-pump.html"
                    >
                      
                        7.1.5
                        
                      
                      observation-and-visualization-john-snow-and-the-broad-street-pump
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/4/Plotting_the_Classics.html"
                    >
                      
                        7.1.6
                        
                      
                      Plotting_the_Classics
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/4/randomization.html"
                    >
                      
                        7.1.7
                        
                      
                      randomization
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/4/snow-s-grand-experiment.html"
                    >
                      
                        7.1.8
                        
                      
                      snow-s-grand-experiment
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/4/subsections.html"
                    >
                      
                        7.1.9
                        
                      
                      subsections
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/4/subsectiontwo.html"
                    >
                      
                        7.1.10
                        
                      
                      subsectiontwo
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/4/why-data-science.html"
                    >
                      
                        7.1.11
                        
                      
                      why-data-science
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/Calls.html"
                >
                  
                    7.2
                  
                  Calls
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/causality-and-experiments.html"
                >
                  
                    7.3
                  
                  causality-and-experiments
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/Expressions.html"
                >
                  
                    7.4
                  
                  Expressions
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/features/index.html"
                >
                  
                    7.5
                  
                  features
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/features/citations.html"
                    >
                      
                        7.5.1
                        
                      
                      citations
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/features/features.html"
                    >
                      
                        7.5.2
                        
                      
                      features
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/features/hiding.html"
                    >
                      
                        7.5.3
                        
                      
                      hiding
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/features/interact.html"
                    >
                      
                        7.5.4
                        
                      
                      interact
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/features/interactive_cells.html"
                    >
                      
                        7.5.5
                        
                      
                      interactive_cells
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/features/limits.html"
                    >
                      
                        7.5.6
                        
                      
                      limits
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/features/markdown.html"
                    >
                      
                        7.5.7
                        
                      
                      markdown
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/features/notebooks.html"
                    >
                      
                        7.5.8
                        
                      
                      notebooks
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/features/search.html"
                    >
                      
                        7.5.9
                        
                      
                      search
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/Growth.html"
                >
                  
                    7.6
                  
                  Growth
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/guide/index.html"
                >
                  
                    7.7
                  
                  guide
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/guide/01_overview.html"
                    >
                      
                        7.7.1
                        
                      
                      _overview
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/guide/02_create.html"
                    >
                      
                        7.7.2
                        
                      
                      _create
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/guide/03_build.html"
                    >
                      
                        7.7.3
                        
                      
                      _build
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/guide/04_faq.html"
                    >
                      
                        7.7.4
                        
                      
                      _faq
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/99Example/guide/05_advanced.html"
                    >
                      
                        7.7.5
                        
                      
                      _advanced
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/Introduction_to_Tables.html"
                >
                  
                    7.8
                  
                  Introduction_to_Tables
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/Names.html"
                >
                  
                    7.9
                  
                  Names
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/Numbers.html"
                >
                  
                    7.10
                  
                  Numbers
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/programming-in-python.html"
                >
                  
                    7.11
                  
                  programming-in-python
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/statistical-techniques.html"
                >
                  
                    7.12
                  
                  statistical-techniques
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/Strings.html"
                >
                  
                    7.13
                  
                  Strings
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/Types.html"
                >
                  
                    7.14
                  
                  Types
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/99Example/what-is-data-science.html"
                >
                  
                    7.15
                  
                  what-is-data-science
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/blog2/notebooks/index.html"
        >
          
            8.
          
          notebooks
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/notebooks/JupyterNotebookTips.html"
                >
                  
                    8.1
                  
                  JupyterNotebookTips
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/notebooks/LinearRegression.html"
                >
                  
                    8.2
                  
                  LinearRegression
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/blog2/notechats/index.html"
        >
          
            9.
          
          notechats
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/notechats/notedata%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE.html"
                >
                  
                    9.1
                  
                  notedata测试数据
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/blog2/package/index.html"
        >
          
            10.
          
          package
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/package/folium.html"
                >
                  
                    10.1
                  
                  folium
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/package/graphviz%E4%B9%8B%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8.html"
                >
                  
                    10.2
                  
                  graphviz之安装使用
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/package/pygithub.html"
                >
                  
                    10.3
                  
                  pygithub
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/package/word2vec.html"
                >
                  
                    10.4
                  
                  word2vec
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/package/%E5%90%91%E9%87%8F%E5%BC%95%E6%93%8Efaiss.html"
                >
                  
                    10.5
                  
                  向量引擎faiss
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/package/%E8%AF%8D%E5%90%91%E9%87%8F%E8%AE%AD%E7%BB%83.html"
                >
                  
                    10.6
                  
                  词向量训练
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/blog2/papers/index.html"
        >
          
            11.
          
          papers
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/blog2/papers/atrank/index.html"
                >
                  
                    11.1
                  
                  atrank
                </a>

                
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/papers/atrank/Atrank.html"
                    >
                      
                        11.1.1
                        
                      
                      Atrank
                    </a>
                
                  
                  

                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/blog2/papers/atrank/Attention.html"
                    >
                      
                        11.1.2
                        
                      
                      Attention
                    </a>
                

              </li>
              
            
          </ul>
        
      </li>

      
    
  </ul>
  <p class="sidebar_footer">Powered by <a href="https://github.com/jupyter/jupyter-book">Jupyter Book</a></p>
</nav>

    
    <!-- Empty sidebar placeholder that we'll auto-fill with javascript -->
    <aside class="sidebar__right">
        <header><h4 class="nav__title"><i class="fa fa-list"></i>   On this page</h4></header>
        <nav class="onthispage">
        </nav>
    </aside>
    
    <main class="c-textbook__page" tabindex="-1">
        <div class="o-wrapper">
            <div class="c-sidebar-toggle">
  <!-- We show the sidebar by default so we use .is-active -->
  <button
    id="js-sidebar-toggle"
    class="hamburger hamburger--arrowalt is-active"
  >
    <span class="hamburger-box">
      <span class="hamburger-inner"></span>
    </span>
    <span class="c-sidebar-toggle__label">Toggle Sidebar</span>
  </button>
</div>

            
<div class="buttons">
<a href="/content/11ReadBook/12spark-en%E6%B1%87%E6%80%BB.ipynb" download>
<button id="interact-button-download" class="interact-button">Download</button>
</a>

<button id="interact-button-thebelab" class="interact-button">Thebelab</button>









<a href="https://mybinder.org/v2/gh/jupyter/jupyter-book/gh-pages?filepath=..%2Fcontent%2F11ReadBook%2F12spark-en%E6%B1%87%E6%80%BB.ipynb"><button class="interact-button" id="interact-button-binder"><img class="interact-button-logo" src="/blog2/assets/images/logo_binder.svg" alt="Interact" />Interact</button></a>


</div>


            <div class="c-textbook__content">
                <h1 id="rdd-creation">RDD creation</h1>
<p>In this notebook we will introduce two different ways of getting data into the basic Spark data structure, the <strong>Resilient Distributed Dataset</strong> or <strong>RDD</strong>. An RDD is a distributed collection of elements. All work in Spark is expressed as either creating new RDDs, transforming existing RDDs, or calling actions on RDDs to compute a result. Spark automatically distributes the data contained in RDDs across your cluster and parallelizes the operations you perform on them.</p>

<h3 id="references">References</h3>

<p>The reference book for these and other Spark related topics is <em>Learning Spark</em> by Holden Karau, Andy Konwinski, Patrick Wendell, and Matei Zaharia.</p>

<p>The KDD Cup 1999 competition dataset is described in detail <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup99">here</a>.</p>

<h2 id="getting-the-data-files">Getting the data files</h2>
<p>In this notebook we will use the reduced dataset (10 percent) provided for the KDD Cup 1999, containing nearly half million network interactions. The file is provided as a <em>Gzip</em> file that we will download locally.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span> <span class="p">(</span><span class="s">"http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data_10_percent.gz"</span><span class="p">,</span> <span class="s">"kddcup.data_10_percent.gz"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_traceback_line highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    ---------------------------------------------------------------------------

    AttributeError                            Traceback (most recent call last)

    &lt;ipython-input-1-c9437f147d19&gt; in &lt;module&gt;()
          1 import urllib
    ----&gt; 2 f = urllib.urlretrieve ("http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data_10_percent.gz", "kddcup.data_10_percent.gz")
    

    AttributeError: module 'urllib' has no attribute 'urlretrieve'


</code></pre></div>      </div>
    </div>
  </div>
</div>

<h2 id="creating-a-rdd-from-a-file">Creating a RDD from a file</h2>
<p>The most common way of creating an RDD is to load it from a file. Notice that Spark’s <code class="highlighter-rouge">textFile</code> can handle compressed files directly.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_file</span> <span class="o">=</span> <span class="s">"./kddcup.data_10_percent.gz"</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Now we have our data file loaded into the <code class="highlighter-rouge">raw_data</code> RDD.</p>

<p>Without getting into Spark <em>transformations</em> and <em>actions</em>, the most basic thing we can do to check that we got our RDD contents right is to <code class="highlighter-rouge">count()</code> the number of lines loaded from the file into the RDD.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">raw_data</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>494021
</code></pre></div>      </div>

    </div>
  </div>
</div>

<p>We can also check the first few entries in our data.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">raw_data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[u'0,tcp,http,SF,181,5450,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,8,8,0.00,0.00,0.00,0.00,1.00,0.00,0.00,9,9,1.00,0.00,0.11,0.00,0.00,0.00,0.00,0.00,normal.',
 u'0,tcp,http,SF,239,486,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,8,8,0.00,0.00,0.00,0.00,1.00,0.00,0.00,19,19,1.00,0.00,0.05,0.00,0.00,0.00,0.00,0.00,normal.',
 u'0,tcp,http,SF,235,1337,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,8,8,0.00,0.00,0.00,0.00,1.00,0.00,0.00,29,29,1.00,0.00,0.03,0.00,0.00,0.00,0.00,0.00,normal.',
 u'0,tcp,http,SF,219,1337,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,6,6,0.00,0.00,0.00,0.00,1.00,0.00,0.00,39,39,1.00,0.00,0.03,0.00,0.00,0.00,0.00,0.00,normal.',
 u'0,tcp,http,SF,217,2032,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,6,6,0.00,0.00,0.00,0.00,1.00,0.00,0.00,49,49,1.00,0.00,0.02,0.00,0.00,0.00,0.00,0.00,normal.']
</code></pre></div>      </div>

    </div>
  </div>
</div>

<p>In the following notebooks, we will use this raw data to learn about the different Spark transformations and actions.</p>

<h2 id="creating-and-rdd-using-parallelize">Creating and RDD using <code class="highlighter-rouge">parallelize</code></h2>

<p>Another way of creating an RDD is to parallelize an already existing list.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>As we did before, we can <code class="highlighter-rouge">count()</code> the number of elements in the RDD.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100
</code></pre></div>      </div>

    </div>
  </div>
</div>

<p>As before, we can access the first few elements on our RDD.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[0, 1, 2, 3, 4]
</code></pre></div>      </div>

    </div>
  </div>
</div>

<h1 id="rdd-basics">RDD basics</h1>

<p>This notebook will introduce three basic but essential Spark operations. Two of them are the <em>transformations</em> <code class="highlighter-rouge">map</code> and <code class="highlighter-rouge">filter</code>. The other is the <em>action</em> <code class="highlighter-rouge">collect</code>. At the same time we will introduce the concept of <em>persistence</em> in Spark.</p>

<h2 id="getting-the-data-and-creating-the-rdd">Getting the data and creating the RDD</h2>

<p>As we did in our first notebook, we will use the reduced dataset (10 percent) provided for the KDD Cup 1999, containing nearly half million network interactions. The file is provided as a Gzip file that we will download locally.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span> <span class="p">(</span><span class="s">"http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data_10_percent.gz"</span><span class="p">,</span> <span class="s">"kddcup.data_10_percent.gz"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Now we can use this file to create our RDD.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_file</span> <span class="o">=</span> <span class="s">"./kddcup.data_10_percent.gz"</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<h2 id="the-filter-transformation">The <code class="highlighter-rouge">filter</code> transformation</h2>

<p>This transformation can be applied to RDDs in order to keep just elements that satisfy a certain condition. More concretely, a function is evaluated on every element in the original RDD. The new resulting RDD will contain just those elements that make the function return <code class="highlighter-rouge">True</code>.</p>

<p>For example, imagine we want to count how many <code class="highlighter-rouge">normal.</code> interactions we have in our dataset. We can filter our <code class="highlighter-rouge">raw_data</code> RDD as follows.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">normal_raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">'normal.'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Now we can count how many elements we have in the new RDD.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">normal_count</span> <span class="o">=</span> <span class="n">normal_raw_data</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="k">print</span> <span class="s">"There are {} 'normal' interactions"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normal_count</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"Count completed in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>There are 97278 'normal' interactions
Count completed in 5.951 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>Remember from notebook 1 that we have a total of 494021 in our 10 percent dataset. Here we can see that 97278 contain the <code class="highlighter-rouge">normal.</code> tag word.</p>

<p>Notice that we have measured the elapsed time for counting the elements in the RDD. We have done this because we wanted to point out that actual (distributed) computations in Spark take place when we execute <em>actions</em> and not <em>transformations</em>. In this case <code class="highlighter-rouge">count</code> is the action we execute on the RDD. We can apply as many transformations as we want on a our RDD and no computation will take place until we call the first action that, in this case takes a few seconds to complete.</p>

<h2 id="the-map-transformation">The <code class="highlighter-rouge">map</code> transformation</h2>

<p>By using the <code class="highlighter-rouge">map</code> transformation in Spark, we can apply a function to every element in our RDD. Python’s lambdas are specially expressive for this particular.</p>

<p>In this case we want to read our data file as a CSV formatted one. We can do this by applying a lambda function to each element in the RDD as follows.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="n">csv_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">))</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">head_rows</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="k">print</span> <span class="s">"Parse completed in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">head_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Parse completed in 1.715 seconds
[u'0',
 u'tcp',
 u'http',
 u'SF',
 u'181',
 u'5450',
 u'0',
 u'0',
 u'0',
 u'0',
 u'0',
 u'1',
 u'0',
 u'0',
 u'0',
 u'0',
 u'0',
 u'0',
 u'0',
 u'0',
 u'0',
 u'0',
 u'8',
 u'8',
 u'0.00',
 u'0.00',
 u'0.00',
 u'0.00',
 u'1.00',
 u'0.00',
 u'0.00',
 u'9',
 u'9',
 u'1.00',
 u'0.00',
 u'0.11',
 u'0.00',
 u'0.00',
 u'0.00',
 u'0.00',
 u'0.00',
 u'normal.']
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>Again, all action happens once we call the first Spark <em>action</em> (i.e. <em>take</em> in this case). What if we take a lot of elements instead of just the first few?</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">head_rows</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="k">print</span> <span class="s">"Parse completed in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Parse completed in 8.629 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>We can see that it takes longer. The <code class="highlighter-rouge">map</code> function is applied now in a  distributed way to a lot of elements on the RDD, hence the longer execution time.</p>

<h3 id="using-map-and-predefined-functions">Using <code class="highlighter-rouge">map</code> and predefined functions</h3>

<p>Of course we can use predefined functions with <code class="highlighter-rouge">map</code>. Imagine we want to have each element in the RDD as a key-value pair where the key is the tag (e.g. <em>normal</em>) and the value is the whole list of elements that represents the row in the CSV formatted file. We could proceed as follows.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse_interaction</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">elems</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">elems</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">elems</span><span class="p">)</span>

<span class="n">key_csv_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">parse_interaction</span><span class="p">)</span>
<span class="n">head_rows</span> <span class="o">=</span> <span class="n">key_csv_data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">head_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(u'normal.',
 [u'0',
  u'tcp',
  u'http',
  u'SF',
  u'181',
  u'5450',
  u'0',
  u'0',
  u'0',
  u'0',
  u'0',
  u'1',
  u'0',
  u'0',
  u'0',
  u'0',
  u'0',
  u'0',
  u'0',
  u'0',
  u'0',
  u'0',
  u'8',
  u'8',
  u'0.00',
  u'0.00',
  u'0.00',
  u'0.00',
  u'1.00',
  u'0.00',
  u'0.00',
  u'9',
  u'9',
  u'1.00',
  u'0.00',
  u'0.11',
  u'0.00',
  u'0.00',
  u'0.00',
  u'0.00',
  u'0.00',
  u'normal.'])
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>That was easy, wasn’t it?</p>

<p>In our notebook about working with key-value pairs we will use this type of RDDs to do data aggregations (e.g. count by key).</p>

<h2 id="the-collect-action">The <code class="highlighter-rouge">collect</code> action</h2>

<p>So far we have used the actions <code class="highlighter-rouge">count</code> and <code class="highlighter-rouge">take</code>. Another basic action we need to learn is <code class="highlighter-rouge">collect</code>. Basically it will get all the elements in the RDD into memory for us to work with them. For this reason it has to be used with care, specially when working with large RDDs.</p>

<p>An example using our raw data.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">all_raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="k">print</span> <span class="s">"Data collected in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Data collected in 17.927 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>That took longer as any other action we used before, of course. Every Spark worker node that has a fragment of the RDD has to be coordinated in order to retrieve its part, and then <em>reduce</em> everything together.</p>

<p>As a last example combining all the previous, we want to collect all the <code class="highlighter-rouge">normal</code> interactions as key-value pairs.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># get data from file</span>
<span class="n">data_file</span> <span class="o">=</span> <span class="s">"./kddcup.data_10_percent.gz"</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>

<span class="c"># parse into key-value pairs</span>
<span class="n">key_csv_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">parse_interaction</span><span class="p">)</span>

<span class="c"># filter normal key interactions</span>
<span class="n">normal_key_interactions</span> <span class="o">=</span> <span class="n">key_csv_data</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"normal."</span><span class="p">)</span>

<span class="c"># collect all</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">all_normal</span> <span class="o">=</span> <span class="n">normal_key_interactions</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="n">normal_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_normal</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"Data collected in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">"There are {} 'normal' interactions"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normal_count</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Data collected in 12.485 seconds
There are 97278 normal interactions
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>This count matches with the previous count for <code class="highlighter-rouge">normal</code> interactions. The new procedure is more time consuming. This is because we retrieve all the data with <code class="highlighter-rouge">collect</code> and then use Python’s <code class="highlighter-rouge">len</code> on the resulting list. Before we were just counting the total number of elements in the RDD by using <code class="highlighter-rouge">count</code>.</p>

<h1 id="sampling-rdds">Sampling RDDs</h1>

<p>So far we have introduced RDD creation together with some basic transformations such as <code class="highlighter-rouge">map</code> and <code class="highlighter-rouge">filter</code> and some actions such as <code class="highlighter-rouge">count</code>, <code class="highlighter-rouge">take</code>, and <code class="highlighter-rouge">collect</code>.</p>

<p>This notebook will show how to sample RDDs. Regarding transformations, <code class="highlighter-rouge">sample</code> will be introduced since it will be useful in many statistical learning scenarios. Then we will compare results with the <code class="highlighter-rouge">takeSample</code> action.</p>

<h2 id="getting-the-data-and-creating-the-rdd-1">Getting the data and creating the RDD</h2>

<p>In this case we will use the complete dataset provided for the KDD Cup 1999, containing nearly half million network interactions. The file is provided as a Gzip file that we will download locally.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span> <span class="p">(</span><span class="s">"http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data.gz"</span><span class="p">,</span> <span class="s">"kddcup.data.gz"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Now we can use this file to create our RDD.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_file</span> <span class="o">=</span> <span class="s">"./kddcup.data.gz"</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<h2 id="sampling-rdds-1">Sampling RDDs</h2>

<p>In Spark, there are two sampling operations, the transformation <code class="highlighter-rouge">sample</code> and the action <code class="highlighter-rouge">takeSample</code>. By using a transformation we can tell Spark to apply successive transformation on a sample of a given RDD. By using an action we retrieve a given sample and we can have it in local memory to be used by any other standard library (e.g. Scikit-learn).</p>

<h3 id="the-sample-transformation">The <code class="highlighter-rouge">sample</code> transformation</h3>

<p>The <code class="highlighter-rouge">sample</code> transformation takes up to three parameters. First is whether the sampling is done with replacement or not. Second is the sample size as a fraction. Finally we can optionally provide a <em>random seed</em>.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">raw_data_sample</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1234</span><span class="p">)</span>
<span class="n">sample_size</span> <span class="o">=</span> <span class="n">raw_data_sample</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">total_size</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="k">print</span> <span class="s">"Sample size is {} of {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample_size</span><span class="p">,</span> <span class="n">total_size</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sample size is 489957 of 4898431
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>But the power of sampling as a transformation comes from doing it as part of a sequence of additional transformations. This will show more powerful once we start doing aggregations and key-value pairs operations, and will be specially useful when using Spark’s machine learning library MLlib.</p>

<p>In the meantime, imagine we want to have an approximation of the proportion of <code class="highlighter-rouge">normal.</code> interactions in our dataset. We could do this by counting the total number of tags as we did in previous notebooks. However we want a quicker response and we don’t need the exact answer but just an approximation. We can do it as follows.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="c"># transformations to be applied</span>
<span class="n">raw_data_sample_items</span> <span class="o">=</span> <span class="n">raw_data_sample</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">))</span>
<span class="n">sample_normal_tags</span> <span class="o">=</span> <span class="n">raw_data_sample_items</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">"normal."</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>

<span class="c"># actions + time</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">sample_normal_tags_count</span> <span class="o">=</span> <span class="n">sample_normal_tags</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="n">sample_normal_ratio</span> <span class="o">=</span> <span class="n">sample_normal_tags_count</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"The ratio of 'normal' interactions is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sample_normal_ratio</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> 
<span class="k">print</span> <span class="s">"Count done in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The ratio of 'normal' interactions is 0.199
Count done in 44.523 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>Let’s compare this with calculating the ratio without sampling.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># transformations to be applied</span>
<span class="n">raw_data_items</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">))</span>
<span class="n">normal_tags</span> <span class="o">=</span> <span class="n">raw_data_items</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">"normal."</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>

<span class="c"># actions + time</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">normal_tags_count</span> <span class="o">=</span> <span class="n">normal_tags</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="n">normal_ratio</span> <span class="o">=</span> <span class="n">normal_tags_count</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_size</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"The ratio of 'normal' interactions is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">normal_ratio</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> 
<span class="k">print</span> <span class="s">"Count done in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The ratio of 'normal' interactions is 0.199
Count done in 91.09 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>We can see a gain in time. The more transformations we apply after the sampling the bigger this gain. This is because without sampling all the transformations are applied to the complete set of data.</p>

<h3 id="the-takesample-action">The <code class="highlighter-rouge">takeSample</code> action</h3>

<p>If what we need is to grab a sample of raw data from our RDD into local memory in order to be used by other non-Spark libraries, <code class="highlighter-rouge">takeSample</code> can be used.</p>

<p>The syntax is very similar, but in this case we specify the number of items instead of the sample size as a fraction of the complete data size.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">raw_data_sample</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">takeSample</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="mi">400000</span><span class="p">,</span> <span class="mi">1234</span><span class="p">)</span>
<span class="n">normal_data_sample</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">raw_data_sample</span> <span class="k">if</span> <span class="s">"normal."</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="n">normal_sample_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">normal_data_sample</span><span class="p">)</span>

<span class="n">normal_ratio</span> <span class="o">=</span> <span class="n">normal_sample_size</span> <span class="o">/</span> <span class="mf">400000.0</span>
<span class="k">print</span> <span class="s">"The ratio of 'normal' interactions is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normal_ratio</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"Count done in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The ratio of 'normal' interactions is 0.1988025
Count done in 76.166 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>The process was very similar as before. We obtained a sample of about 10 percent of the data, and then filter and split.</p>

<p>However, it took longer, even with a slightly smaller sample. The reason is that Spark just distributed the execution of the sampling process. The filtering and splitting of the results were done locally in a single node.</p>

<h1 id="set-operations-on-rdds">Set operations on RDDs</h1>

<p>Spark supports many of the operations we have in mathematical sets, such as union and intersection, even when the RDDs themselves are not properly sets. It is important to note that these operations require that the RDDs being operated on are of the same type.</p>

<p>Set operations are quite straightforward to understand as it work as expected. The only consideration comes from the fact that RDDs are not real sets, and therefore operations such as the union of RDDs doesn’t remove duplicates. In this notebook we will have a brief look at <code class="highlighter-rouge">subtract</code>, <code class="highlighter-rouge">distinct</code>, and <code class="highlighter-rouge">cartesian</code>.</p>

<h2 id="getting-the-data-and-creating-the-rdd-2">Getting the data and creating the RDD</h2>

<p>As we did in our first notebook, we will use the reduced dataset (10 percent) provided for the KDD Cup 1999, containing nearly half million network interactions. The file is provided as a Gzip file that we will download locally.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span> <span class="p">(</span><span class="s">"http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data_10_percent.gz"</span><span class="p">,</span> <span class="s">"kddcup.data_10_percent.gz"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_file</span> <span class="o">=</span> <span class="s">"./kddcup.data_10_percent.gz"</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<h2 id="getting-attack-interactions-using-subtract">Getting attack interactions using <code class="highlighter-rouge">subtract</code></h2>

<p>For illustrative purposes, imagine we already have our RDD with non attack (normal) interactions from some previous analysis.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">normal_raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">"normal."</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>We can obtain attack interactions by subtracting normal ones from the original unfiltered RDD as follows.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">attack_raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">normal_raw_data</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Let’s do some counts to check our results.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="c"># count all</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">raw_data_count</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="k">print</span> <span class="s">"All count in {} secs"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>All count in 5.261 secs
</code></pre></div>      </div>
    </div>
  </div>
</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># count normal</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">normal_raw_data_count</span> <span class="o">=</span> <span class="n">normal_raw_data</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="k">print</span> <span class="s">"Normal count in {} secs"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Normal count in 5.571 secs
</code></pre></div>      </div>
    </div>
  </div>
</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># count attacks</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">attack_raw_data_count</span> <span class="o">=</span> <span class="n">attack_raw_data</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
<span class="k">print</span> <span class="s">"Attack count in {} secs"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Attack count in 12.075 secs
</code></pre></div>      </div>
    </div>
  </div>
</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="s">"There are {} normal interactions and {} attacks, </span><span class="se">\
</span><span class="s">from a total of {} interactions"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normal_raw_data_count</span><span class="p">,</span><span class="n">attack_raw_data_count</span><span class="p">,</span><span class="n">raw_data_count</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>There are 97278 normal interactions and 396743 attacks, from a total of 494021 interactions
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>So now we have two RDDs, one with normal interactions and another one with attacks.</p>

<h2 id="protocol-and-service-combinations-using-cartesian">Protocol and service combinations using <code class="highlighter-rouge">cartesian</code></h2>

<p>We can compute the Cartesian product between two RDDs by using the <code class="highlighter-rouge">cartesian</code> transformation. It returns all possible pairs of elements between two RDDs. In our case we will use it to generate all the possible combinations between service and protocol in our network interactions.</p>

<p>First of all we need to isolate each collection of values in two separate RDDs. For that we will use <code class="highlighter-rouge">distinct</code> on the CSV-parsed dataset. From the <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup.names">dataset description</a> we know that protocol is the second column and service is the third (tag is the last one and not the first as appears in the page).</p>

<p>So first, let’s get the protocols.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">csv_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">))</span>
<span class="n">protocols</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
<span class="n">protocols</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[u'udp', u'icmp', u'tcp']
</code></pre></div>      </div>

    </div>
  </div>
</div>

<p>Now we do the same for services.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
<span class="n">services</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[u'domain',
 u'http_443',
 u'Z39_50',
 u'smtp',
 u'urp_i',
 u'private',
 u'echo',
 u'shell',
 u'red_i',
 u'eco_i',
 u'sunrpc',
 u'ftp_data',
 u'urh_i',
 u'pm_dump',
 u'pop_3',
 u'pop_2',
 u'systat',
 u'ftp',
 u'uucp',
 u'whois',
 u'netbios_dgm',
 u'efs',
 u'remote_job',
 u'daytime',
 u'ntp_u',
 u'finger',
 u'ldap',
 u'netbios_ns',
 u'kshell',
 u'iso_tsap',
 u'ecr_i',
 u'nntp',
 u'printer',
 u'domain_u',
 u'uucp_path',
 u'courier',
 u'exec',
 u'time',
 u'netstat',
 u'telnet',
 u'gopher',
 u'rje',
 u'sql_net',
 u'link',
 u'auth',
 u'netbios_ssn',
 u'csnet_ns',
 u'X11',
 u'IRC',
 u'tftp_u',
 u'login',
 u'supdup',
 u'name',
 u'nnsp',
 u'mtp',
 u'http',
 u'bgp',
 u'ctf',
 u'hostnames',
 u'klogin',
 u'vmnet',
 u'tim_i',
 u'discard',
 u'imap4',
 u'other',
 u'ssh']
</code></pre></div>      </div>

    </div>
  </div>
</div>

<p>A longer list in this case.</p>

<p>Now we can do the cartesian product.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">product</span> <span class="o">=</span> <span class="n">protocols</span><span class="o">.</span><span class="n">cartesian</span><span class="p">(</span><span class="n">services</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="k">print</span> <span class="s">"There are {} combinations of protocol X service"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">product</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>There are 198 combinations of protocol X service
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>Obviously, for such small RDDs doesn’t really make sense to use Spark cartesian product. We could have perfectly collected the values after using <code class="highlighter-rouge">distinct</code> and do the cartesian product locally. Moreover, <code class="highlighter-rouge">distinct</code> and <code class="highlighter-rouge">cartesian</code> are expensive operations so they must be used with care when the operating datasets are large.</p>

<h1 id="data-aggregations-on-rdds">Data aggregations on RDDs</h1>

<p>We can aggregate RDD data in Spark by using three different actions: <code class="highlighter-rouge">reduce</code>, <code class="highlighter-rouge">fold</code>, and <code class="highlighter-rouge">aggregate</code>. The last one is the more general one and someway includes the first two.</p>

<h2 id="getting-the-data-and-creating-the-rdd-3">Getting the data and creating the RDD</h2>

<p>As we did in our first notebook, we will use the reduced dataset (10 percent) provided for the <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html">KDD Cup 1999</a>, containing nearly half million nework interactions. The file is provided as a Gzip file that we will download locally.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span> <span class="p">(</span><span class="s">"http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data_10_percent.gz"</span><span class="p">,</span> <span class="s">"kddcup.data_10_percent.gz"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_file</span> <span class="o">=</span> <span class="s">"./kddcup.data_10_percent.gz"</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<h2 id="inspecting-interaction-duration-by-tag">Inspecting interaction duration by tag</h2>

<p>Both <code class="highlighter-rouge">fold</code> and <code class="highlighter-rouge">reduce</code> take a function as an argument that is applied to two elements of the RDD. The <code class="highlighter-rouge">fold</code> action differs from <code class="highlighter-rouge">reduce</code> in that it gets and additional initial <em>zero value</em> to be used for the initial call. This value should be the identity element for the function provided.</p>

<p>As an example, imagine we want to know the total duration of our interactions for normal and attack interactions. We can use <code class="highlighter-rouge">reduce</code> as follows.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># parse data</span>
<span class="n">csv_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">))</span>

<span class="c"># separate into different RDDs</span>
<span class="n">normal_csv_data</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span><span class="o">==</span><span class="s">"normal."</span><span class="p">)</span>
<span class="n">attack_csv_data</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span><span class="o">!=</span><span class="s">"normal."</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>The function that we pass to <code class="highlighter-rouge">reduce</code> gets and returns elements of the same type of the RDD. If we want to sum durations we need to extract that element into a new RDD.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">normal_duration_data</span> <span class="o">=</span> <span class="n">normal_csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">attack_duration_data</span> <span class="o">=</span> <span class="n">attack_csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Now we can reduce these new RDDs.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">total_normal_duration</span> <span class="o">=</span> <span class="n">normal_duration_data</span><span class="o">.</span><span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
<span class="n">total_attack_duration</span> <span class="o">=</span> <span class="n">attack_duration_data</span><span class="o">.</span><span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Total duration for 'normal' interactions is {}"</span><span class="o">.</span>\
    <span class="n">format</span><span class="p">(</span><span class="n">total_normal_duration</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"Total duration for 'attack' interactions is {}"</span><span class="o">.</span>\
    <span class="n">format</span><span class="p">(</span><span class="n">total_attack_duration</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Total duration for 'normal' interactions is 21075991
Total duration for 'attack' interactions is 2626792
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>We can go further and use counts to calculate duration means.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">normal_count</span> <span class="o">=</span> <span class="n">normal_duration_data</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">attack_count</span> <span class="o">=</span> <span class="n">attack_duration_data</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="k">print</span> <span class="s">"Mean duration for 'normal' interactions is {}"</span><span class="o">.</span>\
    <span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">total_normal_duration</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">normal_count</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">"Mean duration for 'attack' interactions is {}"</span><span class="o">.</span>\
    <span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">total_attack_duration</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">attack_count</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mean duration for 'normal' interactions is 216.657
Mean duration for 'attack' interactions is 6.621
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>We have a first (and too simplistic) approach to identify attack interactions.</p>

<h2 id="a-better-way-using-aggregate">A better way, using <code class="highlighter-rouge">aggregate</code></h2>

<p>The <code class="highlighter-rouge">aggregate</code> action frees us from the constraint of having the return be the same type as the RDD we are working on. Like with <code class="highlighter-rouge">fold</code>, we supply an initial zero value of the type we want to return. Then we provide two functions. The first one is used to combine the elements from our RDD with the accumulator. The second function is needed to merge two accumulators. Let’s see it in action calculating the mean we did before.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">normal_sum_count</span> <span class="o">=</span> <span class="n">normal_duration_data</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="c"># the initial value</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">value</span><span class="p">,</span> <span class="n">acc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="c"># combine value with acc</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="n">acc1</span><span class="p">,</span> <span class="n">acc2</span><span class="p">:</span> <span class="p">(</span><span class="n">acc1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">acc2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">acc1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">acc2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="c"># combine accumulators</span>
<span class="p">)</span>

<span class="k">print</span> <span class="s">"Mean duration for 'normal' interactions is {}"</span><span class="o">.</span>\
    <span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">normal_sum_count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">normal_sum_count</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mean duration for 'normal' interactions is 216.657
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>In the previous aggregation, the accumulator first element keeps the total sum, while the second element keeps the count. Combining an accumulator with an RDD element consists in summing up the value and incrementing the count. Combining two accumulators requires just a pairwise sum.</p>

<p>We can do the same with attack type interactions.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">attack_sum_count</span> <span class="o">=</span> <span class="n">attack_duration_data</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="c"># the initial value</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">value</span><span class="p">,</span> <span class="n">acc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="c"># combine value with acc</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="n">acc1</span><span class="p">,</span> <span class="n">acc2</span><span class="p">:</span> <span class="p">(</span><span class="n">acc1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">acc2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">acc1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">acc2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="c"># combine accumulators</span>
<span class="p">)</span>

<span class="k">print</span> <span class="s">"Mean duration for 'attack' interactions is {}"</span><span class="o">.</span>\
    <span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">attack_sum_count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">attack_sum_count</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mean duration for 'attack' interactions is 6.621
</code></pre></div>      </div>
    </div>
  </div>
</div>

<h1 id="working-with-keyvalue-pair-rdds">Working with key/value pair RDDs</h1>

<p>Spark provides specific functions to deal with RDDs which elements are key/value pairs. They are usually used to perform aggregations and other processings by key.</p>

<p>In this notebook we will show how, by working with key/value pairs, we can process our network interactions dataset in a more practical and powerful way than that used in previous notebooks. Key/value pair aggregations will show to be particularly effective when trying to explore each type of tag in our network attacks, in an individual way.</p>

<h2 id="getting-the-data-and-creating-the-rdd-4">Getting the data and creating the RDD</h2>

<p>As we did in our first notebook, we will use the reduced dataset (10 percent) provided for the <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html">KDD Cup 1999</a>, containing nearly half million network interactions. The file is provided as a Gzip file that we will download locally.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span> <span class="p">(</span><span class="s">"http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data_10_percent.gz"</span><span class="p">,</span> <span class="s">"kddcup.data_10_percent.gz"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_file</span> <span class="o">=</span> <span class="s">"./kddcup.data_10_percent.gz"</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<h2 id="creating-a-pair-rdd-for-interaction-types">Creating a pair RDD for interaction types</h2>

<p>In this notebook we want to do some exploratory data analysis on our network interactions dataset. More concretely we want to profile each network interaction type in terms of some of its variables such as duration. In order to do so, we first need to create the RDD suitable for that, where each interaction is parsed as a CSV row representing the value, and is put together with its corresponding tag as a key.</p>

<p>Normally we create key/value pair RDDs by applying a function using <code class="highlighter-rouge">map</code> to the original data. This function returns the corresponding pair for a given RDD element. We can proceed as follows.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">csv_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">))</span>
<span class="n">key_value_data</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">x</span><span class="p">))</span> <span class="c"># x[41] contains the network interaction tag</span>
</code></pre></div>    </div>
  </div>

</div>

<p>We have now our key/value pair data ready to be used. Let’s get the first element in order to see how it looks like.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">key_value_data</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[(u'normal.',
  [u'0',
   u'tcp',
   u'http',
   u'SF',
   u'181',
   u'5450',
   u'0',
   u'0',
   u'0',
   u'0',
   u'0',
   u'1',
   u'0',
   u'0',
   u'0',
   u'0',
   u'0',
   u'0',
   u'0',
   u'0',
   u'0',
   u'0',
   u'8',
   u'8',
   u'0.00',
   u'0.00',
   u'0.00',
   u'0.00',
   u'1.00',
   u'0.00',
   u'0.00',
   u'9',
   u'9',
   u'1.00',
   u'0.00',
   u'0.11',
   u'0.00',
   u'0.00',
   u'0.00',
   u'0.00',
   u'0.00',
   u'normal.'])]
</code></pre></div>      </div>

    </div>
  </div>
</div>

<h2 id="data-aggregations-with-keyvalue-pair-rdds">Data aggregations with key/value pair RDDs</h2>

<p>We can use all the transformations and actions available for normal RDDs with key/value pair RDDs. We just need to make the functions work with pair elements. Additionally, Spark provides specific functions to work with RDDs containing pair elements. They are very similar to those available for general RDDs.</p>

<p>For example, we have a <code class="highlighter-rouge">reduceByKey</code> transformation that we can use as follows to calculate the total duration of each network interaction type.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">key_value_duration</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span> 
<span class="n">durations_by_key</span> <span class="o">=</span> <span class="n">key_value_duration</span><span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>

<span class="n">durations_by_key</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[(u'guess_passwd.', 144.0),
 (u'nmap.', 0.0),
 (u'warezmaster.', 301.0),
 (u'rootkit.', 1008.0),
 (u'warezclient.', 627563.0),
 (u'smurf.', 0.0),
 (u'pod.', 0.0),
 (u'neptune.', 0.0),
 (u'normal.', 21075991.0),
 (u'spy.', 636.0),
 (u'ftp_write.', 259.0),
 (u'phf.', 18.0),
 (u'portsweep.', 1991911.0),
 (u'teardrop.', 0.0),
 (u'buffer_overflow.', 2751.0),
 (u'land.', 0.0),
 (u'imap.', 72.0),
 (u'loadmodule.', 326.0),
 (u'perl.', 124.0),
 (u'multihop.', 1288.0),
 (u'back.', 284.0),
 (u'ipsweep.', 43.0),
 (u'satan.', 64.0)]
</code></pre></div>      </div>

    </div>
  </div>
</div>

<p>We have a specific counting action for key/value pairs.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">counts_by_key</span> <span class="o">=</span> <span class="n">key_value_data</span><span class="o">.</span><span class="n">countByKey</span><span class="p">()</span>
<span class="n">counts_by_key</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>defaultdict(&lt;type 'int'&gt;, {u'guess_passwd.': 53, u'nmap.': 231, u'warezmaster.': 20, u'rootkit.': 10, u'warezclient.': 1020, u'smurf.': 280790, u'pod.': 264, u'neptune.': 107201, u'normal.': 97278, u'spy.': 2, u'ftp_write.': 8, u'phf.': 4, u'portsweep.': 1040, u'teardrop.': 979, u'buffer_overflow.': 30, u'land.': 21, u'imap.': 12, u'loadmodule.': 9, u'perl.': 3, u'multihop.': 7, u'back.': 2203, u'ipsweep.': 1247, u'satan.': 1589})
</code></pre></div>      </div>

    </div>
  </div>
</div>

<h3 id="using-combinebykey">Using <code class="highlighter-rouge">combineByKey</code></h3>

<p>This is the most general of the per-key aggregation functions. Most of the other per-key combiners are implemented using it. We can think about it as the <code class="highlighter-rouge">aggregate</code> equivalent since it allows the user to return values that are not the same type as our input data.</p>

<p>For example, we can use it to calculate per-type average durations as follows.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sum_counts</span> <span class="o">=</span> <span class="n">key_value_duration</span><span class="o">.</span><span class="n">combineByKey</span><span class="p">(</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="c"># the initial value, with value x and count 1</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">value</span><span class="p">,</span> <span class="n">acc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="c"># how to combine a pair value with the accumulator: sum value, and increment count</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="n">acc1</span><span class="p">,</span> <span class="n">acc2</span><span class="p">:</span> <span class="p">(</span><span class="n">acc1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">acc2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">acc1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">acc2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="c"># combine accumulators</span>
<span class="p">)</span>

<span class="n">sum_counts</span><span class="o">.</span><span class="n">collectAsMap</span><span class="p">()</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{u'back.': (284.0, 2203),
 u'buffer_overflow.': (2751.0, 30),
 u'ftp_write.': (259.0, 8),
 u'guess_passwd.': (144.0, 53),
 u'imap.': (72.0, 12),
 u'ipsweep.': (43.0, 1247),
 u'land.': (0.0, 21),
 u'loadmodule.': (326.0, 9),
 u'multihop.': (1288.0, 7),
 u'neptune.': (0.0, 107201),
 u'nmap.': (0.0, 231),
 u'normal.': (21075991.0, 97278),
 u'perl.': (124.0, 3),
 u'phf.': (18.0, 4),
 u'pod.': (0.0, 264),
 u'portsweep.': (1991911.0, 1040),
 u'rootkit.': (1008.0, 10),
 u'satan.': (64.0, 1589),
 u'smurf.': (0.0, 280790),
 u'spy.': (636.0, 2),
 u'teardrop.': (0.0, 979),
 u'warezclient.': (627563.0, 1020),
 u'warezmaster.': (301.0, 20)}
</code></pre></div>      </div>

    </div>
  </div>
</div>

<p>We can see that the arguments are pretty similar to those passed to <code class="highlighter-rouge">aggregate</code> in the previous notebook. The result associated to each type is in the form of a pair. If we want to actually get the averages, we need to do the division before collecting the results.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">duration_means_by_type</span> <span class="o">=</span> <span class="n">sum_counts</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">3</span><span class="p">)))</span><span class="o">.</span><span class="n">collectAsMap</span><span class="p">()</span>

<span class="c"># Print them sorted</span>
<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">duration_means_by_type</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">duration_means_by_type</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">tag</span><span class="p">,</span> <span class="n">duration_means_by_type</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>portsweep. 1915.299
warezclient. 615.258
spy. 318.0
normal. 216.657
multihop. 184.0
rootkit. 100.8
buffer_overflow. 91.7
perl. 41.333
loadmodule. 36.222
ftp_write. 32.375
warezmaster. 15.05
imap. 6.0
phf. 4.5
guess_passwd. 2.717
back. 0.129
satan. 0.04
ipsweep. 0.034
nmap. 0.0
smurf. 0.0
pod. 0.0
neptune. 0.0
teardrop. 0.0
land. 0.0
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>A small step into understanding what makes a network interaction be considered an attack.</p>

<h1 id="mllib-basic-statistics-and-exploratory-data-analysis">MLlib: Basic Statistics and Exploratory Data Analysis</h1>

<p>So far we have used different map and aggregation functions, on simple and key/value pair RDD’s, in order to get simple statistics that help us understand our datasets. In this notebook we will introduce Spark’s machine learning library <a href="https://spark.apache.org/docs/latest/mllib-guide.html">MLlib</a> through its basic statistics functionality in order to better understand our dataset. We will use the reduced 10-percent <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html">KDD Cup 1999</a> datasets through the notebook.</p>

<h2 id="getting-the-data-and-creating-the-rdd-5">Getting the data and creating the RDD</h2>

<p>As we did in our first notebook, we will use the reduced dataset (10 percent) provided for the <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html">KDD Cup 1999</a>, containing nearly half million network interactions. The file is provided as a Gzip file that we will download locally.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span> <span class="p">(</span><span class="s">"http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data_10_percent.gz"</span><span class="p">,</span> <span class="s">"kddcup.data_10_percent.gz"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_file</span> <span class="o">=</span> <span class="s">"./kddcup.data_10_percent.gz"</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<h2 id="local-vectors">Local vectors</h2>

<p>A <a href="https://spark.apache.org/docs/latest/mllib-data-types.html#local-vector">local vector</a> is often used as a base type for RDDs in Spark MLlib. A local vector has integer-typed and 0-based indices and double-typed values, stored on a single machine. MLlib supports two types of local vectors: dense and sparse. A dense vector is backed by a double array representing its entry values, while a sparse vector is backed by two parallel arrays: indices and values.</p>

<p>For dense vectors, MLlib uses either Python <em>lists</em> or the <em>NumPy</em> <code class="highlighter-rouge">array</code> type. The later is recommended, so you can simply pass NumPy arrays around.</p>

<p>For sparse vectors, users can construct a <code class="highlighter-rouge">SparseVector</code> object from MLlib or pass <em>SciPy</em> <code class="highlighter-rouge">scipy.sparse</code> column vectors if SciPy is available in their environment. The easiest way to create sparse vectors is to use the factory methods implemented in <code class="highlighter-rouge">Vectors</code>.</p>

<h3 id="an-rdd-of-dense-vectors">An RDD of dense vectors</h3>

<p>Let’s represent each network interaction in our dataset as a dense vector. For that we will use the <em>NumPy</em> <code class="highlighter-rouge">array</code> type.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">def</span> <span class="nf">parse_interaction</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">line_split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
    <span class="c"># keep just numeric and logical values</span>
    <span class="n">symbolic_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">41</span><span class="p">]</span>
    <span class="n">clean_line_split</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line_split</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">symbolic_indexes</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clean_line_split</span><span class="p">])</span>

<span class="n">vector_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">parse_interaction</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<h2 id="summary-statistics">Summary statistics</h2>

<p>Spark’s MLlib provides column summary statistics for <code class="highlighter-rouge">RDD[Vector]</code> through the function <a href="https://spark.apache.org/docs/latest/api/python/pyspark.mllib.html#pyspark.mllib.stat.Statistics.colStats"><code class="highlighter-rouge">colStats</code></a> available in <a href="https://spark.apache.org/docs/latest/api/python/pyspark.mllib.html#pyspark.mllib.stat.Statistics"><code class="highlighter-rouge">Statistics</code></a>. The method returns an instance of <a href="https://spark.apache.org/docs/latest/api/python/pyspark.mllib.html#pyspark.mllib.stat.MultivariateStatisticalSummary"><code class="highlighter-rouge">MultivariateStatisticalSummary</code></a>, which contains the column-wise <em>max</em>, <em>min</em>, <em>mean</em>, <em>variance</em>, and <em>number of nonzeros</em>, as well as the <em>total count</em>.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.mllib.stat</span> <span class="kn">import</span> <span class="n">Statistics</span> 
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span> 

<span class="c"># Compute column summary statistics.</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">Statistics</span><span class="o">.</span><span class="n">colStats</span><span class="p">(</span><span class="n">vector_data</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Duration Statistics:"</span>
<span class="k">print</span> <span class="s">" Mean: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">" St. deviation: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">variance</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">" Max value: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="nb">max</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">" Min value: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="nb">min</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">" Total value count: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="k">print</span> <span class="s">" Number of non-zero values: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">numNonzeros</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Duration Statistics:
 Mean: 47.979
 St. deviation: 707.746
 Max value: 58329.0
 Min value: 0.0
 Total value count: 494021
 Number of non-zero values: 12350.0
</code></pre></div>      </div>
    </div>
  </div>
</div>

<h3 id="summary-statistics-by-label">Summary statistics by label</h3>

<p>The interesting part of summary statistics, in our case, comes from being able to obtain them by the type of network attack or ‘label’ in our dataset. By doing so we will be able to better characterise our dataset dependent variable in terms of the independent variables range of values.</p>

<p>If we want to do such a thing we could filter our RDD containing labels as keys and vectors as values. For that we just need to adapt our <code class="highlighter-rouge">parse_interaction</code> function to return a tuple with both elements.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse_interaction_with_key</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">line_split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
    <span class="c"># keep just numeric and logical values</span>
    <span class="n">symbolic_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">41</span><span class="p">]</span>
    <span class="n">clean_line_split</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line_split</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">symbolic_indexes</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clean_line_split</span><span class="p">]))</span>

<span class="n">label_vector_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">parse_interaction_with_key</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>The next step is not very sophisticated. We use <code class="highlighter-rouge">filter</code> on the RDD to leave out other labels but the one we want to gather statistics from.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">normal_label_data</span> <span class="o">=</span> <span class="n">label_vector_data</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">"normal."</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Now we can use the new RDD to call <code class="highlighter-rouge">colStats</code> on the values.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">normal_summary</span> <span class="o">=</span> <span class="n">Statistics</span><span class="o">.</span><span class="n">colStats</span><span class="p">(</span><span class="n">normal_label_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div>    </div>
  </div>

</div>

<p>And collect the results as we did before.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="s">"Duration Statistics for label: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">"normal"</span><span class="p">)</span>
<span class="k">print</span> <span class="s">" Mean: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normal_summary</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span>
<span class="k">print</span> <span class="s">" St. deviation: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">normal_summary</span><span class="o">.</span><span class="n">variance</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">" Max value: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">normal_summary</span><span class="o">.</span><span class="nb">max</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">" Min value: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">normal_summary</span><span class="o">.</span><span class="nb">min</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">" Total value count: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normal_summary</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="k">print</span> <span class="s">" Number of non-zero values: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normal_summary</span><span class="o">.</span><span class="n">numNonzeros</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Duration Statistics for label: normal
 Mean: 216.657322313
 St. deviation: 1359.213
 Max value: 58329.0
 Min value: 0.0
 Total value count: 97278
 Number of non-zero values: 11690.0
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>Instead of working with a key/value pair we could have just filter our raw data split using the label in column 41. Then we can parse the results as we did before. This will work as well. However having our data organised as key/value pairs will open the door to better manipulations. Since <code class="highlighter-rouge">values()</code> is a transformation on an RDD, and not an action, we don’t perform any computation until we call <code class="highlighter-rouge">colStats</code> anyway.</p>

<p>But lets wrap this within a function so we can reuse it with any label.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">summary_by_label</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">label_vector_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">parse_interaction_with_key</span><span class="p">)</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Statistics</span><span class="o">.</span><span class="n">colStats</span><span class="p">(</span><span class="n">label_vector_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Let’s give it a try with the “normal.” label again.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">normal_sum</span> <span class="o">=</span> <span class="n">summary_by_label</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="s">"normal."</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Duration Statistics for label: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">"normal"</span><span class="p">)</span>
<span class="k">print</span> <span class="s">" Mean: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normal_sum</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span>
<span class="k">print</span> <span class="s">" St. deviation: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">normal_sum</span><span class="o">.</span><span class="n">variance</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">" Max value: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">normal_sum</span><span class="o">.</span><span class="nb">max</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">" Min value: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">normal_sum</span><span class="o">.</span><span class="nb">min</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">" Total value count: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normal_sum</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="k">print</span> <span class="s">" Number of non-zero values: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normal_sum</span><span class="o">.</span><span class="n">numNonzeros</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Duration Statistics for label: normal
 Mean: 216.657322313
 St. deviation: 1359.213
 Max value: 58329.0
 Min value: 0.0
 Total value count: 97278
 Number of non-zero values: 11690.0
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>Let’s try now with some network attack. We have all of them listed <a href="http://kdd.ics.uci.edu/databases/kddcup99/training_attack_types">here</a>.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">guess_passwd_summary</span> <span class="o">=</span> <span class="n">summary_by_label</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="s">"guess_passwd."</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Duration Statistics for label: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">"guess_password"</span><span class="p">)</span>
<span class="k">print</span> <span class="s">" Mean: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">guess_passwd_summary</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span>
<span class="k">print</span> <span class="s">" St. deviation: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">guess_passwd_summary</span><span class="o">.</span><span class="n">variance</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">" Max value: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">guess_passwd_summary</span><span class="o">.</span><span class="nb">max</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">" Min value: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">guess_passwd_summary</span><span class="o">.</span><span class="nb">min</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="s">" Total value count: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">guess_passwd_summary</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="k">print</span> <span class="s">" Number of non-zero values: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">guess_passwd_summary</span><span class="o">.</span><span class="n">numNonzeros</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Duration Statistics for label: guess_password
 Mean: 2.71698113208
 St. deviation: 11.88
 Max value: 60.0
 Min value: 0.0
 Total value count: 53
 Number of non-zero values: 4.0
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>We can see that this type of attack is shorter in duration than a normal interaction. We could build a table with duration statistics for each type of interaction in our dataset. First we need to get a list of labels as described in the first line <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup.names">here</a>.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">"back."</span><span class="p">,</span><span class="s">"buffer_overflow."</span><span class="p">,</span><span class="s">"ftp_write."</span><span class="p">,</span><span class="s">"guess_passwd."</span><span class="p">,</span>
              <span class="s">"imap."</span><span class="p">,</span><span class="s">"ipsweep."</span><span class="p">,</span><span class="s">"land."</span><span class="p">,</span><span class="s">"loadmodule."</span><span class="p">,</span><span class="s">"multihop."</span><span class="p">,</span>
              <span class="s">"neptune."</span><span class="p">,</span><span class="s">"nmap."</span><span class="p">,</span><span class="s">"normal."</span><span class="p">,</span><span class="s">"perl."</span><span class="p">,</span><span class="s">"phf."</span><span class="p">,</span><span class="s">"pod."</span><span class="p">,</span><span class="s">"portsweep."</span><span class="p">,</span>
              <span class="s">"rootkit."</span><span class="p">,</span><span class="s">"satan."</span><span class="p">,</span><span class="s">"smurf."</span><span class="p">,</span><span class="s">"spy."</span><span class="p">,</span><span class="s">"teardrop."</span><span class="p">,</span><span class="s">"warezclient."</span><span class="p">,</span>
              <span class="s">"warezmaster."</span><span class="p">]</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Then we get a list of statistics for each label.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stats_by_label</span> <span class="o">=</span> <span class="p">[(</span><span class="n">label</span><span class="p">,</span> <span class="n">summary_by_label</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_list</span><span class="p">]</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Now we get the <em>duration</em> column, first in our dataset (i.e. index 0).</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">duration_by_label</span> <span class="o">=</span> <span class="p">[</span> 
    <span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">variance</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span> <span class="nb">float</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="nb">min</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="nb">max</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">())]))</span> 
    <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stats_by_label</span><span class="p">]</span>
</code></pre></div>    </div>
  </div>

</div>

<p>That we can put into a Pandas data frame.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'display.max_columns'</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="n">stats_by_label_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_items</span><span class="p">(</span><span class="n">duration_by_label</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">"Mean"</span><span class="p">,</span> <span class="s">"Std Dev"</span><span class="p">,</span> <span class="s">"Min"</span><span class="p">,</span> <span class="s">"Max"</span><span class="p">,</span> <span class="s">"Count"</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s">'index'</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>And print it.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="s">"Duration statistics, by label"</span>
<span class="n">stats_by_label_df</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Duration statistics, by label
</code></pre></div>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output output_html">
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean</th>
      <th>Std Dev</th>
      <th>Min</th>
      <th>Max</th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>back.</th>
      <td>    0.128915</td>
      <td>    1.110062</td>
      <td>   0</td>
      <td>    14</td>
      <td>   2203</td>
    </tr>
    <tr>
      <th>buffer_overflow.</th>
      <td>   91.700000</td>
      <td>   97.514685</td>
      <td>   0</td>
      <td>   321</td>
      <td>     30</td>
    </tr>
    <tr>
      <th>ftp_write.</th>
      <td>   32.375000</td>
      <td>   47.449033</td>
      <td>   0</td>
      <td>   134</td>
      <td>      8</td>
    </tr>
    <tr>
      <th>guess_passwd.</th>
      <td>    2.716981</td>
      <td>   11.879811</td>
      <td>   0</td>
      <td>    60</td>
      <td>     53</td>
    </tr>
    <tr>
      <th>imap.</th>
      <td>    6.000000</td>
      <td>   14.174240</td>
      <td>   0</td>
      <td>    41</td>
      <td>     12</td>
    </tr>
    <tr>
      <th>ipsweep.</th>
      <td>    0.034483</td>
      <td>    0.438439</td>
      <td>   0</td>
      <td>     7</td>
      <td>   1247</td>
    </tr>
    <tr>
      <th>land.</th>
      <td>    0.000000</td>
      <td>    0.000000</td>
      <td>   0</td>
      <td>     0</td>
      <td>     21</td>
    </tr>
    <tr>
      <th>loadmodule.</th>
      <td>   36.222222</td>
      <td>   41.408869</td>
      <td>   0</td>
      <td>   103</td>
      <td>      9</td>
    </tr>
    <tr>
      <th>multihop.</th>
      <td>  184.000000</td>
      <td>  253.851006</td>
      <td>   0</td>
      <td>   718</td>
      <td>      7</td>
    </tr>
    <tr>
      <th>neptune.</th>
      <td>    0.000000</td>
      <td>    0.000000</td>
      <td>   0</td>
      <td>     0</td>
      <td> 107201</td>
    </tr>
    <tr>
      <th>nmap.</th>
      <td>    0.000000</td>
      <td>    0.000000</td>
      <td>   0</td>
      <td>     0</td>
      <td>    231</td>
    </tr>
    <tr>
      <th>normal.</th>
      <td>  216.657322</td>
      <td> 1359.213469</td>
      <td>   0</td>
      <td> 58329</td>
      <td>  97278</td>
    </tr>
    <tr>
      <th>perl.</th>
      <td>   41.333333</td>
      <td>   14.843629</td>
      <td>  25</td>
      <td>    54</td>
      <td>      3</td>
    </tr>
    <tr>
      <th>phf.</th>
      <td>    4.500000</td>
      <td>    5.744563</td>
      <td>   0</td>
      <td>    12</td>
      <td>      4</td>
    </tr>
    <tr>
      <th>pod.</th>
      <td>    0.000000</td>
      <td>    0.000000</td>
      <td>   0</td>
      <td>     0</td>
      <td>    264</td>
    </tr>
    <tr>
      <th>portsweep.</th>
      <td> 1915.299038</td>
      <td> 7285.125159</td>
      <td>   0</td>
      <td> 42448</td>
      <td>   1040</td>
    </tr>
    <tr>
      <th>rootkit.</th>
      <td>  100.800000</td>
      <td>  216.185003</td>
      <td>   0</td>
      <td>   708</td>
      <td>     10</td>
    </tr>
    <tr>
      <th>satan.</th>
      <td>    0.040277</td>
      <td>    0.522433</td>
      <td>   0</td>
      <td>    11</td>
      <td>   1589</td>
    </tr>
    <tr>
      <th>smurf.</th>
      <td>    0.000000</td>
      <td>    0.000000</td>
      <td>   0</td>
      <td>     0</td>
      <td> 280790</td>
    </tr>
    <tr>
      <th>spy.</th>
      <td>  318.000000</td>
      <td>   26.870058</td>
      <td> 299</td>
      <td>   337</td>
      <td>      2</td>
    </tr>
    <tr>
      <th>teardrop.</th>
      <td>    0.000000</td>
      <td>    0.000000</td>
      <td>   0</td>
      <td>     0</td>
      <td>    979</td>
    </tr>
    <tr>
      <th>warezclient.</th>
      <td>  615.257843</td>
      <td> 2207.694966</td>
      <td>   0</td>
      <td> 15168</td>
      <td>   1020</td>
    </tr>
    <tr>
      <th>warezmaster.</th>
      <td>   15.050000</td>
      <td>   33.385271</td>
      <td>   0</td>
      <td>   156</td>
      <td>     20</td>
    </tr>
  </tbody>
</table>
</div>
</div>

    </div>
  </div>
</div>

<p>In order to reuse this code and get a dataframe from any variable in our dataset we will define a function.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_variable_stats_df</span><span class="p">(</span><span class="n">stats_by_label</span><span class="p">,</span> <span class="n">column_i</span><span class="p">):</span>
    <span class="n">column_stats_by_label</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">column_i</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">variance</span><span class="p">()[</span><span class="n">column_i</span><span class="p">])),</span> <span class="nb">float</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="nb">min</span><span class="p">()[</span><span class="n">column_i</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="nb">max</span><span class="p">()[</span><span class="n">column_i</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">stat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">())]))</span> 
        <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stats_by_label</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_items</span><span class="p">(</span><span class="n">column_stats_by_label</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">"Mean"</span><span class="p">,</span> <span class="s">"Std Dev"</span><span class="p">,</span> <span class="s">"Min"</span><span class="p">,</span> <span class="s">"Max"</span><span class="p">,</span> <span class="s">"Count"</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s">'index'</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Let’s try for <em>duration</em> again.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get_variable_stats_df</span><span class="p">(</span><span class="n">stats_by_label</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output output_html">
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean</th>
      <th>Std Dev</th>
      <th>Min</th>
      <th>Max</th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>back.</th>
      <td>    0.128915</td>
      <td>    1.110062</td>
      <td>   0</td>
      <td>    14</td>
      <td>   2203</td>
    </tr>
    <tr>
      <th>buffer_overflow.</th>
      <td>   91.700000</td>
      <td>   97.514685</td>
      <td>   0</td>
      <td>   321</td>
      <td>     30</td>
    </tr>
    <tr>
      <th>ftp_write.</th>
      <td>   32.375000</td>
      <td>   47.449033</td>
      <td>   0</td>
      <td>   134</td>
      <td>      8</td>
    </tr>
    <tr>
      <th>guess_passwd.</th>
      <td>    2.716981</td>
      <td>   11.879811</td>
      <td>   0</td>
      <td>    60</td>
      <td>     53</td>
    </tr>
    <tr>
      <th>imap.</th>
      <td>    6.000000</td>
      <td>   14.174240</td>
      <td>   0</td>
      <td>    41</td>
      <td>     12</td>
    </tr>
    <tr>
      <th>ipsweep.</th>
      <td>    0.034483</td>
      <td>    0.438439</td>
      <td>   0</td>
      <td>     7</td>
      <td>   1247</td>
    </tr>
    <tr>
      <th>land.</th>
      <td>    0.000000</td>
      <td>    0.000000</td>
      <td>   0</td>
      <td>     0</td>
      <td>     21</td>
    </tr>
    <tr>
      <th>loadmodule.</th>
      <td>   36.222222</td>
      <td>   41.408869</td>
      <td>   0</td>
      <td>   103</td>
      <td>      9</td>
    </tr>
    <tr>
      <th>multihop.</th>
      <td>  184.000000</td>
      <td>  253.851006</td>
      <td>   0</td>
      <td>   718</td>
      <td>      7</td>
    </tr>
    <tr>
      <th>neptune.</th>
      <td>    0.000000</td>
      <td>    0.000000</td>
      <td>   0</td>
      <td>     0</td>
      <td> 107201</td>
    </tr>
    <tr>
      <th>nmap.</th>
      <td>    0.000000</td>
      <td>    0.000000</td>
      <td>   0</td>
      <td>     0</td>
      <td>    231</td>
    </tr>
    <tr>
      <th>normal.</th>
      <td>  216.657322</td>
      <td> 1359.213469</td>
      <td>   0</td>
      <td> 58329</td>
      <td>  97278</td>
    </tr>
    <tr>
      <th>perl.</th>
      <td>   41.333333</td>
      <td>   14.843629</td>
      <td>  25</td>
      <td>    54</td>
      <td>      3</td>
    </tr>
    <tr>
      <th>phf.</th>
      <td>    4.500000</td>
      <td>    5.744563</td>
      <td>   0</td>
      <td>    12</td>
      <td>      4</td>
    </tr>
    <tr>
      <th>pod.</th>
      <td>    0.000000</td>
      <td>    0.000000</td>
      <td>   0</td>
      <td>     0</td>
      <td>    264</td>
    </tr>
    <tr>
      <th>portsweep.</th>
      <td> 1915.299038</td>
      <td> 7285.125159</td>
      <td>   0</td>
      <td> 42448</td>
      <td>   1040</td>
    </tr>
    <tr>
      <th>rootkit.</th>
      <td>  100.800000</td>
      <td>  216.185003</td>
      <td>   0</td>
      <td>   708</td>
      <td>     10</td>
    </tr>
    <tr>
      <th>satan.</th>
      <td>    0.040277</td>
      <td>    0.522433</td>
      <td>   0</td>
      <td>    11</td>
      <td>   1589</td>
    </tr>
    <tr>
      <th>smurf.</th>
      <td>    0.000000</td>
      <td>    0.000000</td>
      <td>   0</td>
      <td>     0</td>
      <td> 280790</td>
    </tr>
    <tr>
      <th>spy.</th>
      <td>  318.000000</td>
      <td>   26.870058</td>
      <td> 299</td>
      <td>   337</td>
      <td>      2</td>
    </tr>
    <tr>
      <th>teardrop.</th>
      <td>    0.000000</td>
      <td>    0.000000</td>
      <td>   0</td>
      <td>     0</td>
      <td>    979</td>
    </tr>
    <tr>
      <th>warezclient.</th>
      <td>  615.257843</td>
      <td> 2207.694966</td>
      <td>   0</td>
      <td> 15168</td>
      <td>   1020</td>
    </tr>
    <tr>
      <th>warezmaster.</th>
      <td>   15.050000</td>
      <td>   33.385271</td>
      <td>   0</td>
      <td>   156</td>
      <td>     20</td>
    </tr>
  </tbody>
</table>
</div>
</div>

    </div>
  </div>
</div>

<p>Now for the next numeric column in the dataset, <em>src_bytes</em>.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="s">"src_bytes statistics, by label"</span>
<span class="n">get_variable_stats_df</span><span class="p">(</span><span class="n">stats_by_label</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src_bytes statistics, by label
</code></pre></div>      </div>
    </div>
  </div>
  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output output_html">
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean</th>
      <th>Std Dev</th>
      <th>Min</th>
      <th>Max</th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>back.</th>
      <td>  54156.355878</td>
      <td>     3159.360232</td>
      <td> 13140</td>
      <td>     54540</td>
      <td>   2203</td>
    </tr>
    <tr>
      <th>buffer_overflow.</th>
      <td>   1400.433333</td>
      <td>     1337.132616</td>
      <td>     0</td>
      <td>      6274</td>
      <td>     30</td>
    </tr>
    <tr>
      <th>ftp_write.</th>
      <td>    220.750000</td>
      <td>      267.747616</td>
      <td>     0</td>
      <td>       676</td>
      <td>      8</td>
    </tr>
    <tr>
      <th>guess_passwd.</th>
      <td>    125.339623</td>
      <td>        3.037860</td>
      <td>   104</td>
      <td>       126</td>
      <td>     53</td>
    </tr>
    <tr>
      <th>imap.</th>
      <td>    347.583333</td>
      <td>      629.926036</td>
      <td>     0</td>
      <td>      1492</td>
      <td>     12</td>
    </tr>
    <tr>
      <th>ipsweep.</th>
      <td>     10.083400</td>
      <td>        5.231658</td>
      <td>     0</td>
      <td>        18</td>
      <td>   1247</td>
    </tr>
    <tr>
      <th>land.</th>
      <td>      0.000000</td>
      <td>        0.000000</td>
      <td>     0</td>
      <td>         0</td>
      <td>     21</td>
    </tr>
    <tr>
      <th>loadmodule.</th>
      <td>    151.888889</td>
      <td>      127.745298</td>
      <td>     0</td>
      <td>       302</td>
      <td>      9</td>
    </tr>
    <tr>
      <th>multihop.</th>
      <td>    435.142857</td>
      <td>      540.960389</td>
      <td>     0</td>
      <td>      1412</td>
      <td>      7</td>
    </tr>
    <tr>
      <th>neptune.</th>
      <td>      0.000000</td>
      <td>        0.000000</td>
      <td>     0</td>
      <td>         0</td>
      <td> 107201</td>
    </tr>
    <tr>
      <th>nmap.</th>
      <td>     24.116883</td>
      <td>       59.419871</td>
      <td>     0</td>
      <td>       207</td>
      <td>    231</td>
    </tr>
    <tr>
      <th>normal.</th>
      <td>   1157.047524</td>
      <td>    34226.124718</td>
      <td>     0</td>
      <td>   2194619</td>
      <td>  97278</td>
    </tr>
    <tr>
      <th>perl.</th>
      <td>    265.666667</td>
      <td>        4.932883</td>
      <td>   260</td>
      <td>       269</td>
      <td>      3</td>
    </tr>
    <tr>
      <th>phf.</th>
      <td>     51.000000</td>
      <td>        0.000000</td>
      <td>    51</td>
      <td>        51</td>
      <td>      4</td>
    </tr>
    <tr>
      <th>pod.</th>
      <td>   1462.651515</td>
      <td>      125.098044</td>
      <td>   564</td>
      <td>      1480</td>
      <td>    264</td>
    </tr>
    <tr>
      <th>portsweep.</th>
      <td> 666707.436538</td>
      <td> 21500665.866700</td>
      <td>     0</td>
      <td> 693375640</td>
      <td>   1040</td>
    </tr>
    <tr>
      <th>rootkit.</th>
      <td>    294.700000</td>
      <td>      538.578180</td>
      <td>     0</td>
      <td>      1727</td>
      <td>     10</td>
    </tr>
    <tr>
      <th>satan.</th>
      <td>      1.337319</td>
      <td>       42.946200</td>
      <td>     0</td>
      <td>      1710</td>
      <td>   1589</td>
    </tr>
    <tr>
      <th>smurf.</th>
      <td>    935.772300</td>
      <td>      200.022386</td>
      <td>   520</td>
      <td>      1032</td>
      <td> 280790</td>
    </tr>
    <tr>
      <th>spy.</th>
      <td>    174.500000</td>
      <td>       88.388348</td>
      <td>   112</td>
      <td>       237</td>
      <td>      2</td>
    </tr>
    <tr>
      <th>teardrop.</th>
      <td>     28.000000</td>
      <td>        0.000000</td>
      <td>    28</td>
      <td>        28</td>
      <td>    979</td>
    </tr>
    <tr>
      <th>warezclient.</th>
      <td> 300219.562745</td>
      <td>  1200905.243130</td>
      <td>    30</td>
      <td>   5135678</td>
      <td>   1020</td>
    </tr>
    <tr>
      <th>warezmaster.</th>
      <td>     49.300000</td>
      <td>      212.155132</td>
      <td>     0</td>
      <td>       950</td>
      <td>     20</td>
    </tr>
  </tbody>
</table>
</div>
</div>

    </div>
  </div>
</div>

<p>And so on. By reusing the <code class="highlighter-rouge">summary_by_label</code> and <code class="highlighter-rouge">get_variable_stats_df</code> functions we can perform some exploratory data analysis in large datasets with Spark.</p>

<h2 id="correlations">Correlations</h2>

<p>Spark’s MLlib supports <a href="http://en.wikipedia.org/wiki/Pearson_product-moment_correlation_coefficient">Pearson’s</a> and <a href="http://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient">Spearman’s</a> to calculate pairwise correlation methods among many series. Both of them are provided by the <code class="highlighter-rouge">corr</code> method in the <code class="highlighter-rouge">Statistics</code> package.</p>

<p>We have two options as input. Either two <code class="highlighter-rouge">RDD[Double]</code>s or an <code class="highlighter-rouge">RDD[Vector]</code>. In the first case the output will be a <code class="highlighter-rouge">Double</code> value, while in the second a whole correlation Matrix. Due to the nature of our data, we will obtain the second.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.mllib.stat</span> <span class="kn">import</span> <span class="n">Statistics</span> 
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">Statistics</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">vector_data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">"spearman"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Once we have the correlations ready, we can start inspecting their values.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'display.max_columns'</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="n">col_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">"duration"</span><span class="p">,</span><span class="s">"src_bytes"</span><span class="p">,</span><span class="s">"dst_bytes"</span><span class="p">,</span><span class="s">"land"</span><span class="p">,</span><span class="s">"wrong_fragment"</span><span class="p">,</span>
             <span class="s">"urgent"</span><span class="p">,</span><span class="s">"hot"</span><span class="p">,</span><span class="s">"num_failed_logins"</span><span class="p">,</span><span class="s">"logged_in"</span><span class="p">,</span><span class="s">"num_compromised"</span><span class="p">,</span>
             <span class="s">"root_shell"</span><span class="p">,</span><span class="s">"su_attempted"</span><span class="p">,</span><span class="s">"num_root"</span><span class="p">,</span><span class="s">"num_file_creations"</span><span class="p">,</span>
             <span class="s">"num_shells"</span><span class="p">,</span><span class="s">"num_access_files"</span><span class="p">,</span><span class="s">"num_outbound_cmds"</span><span class="p">,</span>
             <span class="s">"is_hot_login"</span><span class="p">,</span><span class="s">"is_guest_login"</span><span class="p">,</span><span class="s">"count"</span><span class="p">,</span><span class="s">"srv_count"</span><span class="p">,</span><span class="s">"serror_rate"</span><span class="p">,</span>
             <span class="s">"srv_serror_rate"</span><span class="p">,</span><span class="s">"rerror_rate"</span><span class="p">,</span><span class="s">"srv_rerror_rate"</span><span class="p">,</span><span class="s">"same_srv_rate"</span><span class="p">,</span>
             <span class="s">"diff_srv_rate"</span><span class="p">,</span><span class="s">"srv_diff_host_rate"</span><span class="p">,</span><span class="s">"dst_host_count"</span><span class="p">,</span><span class="s">"dst_host_srv_count"</span><span class="p">,</span>
             <span class="s">"dst_host_same_srv_rate"</span><span class="p">,</span><span class="s">"dst_host_diff_srv_rate"</span><span class="p">,</span><span class="s">"dst_host_same_src_port_rate"</span><span class="p">,</span>
             <span class="s">"dst_host_srv_diff_host_rate"</span><span class="p">,</span><span class="s">"dst_host_serror_rate"</span><span class="p">,</span><span class="s">"dst_host_srv_serror_rate"</span><span class="p">,</span>
             <span class="s">"dst_host_rerror_rate"</span><span class="p">,</span><span class="s">"dst_host_srv_rerror_rate"</span><span class="p">]</span>

<span class="n">corr_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">col_names</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">col_names</span><span class="p">)</span>

<span class="n">corr_df</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output output_html">
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>duration</th>
      <th>src_bytes</th>
      <th>dst_bytes</th>
      <th>land</th>
      <th>wrong_fragment</th>
      <th>urgent</th>
      <th>hot</th>
      <th>num_failed_logins</th>
      <th>logged_in</th>
      <th>num_compromised</th>
      <th>root_shell</th>
      <th>su_attempted</th>
      <th>num_root</th>
      <th>num_file_creations</th>
      <th>num_shells</th>
      <th>num_access_files</th>
      <th>num_outbound_cmds</th>
      <th>is_hot_login</th>
      <th>is_guest_login</th>
      <th>count</th>
      <th>srv_count</th>
      <th>serror_rate</th>
      <th>srv_serror_rate</th>
      <th>rerror_rate</th>
      <th>srv_rerror_rate</th>
      <th>same_srv_rate</th>
      <th>diff_srv_rate</th>
      <th>srv_diff_host_rate</th>
      <th>dst_host_count</th>
      <th>dst_host_srv_count</th>
      <th>dst_host_same_srv_rate</th>
      <th>dst_host_diff_srv_rate</th>
      <th>dst_host_same_src_port_rate</th>
      <th>dst_host_srv_diff_host_rate</th>
      <th>dst_host_serror_rate</th>
      <th>dst_host_srv_serror_rate</th>
      <th>dst_host_rerror_rate</th>
      <th>dst_host_srv_rerror_rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>duration</th>
      <td> 1.000000</td>
      <td> 0.014196</td>
      <td> 0.299189</td>
      <td>-0.001068</td>
      <td>-0.008025</td>
      <td> 0.017883</td>
      <td> 0.108639</td>
      <td> 0.014363</td>
      <td> 0.159564</td>
      <td> 0.010687</td>
      <td> 0.040425</td>
      <td> 0.026015</td>
      <td> 0.013401</td>
      <td> 0.061099</td>
      <td> 0.008632</td>
      <td> 0.019407</td>
      <td>-0.000019</td>
      <td>-0.000010</td>
      <td> 0.205606</td>
      <td>-0.259032</td>
      <td>-0.250139</td>
      <td>-0.074211</td>
      <td>-0.073663</td>
      <td>-0.025936</td>
      <td>-0.026420</td>
      <td> 0.062291</td>
      <td>-0.050875</td>
      <td> 0.123621</td>
      <td>-0.161107</td>
      <td>-0.217167</td>
      <td>-0.211979</td>
      <td> 0.231644</td>
      <td>-0.065202</td>
      <td> 0.100692</td>
      <td>-0.056753</td>
      <td>-0.057298</td>
      <td>-0.007759</td>
      <td>-0.013891</td>
    </tr>
    <tr>
      <th>src_bytes</th>
      <td> 0.014196</td>
      <td> 1.000000</td>
      <td>-0.167931</td>
      <td>-0.009404</td>
      <td>-0.019358</td>
      <td> 0.000094</td>
      <td> 0.113920</td>
      <td>-0.008396</td>
      <td>-0.089702</td>
      <td> 0.118562</td>
      <td> 0.003067</td>
      <td> 0.002282</td>
      <td>-0.002050</td>
      <td> 0.027710</td>
      <td> 0.014403</td>
      <td>-0.001497</td>
      <td> 0.000010</td>
      <td> 0.000019</td>
      <td> 0.027511</td>
      <td> 0.666230</td>
      <td> 0.722609</td>
      <td>-0.657460</td>
      <td>-0.652391</td>
      <td>-0.342180</td>
      <td>-0.332977</td>
      <td> 0.744046</td>
      <td>-0.739988</td>
      <td>-0.104042</td>
      <td> 0.130377</td>
      <td> 0.741979</td>
      <td> 0.729151</td>
      <td>-0.712965</td>
      <td> 0.815039</td>
      <td>-0.140231</td>
      <td>-0.645920</td>
      <td>-0.641792</td>
      <td>-0.297338</td>
      <td>-0.300581</td>
    </tr>
    <tr>
      <th>dst_bytes</th>
      <td> 0.299189</td>
      <td>-0.167931</td>
      <td> 1.000000</td>
      <td>-0.003040</td>
      <td>-0.022659</td>
      <td> 0.007234</td>
      <td> 0.193156</td>
      <td> 0.021952</td>
      <td> 0.882185</td>
      <td> 0.169772</td>
      <td> 0.026054</td>
      <td> 0.012192</td>
      <td>-0.003884</td>
      <td> 0.034154</td>
      <td>-0.000054</td>
      <td> 0.065776</td>
      <td>-0.000031</td>
      <td> 0.000041</td>
      <td> 0.085947</td>
      <td>-0.639157</td>
      <td>-0.497683</td>
      <td>-0.205848</td>
      <td>-0.198715</td>
      <td>-0.100958</td>
      <td>-0.081307</td>
      <td> 0.229677</td>
      <td>-0.222572</td>
      <td> 0.521003</td>
      <td>-0.611972</td>
      <td> 0.024124</td>
      <td> 0.055033</td>
      <td>-0.035073</td>
      <td>-0.396195</td>
      <td> 0.578557</td>
      <td>-0.167047</td>
      <td>-0.158378</td>
      <td>-0.003042</td>
      <td> 0.001621</td>
    </tr>
    <tr>
      <th>land</th>
      <td>-0.001068</td>
      <td>-0.009404</td>
      <td>-0.003040</td>
      <td> 1.000000</td>
      <td>-0.000333</td>
      <td>-0.000065</td>
      <td>-0.000539</td>
      <td>-0.000076</td>
      <td>-0.002785</td>
      <td>-0.000447</td>
      <td>-0.000093</td>
      <td>-0.000049</td>
      <td>-0.000230</td>
      <td>-0.000150</td>
      <td>-0.000076</td>
      <td>-0.000211</td>
      <td>-0.002881</td>
      <td> 0.002089</td>
      <td>-0.000250</td>
      <td>-0.010939</td>
      <td>-0.010128</td>
      <td> 0.014160</td>
      <td> 0.014342</td>
      <td>-0.000451</td>
      <td>-0.001690</td>
      <td> 0.002153</td>
      <td>-0.001846</td>
      <td> 0.020678</td>
      <td>-0.019923</td>
      <td>-0.012341</td>
      <td> 0.002576</td>
      <td>-0.001803</td>
      <td> 0.004265</td>
      <td> 0.016171</td>
      <td> 0.013566</td>
      <td> 0.012265</td>
      <td> 0.000389</td>
      <td>-0.001816</td>
    </tr>
    <tr>
      <th>wrong_fragment</th>
      <td>-0.008025</td>
      <td>-0.019358</td>
      <td>-0.022659</td>
      <td>-0.000333</td>
      <td> 1.000000</td>
      <td>-0.000150</td>
      <td>-0.004042</td>
      <td>-0.000568</td>
      <td>-0.020911</td>
      <td>-0.003370</td>
      <td>-0.000528</td>
      <td>-0.000248</td>
      <td>-0.001727</td>
      <td>-0.001160</td>
      <td>-0.000507</td>
      <td>-0.001519</td>
      <td>-0.000147</td>
      <td> 0.000441</td>
      <td>-0.001869</td>
      <td>-0.057711</td>
      <td>-0.029117</td>
      <td>-0.008849</td>
      <td>-0.023382</td>
      <td> 0.000430</td>
      <td>-0.012676</td>
      <td> 0.010218</td>
      <td>-0.009386</td>
      <td> 0.012117</td>
      <td>-0.029149</td>
      <td>-0.058225</td>
      <td>-0.049560</td>
      <td> 0.055542</td>
      <td>-0.015449</td>
      <td> 0.007306</td>
      <td> 0.010387</td>
      <td>-0.024117</td>
      <td> 0.046656</td>
      <td>-0.013666</td>
    </tr>
    <tr>
      <th>urgent</th>
      <td> 0.017883</td>
      <td> 0.000094</td>
      <td> 0.007234</td>
      <td>-0.000065</td>
      <td>-0.000150</td>
      <td> 1.000000</td>
      <td> 0.008594</td>
      <td> 0.063009</td>
      <td> 0.006821</td>
      <td> 0.031765</td>
      <td> 0.067437</td>
      <td> 0.000020</td>
      <td> 0.061994</td>
      <td> 0.061383</td>
      <td>-0.000066</td>
      <td> 0.023380</td>
      <td> 0.012879</td>
      <td> 0.005162</td>
      <td>-0.000100</td>
      <td>-0.004778</td>
      <td>-0.004799</td>
      <td>-0.001338</td>
      <td>-0.001327</td>
      <td>-0.000705</td>
      <td>-0.000726</td>
      <td> 0.001521</td>
      <td>-0.001522</td>
      <td>-0.000788</td>
      <td>-0.005894</td>
      <td>-0.005698</td>
      <td>-0.004078</td>
      <td> 0.005208</td>
      <td>-0.001939</td>
      <td>-0.000976</td>
      <td>-0.001381</td>
      <td>-0.001370</td>
      <td>-0.000786</td>
      <td>-0.000782</td>
    </tr>
    <tr>
      <th>hot</th>
      <td> 0.108639</td>
      <td> 0.113920</td>
      <td> 0.193156</td>
      <td>-0.000539</td>
      <td>-0.004042</td>
      <td> 0.008594</td>
      <td> 1.000000</td>
      <td> 0.112560</td>
      <td> 0.189126</td>
      <td> 0.811529</td>
      <td> 0.101983</td>
      <td>-0.000400</td>
      <td> 0.003096</td>
      <td> 0.028694</td>
      <td> 0.009146</td>
      <td> 0.004224</td>
      <td>-0.000393</td>
      <td>-0.000248</td>
      <td> 0.463706</td>
      <td>-0.120847</td>
      <td>-0.114735</td>
      <td>-0.035487</td>
      <td>-0.034934</td>
      <td> 0.013468</td>
      <td> 0.052003</td>
      <td> 0.041342</td>
      <td>-0.040555</td>
      <td> 0.032141</td>
      <td>-0.074178</td>
      <td>-0.017960</td>
      <td> 0.018783</td>
      <td>-0.017198</td>
      <td>-0.086998</td>
      <td>-0.014141</td>
      <td>-0.004706</td>
      <td>-0.010721</td>
      <td> 0.199019</td>
      <td> 0.189142</td>
    </tr>
    <tr>
      <th>num_failed_logins</th>
      <td> 0.014363</td>
      <td>-0.008396</td>
      <td> 0.021952</td>
      <td>-0.000076</td>
      <td>-0.000568</td>
      <td> 0.063009</td>
      <td> 0.112560</td>
      <td> 1.000000</td>
      <td>-0.002190</td>
      <td> 0.004619</td>
      <td> 0.016895</td>
      <td> 0.072748</td>
      <td> 0.010060</td>
      <td> 0.015211</td>
      <td>-0.000093</td>
      <td> 0.005581</td>
      <td> 0.003431</td>
      <td>-0.001560</td>
      <td>-0.000428</td>
      <td>-0.018024</td>
      <td>-0.018027</td>
      <td>-0.003674</td>
      <td>-0.004027</td>
      <td> 0.035324</td>
      <td> 0.034876</td>
      <td> 0.005716</td>
      <td>-0.005538</td>
      <td>-0.003096</td>
      <td>-0.028369</td>
      <td>-0.015092</td>
      <td> 0.003004</td>
      <td>-0.002960</td>
      <td>-0.006617</td>
      <td>-0.002588</td>
      <td> 0.014713</td>
      <td> 0.014914</td>
      <td> 0.032395</td>
      <td> 0.032151</td>
    </tr>
    <tr>
      <th>logged_in</th>
      <td> 0.159564</td>
      <td>-0.089702</td>
      <td> 0.882185</td>
      <td>-0.002785</td>
      <td>-0.020911</td>
      <td> 0.006821</td>
      <td> 0.189126</td>
      <td>-0.002190</td>
      <td> 1.000000</td>
      <td> 0.161190</td>
      <td> 0.025293</td>
      <td> 0.011813</td>
      <td> 0.082533</td>
      <td> 0.055530</td>
      <td> 0.024354</td>
      <td> 0.072698</td>
      <td> 0.000079</td>
      <td> 0.000127</td>
      <td> 0.089318</td>
      <td>-0.578287</td>
      <td>-0.438947</td>
      <td>-0.187114</td>
      <td>-0.180122</td>
      <td>-0.091962</td>
      <td>-0.072287</td>
      <td> 0.216969</td>
      <td>-0.214019</td>
      <td> 0.503807</td>
      <td>-0.682721</td>
      <td> 0.080352</td>
      <td> 0.114526</td>
      <td>-0.093565</td>
      <td>-0.359506</td>
      <td> 0.659078</td>
      <td>-0.143283</td>
      <td>-0.132474</td>
      <td> 0.007236</td>
      <td> 0.012979</td>
    </tr>
    <tr>
      <th>num_compromised</th>
      <td> 0.010687</td>
      <td> 0.118562</td>
      <td> 0.169772</td>
      <td>-0.000447</td>
      <td>-0.003370</td>
      <td> 0.031765</td>
      <td> 0.811529</td>
      <td> 0.004619</td>
      <td> 0.161190</td>
      <td> 1.000000</td>
      <td> 0.085558</td>
      <td> 0.048985</td>
      <td> 0.028557</td>
      <td> 0.031223</td>
      <td> 0.011256</td>
      <td> 0.006977</td>
      <td> 0.001048</td>
      <td>-0.000438</td>
      <td>-0.002504</td>
      <td>-0.097212</td>
      <td>-0.091154</td>
      <td>-0.030516</td>
      <td>-0.030264</td>
      <td> 0.008573</td>
      <td> 0.054006</td>
      <td> 0.035253</td>
      <td>-0.034953</td>
      <td> 0.036497</td>
      <td>-0.041615</td>
      <td> 0.003465</td>
      <td> 0.038980</td>
      <td>-0.039091</td>
      <td>-0.078843</td>
      <td>-0.020979</td>
      <td>-0.005019</td>
      <td>-0.004504</td>
      <td> 0.214115</td>
      <td> 0.217858</td>
    </tr>
    <tr>
      <th>root_shell</th>
      <td> 0.040425</td>
      <td> 0.003067</td>
      <td> 0.026054</td>
      <td>-0.000093</td>
      <td>-0.000528</td>
      <td> 0.067437</td>
      <td> 0.101983</td>
      <td> 0.016895</td>
      <td> 0.025293</td>
      <td> 0.085558</td>
      <td> 1.000000</td>
      <td> 0.233486</td>
      <td> 0.094512</td>
      <td> 0.140650</td>
      <td> 0.132056</td>
      <td> 0.069353</td>
      <td> 0.011462</td>
      <td>-0.006602</td>
      <td>-0.000405</td>
      <td>-0.016409</td>
      <td>-0.015174</td>
      <td>-0.004952</td>
      <td>-0.004923</td>
      <td>-0.001104</td>
      <td>-0.001143</td>
      <td> 0.004946</td>
      <td>-0.004553</td>
      <td> 0.002286</td>
      <td>-0.021367</td>
      <td>-0.011906</td>
      <td> 0.000515</td>
      <td>-0.000916</td>
      <td>-0.004617</td>
      <td> 0.008631</td>
      <td>-0.003498</td>
      <td>-0.003032</td>
      <td> 0.002763</td>
      <td> 0.002151</td>
    </tr>
    <tr>
      <th>su_attempted</th>
      <td> 0.026015</td>
      <td> 0.002282</td>
      <td> 0.012192</td>
      <td>-0.000049</td>
      <td>-0.000248</td>
      <td> 0.000020</td>
      <td>-0.000400</td>
      <td> 0.072748</td>
      <td> 0.011813</td>
      <td> 0.048985</td>
      <td> 0.233486</td>
      <td> 1.000000</td>
      <td> 0.119326</td>
      <td> 0.053110</td>
      <td> 0.040487</td>
      <td> 0.081272</td>
      <td>-0.018896</td>
      <td> 0.012927</td>
      <td>-0.000219</td>
      <td>-0.008279</td>
      <td>-0.008225</td>
      <td>-0.002318</td>
      <td>-0.002295</td>
      <td>-0.001227</td>
      <td>-0.001253</td>
      <td> 0.002634</td>
      <td>-0.002649</td>
      <td> 0.000348</td>
      <td>-0.006697</td>
      <td>-0.006288</td>
      <td>-0.005738</td>
      <td> 0.006687</td>
      <td>-0.005020</td>
      <td> 0.001052</td>
      <td> 0.001974</td>
      <td> 0.002893</td>
      <td> 0.003173</td>
      <td> 0.001731</td>
    </tr>
    <tr>
      <th>num_root</th>
      <td> 0.013401</td>
      <td>-0.002050</td>
      <td>-0.003884</td>
      <td>-0.000230</td>
      <td>-0.001727</td>
      <td> 0.061994</td>
      <td> 0.003096</td>
      <td> 0.010060</td>
      <td> 0.082533</td>
      <td> 0.028557</td>
      <td> 0.094512</td>
      <td> 0.119326</td>
      <td> 1.000000</td>
      <td> 0.047521</td>
      <td> 0.034405</td>
      <td> 0.014513</td>
      <td> 0.001524</td>
      <td>-0.002585</td>
      <td>-0.001281</td>
      <td>-0.054721</td>
      <td>-0.053530</td>
      <td>-0.016031</td>
      <td>-0.015936</td>
      <td>-0.008610</td>
      <td>-0.008708</td>
      <td> 0.013881</td>
      <td>-0.011337</td>
      <td> 0.006316</td>
      <td>-0.078717</td>
      <td>-0.038689</td>
      <td>-0.038935</td>
      <td> 0.047414</td>
      <td>-0.015968</td>
      <td> 0.061030</td>
      <td>-0.008457</td>
      <td>-0.007096</td>
      <td>-0.000421</td>
      <td>-0.005012</td>
    </tr>
    <tr>
      <th>num_file_creations</th>
      <td> 0.061099</td>
      <td> 0.027710</td>
      <td> 0.034154</td>
      <td>-0.000150</td>
      <td>-0.001160</td>
      <td> 0.061383</td>
      <td> 0.028694</td>
      <td> 0.015211</td>
      <td> 0.055530</td>
      <td> 0.031223</td>
      <td> 0.140650</td>
      <td> 0.053110</td>
      <td> 0.047521</td>
      <td> 1.000000</td>
      <td> 0.068660</td>
      <td> 0.031042</td>
      <td>-0.004081</td>
      <td>-0.001664</td>
      <td> 0.013242</td>
      <td>-0.036467</td>
      <td>-0.034598</td>
      <td>-0.009703</td>
      <td>-0.010390</td>
      <td>-0.005069</td>
      <td>-0.004775</td>
      <td> 0.009784</td>
      <td>-0.008711</td>
      <td> 0.014412</td>
      <td>-0.049529</td>
      <td>-0.026890</td>
      <td>-0.021731</td>
      <td> 0.027092</td>
      <td>-0.015018</td>
      <td> 0.030590</td>
      <td>-0.002257</td>
      <td>-0.004295</td>
      <td> 0.000626</td>
      <td>-0.001096</td>
    </tr>
    <tr>
      <th>num_shells</th>
      <td> 0.008632</td>
      <td> 0.014403</td>
      <td>-0.000054</td>
      <td>-0.000076</td>
      <td>-0.000507</td>
      <td>-0.000066</td>
      <td> 0.009146</td>
      <td>-0.000093</td>
      <td> 0.024354</td>
      <td> 0.011256</td>
      <td> 0.132056</td>
      <td> 0.040487</td>
      <td> 0.034405</td>
      <td> 0.068660</td>
      <td> 1.000000</td>
      <td> 0.019438</td>
      <td>-0.002592</td>
      <td>-0.006631</td>
      <td>-0.000405</td>
      <td>-0.013938</td>
      <td>-0.011784</td>
      <td>-0.004343</td>
      <td>-0.004740</td>
      <td>-0.002541</td>
      <td>-0.002572</td>
      <td> 0.004282</td>
      <td>-0.003743</td>
      <td> 0.001096</td>
      <td>-0.021200</td>
      <td>-0.012017</td>
      <td>-0.009962</td>
      <td> 0.010761</td>
      <td>-0.003521</td>
      <td> 0.015882</td>
      <td>-0.001588</td>
      <td>-0.002357</td>
      <td>-0.000617</td>
      <td>-0.002020</td>
    </tr>
    <tr>
      <th>num_access_files</th>
      <td> 0.019407</td>
      <td>-0.001497</td>
      <td> 0.065776</td>
      <td>-0.000211</td>
      <td>-0.001519</td>
      <td> 0.023380</td>
      <td> 0.004224</td>
      <td> 0.005581</td>
      <td> 0.072698</td>
      <td> 0.006977</td>
      <td> 0.069353</td>
      <td> 0.081272</td>
      <td> 0.014513</td>
      <td> 0.031042</td>
      <td> 0.019438</td>
      <td> 1.000000</td>
      <td>-0.001597</td>
      <td>-0.002850</td>
      <td> 0.002466</td>
      <td>-0.045282</td>
      <td>-0.040497</td>
      <td>-0.013945</td>
      <td>-0.013572</td>
      <td>-0.007581</td>
      <td> 0.001874</td>
      <td> 0.015499</td>
      <td>-0.015112</td>
      <td> 0.024266</td>
      <td>-0.023865</td>
      <td>-0.023657</td>
      <td>-0.021358</td>
      <td> 0.026703</td>
      <td>-0.033288</td>
      <td> 0.011765</td>
      <td>-0.011197</td>
      <td>-0.011487</td>
      <td>-0.004743</td>
      <td>-0.004552</td>
    </tr>
    <tr>
      <th>num_outbound_cmds</th>
      <td>-0.000019</td>
      <td> 0.000010</td>
      <td>-0.000031</td>
      <td>-0.002881</td>
      <td>-0.000147</td>
      <td> 0.012879</td>
      <td>-0.000393</td>
      <td> 0.003431</td>
      <td> 0.000079</td>
      <td> 0.001048</td>
      <td> 0.011462</td>
      <td>-0.018896</td>
      <td> 0.001524</td>
      <td>-0.004081</td>
      <td>-0.002592</td>
      <td>-0.001597</td>
      <td> 1.000000</td>
      <td> 0.822890</td>
      <td> 0.000924</td>
      <td>-0.000076</td>
      <td> 0.000100</td>
      <td> 0.000167</td>
      <td> 0.000209</td>
      <td> 0.000536</td>
      <td> 0.000346</td>
      <td> 0.000208</td>
      <td> 0.000328</td>
      <td>-0.000141</td>
      <td>-0.000424</td>
      <td>-0.000280</td>
      <td>-0.000503</td>
      <td>-0.000181</td>
      <td>-0.000455</td>
      <td> 0.000288</td>
      <td>-0.000011</td>
      <td>-0.000372</td>
      <td>-0.000823</td>
      <td>-0.001038</td>
    </tr>
    <tr>
      <th>is_hot_login</th>
      <td>-0.000010</td>
      <td> 0.000019</td>
      <td> 0.000041</td>
      <td> 0.002089</td>
      <td> 0.000441</td>
      <td> 0.005162</td>
      <td>-0.000248</td>
      <td>-0.001560</td>
      <td> 0.000127</td>
      <td>-0.000438</td>
      <td>-0.006602</td>
      <td> 0.012927</td>
      <td>-0.002585</td>
      <td>-0.001664</td>
      <td>-0.006631</td>
      <td>-0.002850</td>
      <td> 0.822890</td>
      <td> 1.000000</td>
      <td> 0.001512</td>
      <td> 0.000036</td>
      <td> 0.000064</td>
      <td> 0.000102</td>
      <td>-0.000302</td>
      <td>-0.000550</td>
      <td> 0.000457</td>
      <td>-0.000159</td>
      <td>-0.000235</td>
      <td>-0.000360</td>
      <td>-0.000106</td>
      <td> 0.000206</td>
      <td> 0.000229</td>
      <td>-0.000004</td>
      <td> 0.000283</td>
      <td> 0.000538</td>
      <td>-0.000076</td>
      <td>-0.000007</td>
      <td>-0.000435</td>
      <td>-0.000529</td>
    </tr>
    <tr>
      <th>is_guest_login</th>
      <td> 0.205606</td>
      <td> 0.027511</td>
      <td> 0.085947</td>
      <td>-0.000250</td>
      <td>-0.001869</td>
      <td>-0.000100</td>
      <td> 0.463706</td>
      <td>-0.000428</td>
      <td> 0.089318</td>
      <td>-0.002504</td>
      <td>-0.000405</td>
      <td>-0.000219</td>
      <td>-0.001281</td>
      <td> 0.013242</td>
      <td>-0.000405</td>
      <td> 0.002466</td>
      <td> 0.000924</td>
      <td> 0.001512</td>
      <td> 1.000000</td>
      <td>-0.062340</td>
      <td>-0.062713</td>
      <td>-0.017343</td>
      <td>-0.017240</td>
      <td>-0.008867</td>
      <td>-0.009193</td>
      <td> 0.018042</td>
      <td>-0.017000</td>
      <td>-0.008878</td>
      <td>-0.055453</td>
      <td>-0.044366</td>
      <td>-0.041749</td>
      <td> 0.044640</td>
      <td>-0.038092</td>
      <td>-0.012578</td>
      <td>-0.001066</td>
      <td>-0.016885</td>
      <td> 0.025282</td>
      <td>-0.004292</td>
    </tr>
    <tr>
      <th>count</th>
      <td>-0.259032</td>
      <td> 0.666230</td>
      <td>-0.639157</td>
      <td>-0.010939</td>
      <td>-0.057711</td>
      <td>-0.004778</td>
      <td>-0.120847</td>
      <td>-0.018024</td>
      <td>-0.578287</td>
      <td>-0.097212</td>
      <td>-0.016409</td>
      <td>-0.008279</td>
      <td>-0.054721</td>
      <td>-0.036467</td>
      <td>-0.013938</td>
      <td>-0.045282</td>
      <td>-0.000076</td>
      <td> 0.000036</td>
      <td>-0.062340</td>
      <td> 1.000000</td>
      <td> 0.950587</td>
      <td>-0.303538</td>
      <td>-0.308923</td>
      <td>-0.213824</td>
      <td>-0.221352</td>
      <td> 0.346718</td>
      <td>-0.361737</td>
      <td>-0.384010</td>
      <td> 0.547443</td>
      <td> 0.586979</td>
      <td> 0.539698</td>
      <td>-0.546869</td>
      <td> 0.776906</td>
      <td>-0.496554</td>
      <td>-0.331571</td>
      <td>-0.335290</td>
      <td>-0.261194</td>
      <td>-0.256176</td>
    </tr>
    <tr>
      <th>srv_count</th>
      <td>-0.250139</td>
      <td> 0.722609</td>
      <td>-0.497683</td>
      <td>-0.010128</td>
      <td>-0.029117</td>
      <td>-0.004799</td>
      <td>-0.114735</td>
      <td>-0.018027</td>
      <td>-0.438947</td>
      <td>-0.091154</td>
      <td>-0.015174</td>
      <td>-0.008225</td>
      <td>-0.053530</td>
      <td>-0.034598</td>
      <td>-0.011784</td>
      <td>-0.040497</td>
      <td> 0.000100</td>
      <td> 0.000064</td>
      <td>-0.062713</td>
      <td> 0.950587</td>
      <td> 1.000000</td>
      <td>-0.428185</td>
      <td>-0.421424</td>
      <td>-0.281468</td>
      <td>-0.284034</td>
      <td> 0.517227</td>
      <td>-0.511998</td>
      <td>-0.239057</td>
      <td> 0.442611</td>
      <td> 0.720746</td>
      <td> 0.681955</td>
      <td>-0.673916</td>
      <td> 0.812280</td>
      <td>-0.391712</td>
      <td>-0.449096</td>
      <td>-0.442823</td>
      <td>-0.313442</td>
      <td>-0.308132</td>
    </tr>
    <tr>
      <th>serror_rate</th>
      <td>-0.074211</td>
      <td>-0.657460</td>
      <td>-0.205848</td>
      <td> 0.014160</td>
      <td>-0.008849</td>
      <td>-0.001338</td>
      <td>-0.035487</td>
      <td>-0.003674</td>
      <td>-0.187114</td>
      <td>-0.030516</td>
      <td>-0.004952</td>
      <td>-0.002318</td>
      <td>-0.016031</td>
      <td>-0.009703</td>
      <td>-0.004343</td>
      <td>-0.013945</td>
      <td> 0.000167</td>
      <td> 0.000102</td>
      <td>-0.017343</td>
      <td>-0.303538</td>
      <td>-0.428185</td>
      <td> 1.000000</td>
      <td> 0.990888</td>
      <td>-0.091157</td>
      <td>-0.095285</td>
      <td>-0.851915</td>
      <td> 0.828012</td>
      <td>-0.121489</td>
      <td> 0.165350</td>
      <td>-0.724317</td>
      <td>-0.745745</td>
      <td> 0.719708</td>
      <td>-0.650336</td>
      <td>-0.153568</td>
      <td> 0.973947</td>
      <td> 0.965663</td>
      <td>-0.103198</td>
      <td>-0.105434</td>
    </tr>
    <tr>
      <th>srv_serror_rate</th>
      <td>-0.073663</td>
      <td>-0.652391</td>
      <td>-0.198715</td>
      <td> 0.014342</td>
      <td>-0.023382</td>
      <td>-0.001327</td>
      <td>-0.034934</td>
      <td>-0.004027</td>
      <td>-0.180122</td>
      <td>-0.030264</td>
      <td>-0.004923</td>
      <td>-0.002295</td>
      <td>-0.015936</td>
      <td>-0.010390</td>
      <td>-0.004740</td>
      <td>-0.013572</td>
      <td> 0.000209</td>
      <td>-0.000302</td>
      <td>-0.017240</td>
      <td>-0.308923</td>
      <td>-0.421424</td>
      <td> 0.990888</td>
      <td> 1.000000</td>
      <td>-0.110664</td>
      <td>-0.115286</td>
      <td>-0.839315</td>
      <td> 0.815305</td>
      <td>-0.112222</td>
      <td> 0.160322</td>
      <td>-0.713313</td>
      <td>-0.734334</td>
      <td> 0.707753</td>
      <td>-0.646256</td>
      <td>-0.148072</td>
      <td> 0.967214</td>
      <td> 0.970617</td>
      <td>-0.122630</td>
      <td>-0.124656</td>
    </tr>
    <tr>
      <th>rerror_rate</th>
      <td>-0.025936</td>
      <td>-0.342180</td>
      <td>-0.100958</td>
      <td>-0.000451</td>
      <td> 0.000430</td>
      <td>-0.000705</td>
      <td> 0.013468</td>
      <td> 0.035324</td>
      <td>-0.091962</td>
      <td> 0.008573</td>
      <td>-0.001104</td>
      <td>-0.001227</td>
      <td>-0.008610</td>
      <td>-0.005069</td>
      <td>-0.002541</td>
      <td>-0.007581</td>
      <td> 0.000536</td>
      <td>-0.000550</td>
      <td>-0.008867</td>
      <td>-0.213824</td>
      <td>-0.281468</td>
      <td>-0.091157</td>
      <td>-0.110664</td>
      <td> 1.000000</td>
      <td> 0.978813</td>
      <td>-0.327986</td>
      <td> 0.345571</td>
      <td>-0.017902</td>
      <td>-0.067857</td>
      <td>-0.330391</td>
      <td>-0.303126</td>
      <td> 0.308722</td>
      <td>-0.278465</td>
      <td> 0.073061</td>
      <td>-0.094076</td>
      <td>-0.110646</td>
      <td> 0.910225</td>
      <td> 0.911622</td>
    </tr>
    <tr>
      <th>srv_rerror_rate</th>
      <td>-0.026420</td>
      <td>-0.332977</td>
      <td>-0.081307</td>
      <td>-0.001690</td>
      <td>-0.012676</td>
      <td>-0.000726</td>
      <td> 0.052003</td>
      <td> 0.034876</td>
      <td>-0.072287</td>
      <td> 0.054006</td>
      <td>-0.001143</td>
      <td>-0.001253</td>
      <td>-0.008708</td>
      <td>-0.004775</td>
      <td>-0.002572</td>
      <td> 0.001874</td>
      <td> 0.000346</td>
      <td> 0.000457</td>
      <td>-0.009193</td>
      <td>-0.221352</td>
      <td>-0.284034</td>
      <td>-0.095285</td>
      <td>-0.115286</td>
      <td> 0.978813</td>
      <td> 1.000000</td>
      <td>-0.316568</td>
      <td> 0.333439</td>
      <td> 0.011285</td>
      <td>-0.072595</td>
      <td>-0.323032</td>
      <td>-0.294328</td>
      <td> 0.300186</td>
      <td>-0.282239</td>
      <td> 0.075178</td>
      <td>-0.096146</td>
      <td>-0.114341</td>
      <td> 0.904591</td>
      <td> 0.914904</td>
    </tr>
    <tr>
      <th>same_srv_rate</th>
      <td> 0.062291</td>
      <td> 0.744046</td>
      <td> 0.229677</td>
      <td> 0.002153</td>
      <td> 0.010218</td>
      <td> 0.001521</td>
      <td> 0.041342</td>
      <td> 0.005716</td>
      <td> 0.216969</td>
      <td> 0.035253</td>
      <td> 0.004946</td>
      <td> 0.002634</td>
      <td> 0.013881</td>
      <td> 0.009784</td>
      <td> 0.004282</td>
      <td> 0.015499</td>
      <td> 0.000208</td>
      <td>-0.000159</td>
      <td> 0.018042</td>
      <td> 0.346718</td>
      <td> 0.517227</td>
      <td>-0.851915</td>
      <td>-0.839315</td>
      <td>-0.327986</td>
      <td>-0.316568</td>
      <td> 1.000000</td>
      <td>-0.982109</td>
      <td> 0.140660</td>
      <td>-0.190121</td>
      <td> 0.848754</td>
      <td> 0.873551</td>
      <td>-0.844537</td>
      <td> 0.732841</td>
      <td> 0.179040</td>
      <td>-0.830067</td>
      <td>-0.819335</td>
      <td>-0.282487</td>
      <td>-0.282913</td>
    </tr>
    <tr>
      <th>diff_srv_rate</th>
      <td>-0.050875</td>
      <td>-0.739988</td>
      <td>-0.222572</td>
      <td>-0.001846</td>
      <td>-0.009386</td>
      <td>-0.001522</td>
      <td>-0.040555</td>
      <td>-0.005538</td>
      <td>-0.214019</td>
      <td>-0.034953</td>
      <td>-0.004553</td>
      <td>-0.002649</td>
      <td>-0.011337</td>
      <td>-0.008711</td>
      <td>-0.003743</td>
      <td>-0.015112</td>
      <td> 0.000328</td>
      <td>-0.000235</td>
      <td>-0.017000</td>
      <td>-0.361737</td>
      <td>-0.511998</td>
      <td> 0.828012</td>
      <td> 0.815305</td>
      <td> 0.345571</td>
      <td> 0.333439</td>
      <td>-0.982109</td>
      <td> 1.000000</td>
      <td>-0.138293</td>
      <td> 0.185942</td>
      <td>-0.844028</td>
      <td>-0.868580</td>
      <td> 0.850911</td>
      <td>-0.727031</td>
      <td>-0.176930</td>
      <td> 0.807205</td>
      <td> 0.795844</td>
      <td> 0.299041</td>
      <td> 0.298904</td>
    </tr>
    <tr>
      <th>srv_diff_host_rate</th>
      <td> 0.123621</td>
      <td>-0.104042</td>
      <td> 0.521003</td>
      <td> 0.020678</td>
      <td> 0.012117</td>
      <td>-0.000788</td>
      <td> 0.032141</td>
      <td>-0.003096</td>
      <td> 0.503807</td>
      <td> 0.036497</td>
      <td> 0.002286</td>
      <td> 0.000348</td>
      <td> 0.006316</td>
      <td> 0.014412</td>
      <td> 0.001096</td>
      <td> 0.024266</td>
      <td>-0.000141</td>
      <td>-0.000360</td>
      <td>-0.008878</td>
      <td>-0.384010</td>
      <td>-0.239057</td>
      <td>-0.121489</td>
      <td>-0.112222</td>
      <td>-0.017902</td>
      <td> 0.011285</td>
      <td> 0.140660</td>
      <td>-0.138293</td>
      <td> 1.000000</td>
      <td>-0.445051</td>
      <td> 0.035010</td>
      <td> 0.068648</td>
      <td>-0.050472</td>
      <td>-0.222707</td>
      <td> 0.433173</td>
      <td>-0.097973</td>
      <td>-0.092661</td>
      <td> 0.022585</td>
      <td> 0.024722</td>
    </tr>
    <tr>
      <th>dst_host_count</th>
      <td>-0.161107</td>
      <td> 0.130377</td>
      <td>-0.611972</td>
      <td>-0.019923</td>
      <td>-0.029149</td>
      <td>-0.005894</td>
      <td>-0.074178</td>
      <td>-0.028369</td>
      <td>-0.682721</td>
      <td>-0.041615</td>
      <td>-0.021367</td>
      <td>-0.006697</td>
      <td>-0.078717</td>
      <td>-0.049529</td>
      <td>-0.021200</td>
      <td>-0.023865</td>
      <td>-0.000424</td>
      <td>-0.000106</td>
      <td>-0.055453</td>
      <td> 0.547443</td>
      <td> 0.442611</td>
      <td> 0.165350</td>
      <td> 0.160322</td>
      <td>-0.067857</td>
      <td>-0.072595</td>
      <td>-0.190121</td>
      <td> 0.185942</td>
      <td>-0.445051</td>
      <td> 1.000000</td>
      <td> 0.022731</td>
      <td>-0.070448</td>
      <td> 0.044338</td>
      <td> 0.189876</td>
      <td>-0.918894</td>
      <td> 0.123881</td>
      <td> 0.113845</td>
      <td>-0.125142</td>
      <td>-0.125273</td>
    </tr>
    <tr>
      <th>dst_host_srv_count</th>
      <td>-0.217167</td>
      <td> 0.741979</td>
      <td> 0.024124</td>
      <td>-0.012341</td>
      <td>-0.058225</td>
      <td>-0.005698</td>
      <td>-0.017960</td>
      <td>-0.015092</td>
      <td> 0.080352</td>
      <td> 0.003465</td>
      <td>-0.011906</td>
      <td>-0.006288</td>
      <td>-0.038689</td>
      <td>-0.026890</td>
      <td>-0.012017</td>
      <td>-0.023657</td>
      <td>-0.000280</td>
      <td> 0.000206</td>
      <td>-0.044366</td>
      <td> 0.586979</td>
      <td> 0.720746</td>
      <td>-0.724317</td>
      <td>-0.713313</td>
      <td>-0.330391</td>
      <td>-0.323032</td>
      <td> 0.848754</td>
      <td>-0.844028</td>
      <td> 0.035010</td>
      <td> 0.022731</td>
      <td> 1.000000</td>
      <td> 0.970072</td>
      <td>-0.955178</td>
      <td> 0.769481</td>
      <td> 0.043668</td>
      <td>-0.722607</td>
      <td>-0.708392</td>
      <td>-0.312040</td>
      <td>-0.300787</td>
    </tr>
    <tr>
      <th>dst_host_same_srv_rate</th>
      <td>-0.211979</td>
      <td> 0.729151</td>
      <td> 0.055033</td>
      <td> 0.002576</td>
      <td>-0.049560</td>
      <td>-0.004078</td>
      <td> 0.018783</td>
      <td> 0.003004</td>
      <td> 0.114526</td>
      <td> 0.038980</td>
      <td> 0.000515</td>
      <td>-0.005738</td>
      <td>-0.038935</td>
      <td>-0.021731</td>
      <td>-0.009962</td>
      <td>-0.021358</td>
      <td>-0.000503</td>
      <td> 0.000229</td>
      <td>-0.041749</td>
      <td> 0.539698</td>
      <td> 0.681955</td>
      <td>-0.745745</td>
      <td>-0.734334</td>
      <td>-0.303126</td>
      <td>-0.294328</td>
      <td> 0.873551</td>
      <td>-0.868580</td>
      <td> 0.068648</td>
      <td>-0.070448</td>
      <td> 0.970072</td>
      <td> 1.000000</td>
      <td>-0.980245</td>
      <td> 0.771158</td>
      <td> 0.107926</td>
      <td>-0.742045</td>
      <td>-0.725272</td>
      <td>-0.278068</td>
      <td>-0.264383</td>
    </tr>
    <tr>
      <th>dst_host_diff_srv_rate</th>
      <td> 0.231644</td>
      <td>-0.712965</td>
      <td>-0.035073</td>
      <td>-0.001803</td>
      <td> 0.055542</td>
      <td> 0.005208</td>
      <td>-0.017198</td>
      <td>-0.002960</td>
      <td>-0.093565</td>
      <td>-0.039091</td>
      <td>-0.000916</td>
      <td> 0.006687</td>
      <td> 0.047414</td>
      <td> 0.027092</td>
      <td> 0.010761</td>
      <td> 0.026703</td>
      <td>-0.000181</td>
      <td>-0.000004</td>
      <td> 0.044640</td>
      <td>-0.546869</td>
      <td>-0.673916</td>
      <td> 0.719708</td>
      <td> 0.707753</td>
      <td> 0.308722</td>
      <td> 0.300186</td>
      <td>-0.844537</td>
      <td> 0.850911</td>
      <td>-0.050472</td>
      <td> 0.044338</td>
      <td>-0.955178</td>
      <td>-0.980245</td>
      <td> 1.000000</td>
      <td>-0.766402</td>
      <td>-0.088665</td>
      <td> 0.719275</td>
      <td> 0.701149</td>
      <td> 0.287476</td>
      <td> 0.271067</td>
    </tr>
    <tr>
      <th>dst_host_same_src_port_rate</th>
      <td>-0.065202</td>
      <td> 0.815039</td>
      <td>-0.396195</td>
      <td> 0.004265</td>
      <td>-0.015449</td>
      <td>-0.001939</td>
      <td>-0.086998</td>
      <td>-0.006617</td>
      <td>-0.359506</td>
      <td>-0.078843</td>
      <td>-0.004617</td>
      <td>-0.005020</td>
      <td>-0.015968</td>
      <td>-0.015018</td>
      <td>-0.003521</td>
      <td>-0.033288</td>
      <td>-0.000455</td>
      <td> 0.000283</td>
      <td>-0.038092</td>
      <td> 0.776906</td>
      <td> 0.812280</td>
      <td>-0.650336</td>
      <td>-0.646256</td>
      <td>-0.278465</td>
      <td>-0.282239</td>
      <td> 0.732841</td>
      <td>-0.727031</td>
      <td>-0.222707</td>
      <td> 0.189876</td>
      <td> 0.769481</td>
      <td> 0.771158</td>
      <td>-0.766402</td>
      <td> 1.000000</td>
      <td>-0.175310</td>
      <td>-0.658737</td>
      <td>-0.652636</td>
      <td>-0.299273</td>
      <td>-0.297100</td>
    </tr>
    <tr>
      <th>dst_host_srv_diff_host_rate</th>
      <td> 0.100692</td>
      <td>-0.140231</td>
      <td> 0.578557</td>
      <td> 0.016171</td>
      <td> 0.007306</td>
      <td>-0.000976</td>
      <td>-0.014141</td>
      <td>-0.002588</td>
      <td> 0.659078</td>
      <td>-0.020979</td>
      <td> 0.008631</td>
      <td> 0.001052</td>
      <td> 0.061030</td>
      <td> 0.030590</td>
      <td> 0.015882</td>
      <td> 0.011765</td>
      <td> 0.000288</td>
      <td> 0.000538</td>
      <td>-0.012578</td>
      <td>-0.496554</td>
      <td>-0.391712</td>
      <td>-0.153568</td>
      <td>-0.148072</td>
      <td> 0.073061</td>
      <td> 0.075178</td>
      <td> 0.179040</td>
      <td>-0.176930</td>
      <td> 0.433173</td>
      <td>-0.918894</td>
      <td> 0.043668</td>
      <td> 0.107926</td>
      <td>-0.088665</td>
      <td>-0.175310</td>
      <td> 1.000000</td>
      <td>-0.118697</td>
      <td>-0.103715</td>
      <td> 0.114971</td>
      <td> 0.120767</td>
    </tr>
    <tr>
      <th>dst_host_serror_rate</th>
      <td>-0.056753</td>
      <td>-0.645920</td>
      <td>-0.167047</td>
      <td> 0.013566</td>
      <td> 0.010387</td>
      <td>-0.001381</td>
      <td>-0.004706</td>
      <td> 0.014713</td>
      <td>-0.143283</td>
      <td>-0.005019</td>
      <td>-0.003498</td>
      <td> 0.001974</td>
      <td>-0.008457</td>
      <td>-0.002257</td>
      <td>-0.001588</td>
      <td>-0.011197</td>
      <td>-0.000011</td>
      <td>-0.000076</td>
      <td>-0.001066</td>
      <td>-0.331571</td>
      <td>-0.449096</td>
      <td> 0.973947</td>
      <td> 0.967214</td>
      <td>-0.094076</td>
      <td>-0.096146</td>
      <td>-0.830067</td>
      <td> 0.807205</td>
      <td>-0.097973</td>
      <td> 0.123881</td>
      <td>-0.722607</td>
      <td>-0.742045</td>
      <td> 0.719275</td>
      <td>-0.658737</td>
      <td>-0.118697</td>
      <td> 1.000000</td>
      <td> 0.968015</td>
      <td>-0.087531</td>
      <td>-0.096899</td>
    </tr>
    <tr>
      <th>dst_host_srv_serror_rate</th>
      <td>-0.057298</td>
      <td>-0.641792</td>
      <td>-0.158378</td>
      <td> 0.012265</td>
      <td>-0.024117</td>
      <td>-0.001370</td>
      <td>-0.010721</td>
      <td> 0.014914</td>
      <td>-0.132474</td>
      <td>-0.004504</td>
      <td>-0.003032</td>
      <td> 0.002893</td>
      <td>-0.007096</td>
      <td>-0.004295</td>
      <td>-0.002357</td>
      <td>-0.011487</td>
      <td>-0.000372</td>
      <td>-0.000007</td>
      <td>-0.016885</td>
      <td>-0.335290</td>
      <td>-0.442823</td>
      <td> 0.965663</td>
      <td> 0.970617</td>
      <td>-0.110646</td>
      <td>-0.114341</td>
      <td>-0.819335</td>
      <td> 0.795844</td>
      <td>-0.092661</td>
      <td> 0.113845</td>
      <td>-0.708392</td>
      <td>-0.725272</td>
      <td> 0.701149</td>
      <td>-0.652636</td>
      <td>-0.103715</td>
      <td> 0.968015</td>
      <td> 1.000000</td>
      <td>-0.111578</td>
      <td>-0.110532</td>
    </tr>
    <tr>
      <th>dst_host_rerror_rate</th>
      <td>-0.007759</td>
      <td>-0.297338</td>
      <td>-0.003042</td>
      <td> 0.000389</td>
      <td> 0.046656</td>
      <td>-0.000786</td>
      <td> 0.199019</td>
      <td> 0.032395</td>
      <td> 0.007236</td>
      <td> 0.214115</td>
      <td> 0.002763</td>
      <td> 0.003173</td>
      <td>-0.000421</td>
      <td> 0.000626</td>
      <td>-0.000617</td>
      <td>-0.004743</td>
      <td>-0.000823</td>
      <td>-0.000435</td>
      <td> 0.025282</td>
      <td>-0.261194</td>
      <td>-0.313442</td>
      <td>-0.103198</td>
      <td>-0.122630</td>
      <td> 0.910225</td>
      <td> 0.904591</td>
      <td>-0.282487</td>
      <td> 0.299041</td>
      <td> 0.022585</td>
      <td>-0.125142</td>
      <td>-0.312040</td>
      <td>-0.278068</td>
      <td> 0.287476</td>
      <td>-0.299273</td>
      <td> 0.114971</td>
      <td>-0.087531</td>
      <td>-0.111578</td>
      <td> 1.000000</td>
      <td> 0.950964</td>
    </tr>
    <tr>
      <th>dst_host_srv_rerror_rate</th>
      <td>-0.013891</td>
      <td>-0.300581</td>
      <td> 0.001621</td>
      <td>-0.001816</td>
      <td>-0.013666</td>
      <td>-0.000782</td>
      <td> 0.189142</td>
      <td> 0.032151</td>
      <td> 0.012979</td>
      <td> 0.217858</td>
      <td> 0.002151</td>
      <td> 0.001731</td>
      <td>-0.005012</td>
      <td>-0.001096</td>
      <td>-0.002020</td>
      <td>-0.004552</td>
      <td>-0.001038</td>
      <td>-0.000529</td>
      <td>-0.004292</td>
      <td>-0.256176</td>
      <td>-0.308132</td>
      <td>-0.105434</td>
      <td>-0.124656</td>
      <td> 0.911622</td>
      <td> 0.914904</td>
      <td>-0.282913</td>
      <td> 0.298904</td>
      <td> 0.024722</td>
      <td>-0.125273</td>
      <td>-0.300787</td>
      <td>-0.264383</td>
      <td> 0.271067</td>
      <td>-0.297100</td>
      <td> 0.120767</td>
      <td>-0.096899</td>
      <td>-0.110532</td>
      <td> 0.950964</td>
      <td> 1.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

    </div>
  </div>
</div>

<p>We have used a <em>Pandas</em> <code class="highlighter-rouge">DataFrame</code> here to render the correlation matrix in a more comprehensive way. Now we want those variables that are highly correlated. For that we do a bit of dataframe manipulation.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># get a boolean dataframe where true means that a pair of variables is highly correlated</span>
<span class="n">highly_correlated_df</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">corr_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">corr_df</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="c"># get the names of the variables so we can use them to slice the dataframe</span>
<span class="n">correlated_vars_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">highly_correlated_df</span><span class="o">==</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="nb">any</span><span class="p">()</span>
<span class="n">correlated_var_names</span> <span class="o">=</span> <span class="n">correlated_vars_index</span><span class="p">[</span><span class="n">correlated_vars_index</span><span class="o">==</span><span class="bp">True</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="c"># slice it</span>
<span class="n">highly_correlated_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">correlated_var_names</span><span class="p">,</span><span class="n">correlated_var_names</span><span class="p">]</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output output_html">
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>src_bytes</th>
      <th>dst_bytes</th>
      <th>hot</th>
      <th>logged_in</th>
      <th>num_compromised</th>
      <th>num_outbound_cmds</th>
      <th>is_hot_login</th>
      <th>count</th>
      <th>srv_count</th>
      <th>serror_rate</th>
      <th>srv_serror_rate</th>
      <th>rerror_rate</th>
      <th>srv_rerror_rate</th>
      <th>same_srv_rate</th>
      <th>diff_srv_rate</th>
      <th>dst_host_count</th>
      <th>dst_host_srv_count</th>
      <th>dst_host_same_srv_rate</th>
      <th>dst_host_diff_srv_rate</th>
      <th>dst_host_same_src_port_rate</th>
      <th>dst_host_srv_diff_host_rate</th>
      <th>dst_host_serror_rate</th>
      <th>dst_host_srv_serror_rate</th>
      <th>dst_host_rerror_rate</th>
      <th>dst_host_srv_rerror_rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>src_bytes</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>dst_bytes</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>hot</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>logged_in</th>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>num_compromised</th>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>num_outbound_cmds</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>is_hot_login</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>count</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>srv_count</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>serror_rate</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>srv_serror_rate</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>rerror_rate</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
    </tr>
    <tr>
      <th>srv_rerror_rate</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
    </tr>
    <tr>
      <th>same_srv_rate</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>diff_srv_rate</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>dst_host_count</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>dst_host_srv_count</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>dst_host_same_srv_rate</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>dst_host_diff_srv_rate</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>dst_host_same_src_port_rate</th>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>dst_host_srv_diff_host_rate</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>dst_host_serror_rate</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>dst_host_srv_serror_rate</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
    </tr>
    <tr>
      <th>dst_host_rerror_rate</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
    </tr>
    <tr>
      <th>dst_host_srv_rerror_rate</th>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td>  True</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td> False</td>
      <td>  True</td>
      <td> False</td>
    </tr>
  </tbody>
</table>
</div>
</div>

    </div>
  </div>
</div>

<h3 id="conclusions-and-possible-model-selection-hints">Conclusions and possible model selection hints</h3>

<p>The previous dataframe showed us which variables are highly correlated. We have kept just those variables with at least one strong correlation. We can use as we please, but a good way could be to do some model selection. That is, if we have a group of variables that are highly correlated, we can keep just one of them to represent the group under the assumption that they convey similar information as predictors. Reducing the number of variables will not improve our model accuracy, but it will make it easier to understand and also more efficient to compute.</p>

<p>For example, from the description of the <a href="http://kdd.ics.uci.edu/databases/kddcup99/task.html">KDD Cup 99 task</a> we know that the variable <code class="highlighter-rouge">dst_host_same_src_port_rate</code> references the percentage of the last 100 connections to the same port, for the same destination host. In our correlation matrix (and auxiliar dataframes) we find that this one is highly and positively correlated to <code class="highlighter-rouge">src_bytes</code> and <code class="highlighter-rouge">srv_count</code>. The former is the number of bytes sent form source to destination. The later is the number of connections to the same service as the current connection in the past 2 seconds. We might decide not to include <code class="highlighter-rouge">dst_host_same_src_port_rate</code> in our model if we include the other two, as a way to reduce the number of variables and later one better interpret our models.</p>

<p>Later on, in those notebooks dedicated to build predictive models, we will make use of this information to build more interpretable models.</p>

<h1 id="mllib-classification-with-logistic-regression">MLlib: Classification with Logistic Regression</h1>

<p>In this notebook we will use Spark’s machine learning library <a href="https://spark.apache.org/docs/latest/mllib-guide.html">MLlib</a> to build a <strong>Logistic Regression</strong> classifier for network attack detection. We will use the complete <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html">KDD Cup 1999</a> datasets in order to test Spark capabilities with large datasets.</p>

<p>Additionally, we will introduce two ways of performing <strong>model selection</strong>: by using a correlation matrix and by using hypothesis testing.</p>

<p>At the time of processing this notebook, our Spark cluster contains:</p>

<ul>
  <li>Eight nodes, with one of them acting as master and the rest as workers.</li>
  <li>Each node contains 8Gb of RAM, with 6Gb being used for each node.</li>
  <li>Each node has a 2.4Ghz Intel dual core processor.</li>
</ul>

<h2 id="getting-the-data-and-creating-the-rdd-6">Getting the data and creating the RDD</h2>

<p>As we said, this time we will use the complete dataset provided for the <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html">KDD Cup 1999</a>, containing nearly half million network interactions. The file is provided as a Gzip file that we will download locally.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span> <span class="p">(</span><span class="s">"http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data.gz"</span><span class="p">,</span> <span class="s">"kddcup.data.gz"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_file</span> <span class="o">=</span> <span class="s">"./kddcup.data.gz"</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Train data size is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">raw_data</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Train data size is 4898431
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>The <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html">KDD Cup 1999</a> also provide test data that we will load in a separate RDD.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ft</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="s">"http://kdd.ics.uci.edu/databases/kddcup99/corrected.gz"</span><span class="p">,</span> <span class="s">"corrected.gz"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_data_file</span> <span class="o">=</span> <span class="s">"./corrected.gz"</span>
<span class="n">test_raw_data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">test_data_file</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Test data size is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_raw_data</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Test data size is 311029
</code></pre></div>      </div>
    </div>
  </div>
</div>

<h2 id="labeled-points">Labeled Points</h2>

<p>A labeled point is a local vector associated with a label/response. In <a href="https://spark.apache.org/docs/latest/mllib-data-types.html#labeled-point">MLlib</a>, labeled points are used in supervised learning algorithms and they are stored as doubles. For binary classification, a label should be either 0 (negative) or 1 (positive).</p>

<h3 id="preparing-the-training-data">Preparing the training data</h3>

<p>In our case, we are interested in detecting network attacks in general. We don’t need to detect which type of attack we are dealing with. Therefore we will tag each network interaction as non attack (i.e. ‘normal’ tag) or attack (i.e. anything else but ‘normal’).</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.mllib.regression</span> <span class="kn">import</span> <span class="n">LabeledPoint</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>

<span class="k">def</span> <span class="nf">parse_interaction</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">line_split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
    <span class="c"># leave_out = [1,2,3,41]</span>
    <span class="n">clean_line_split</span> <span class="o">=</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">line_split</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">41</span><span class="p">]</span>
    <span class="n">attack</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span><span class="o">==</span><span class="s">'normal.'</span><span class="p">:</span>
        <span class="n">attack</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">LabeledPoint</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span> <span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clean_line_split</span><span class="p">]))</span>

<span class="n">training_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">parse_interaction</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<h3 id="preparing-the-test-data">Preparing the test data</h3>

<p>Similarly, we process our test data file.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_data</span> <span class="o">=</span> <span class="n">test_raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">parse_interaction</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<h2 id="detecting-network-attacks-using-logistic-regression">Detecting network attacks using Logistic Regression</h2>

<p><a href="http://en.wikipedia.org/wiki/Logistic_regression">Logistic regression</a> is widely used to predict a binary response. Spark implements <a href="https://spark.apache.org/docs/latest/mllib-linear-methods.html#logistic-regression">two algorithms</a> to solve logistic regression: mini-batch gradient descent and L-BFGS. L-BFGS is recommended over mini-batch gradient descent for faster convergence.</p>

<h3 id="training-a-classifier">Training a classifier</h3>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.mllib.classification</span> <span class="kn">import</span> <span class="n">LogisticRegressionWithLBFGS</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="c"># Build the model</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">logit_model</span> <span class="o">=</span> <span class="n">LogisticRegressionWithLBFGS</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_data</span><span class="p">)</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Classifier trained in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Classifier trained in 365.599 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<h3 id="evaluating-the-model-on-new-data">Evaluating the model on new data</h3>

<p>In order to measure the classification error on our test data, we use <code class="highlighter-rouge">map</code> on the <code class="highlighter-rouge">test_data</code> RDD and the model to predict each test point class.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">labels_and_preds</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">logit_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">features</span><span class="p">)))</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Classification results are returned in pars, with the actual test label and the predicted one. This is used to calculate the classification error by using <code class="highlighter-rouge">filter</code> and <code class="highlighter-rouge">count</code> as follows.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">test_accuracy</span> <span class="o">=</span> <span class="n">labels_and_preds</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span> <span class="n">v</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Prediction made in {} seconds. Test accuracy is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">test_accuracy</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Prediction made in 34.291 seconds. Test accuracy is 0.9164
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>That’s a decent accuracy. We know that there is space for improvement with a better variable selection and also by including categorical variables (e.g. we have excluded ‘protocol’ and ‘service’).</p>

<h2 id="model-selection">Model selection</h2>

<p>Model or feature selection helps us building more interpretable and efficient models (or a classifier in this case). For illustrative purposes, we will follow two different approaches, correlation matrices and hypothesis testing.</p>

<h3 id="using-a-correlation-matrix">Using a correlation matrix</h3>

<p>In a <a href="https://github.com/jadianes/spark-py-notebooks/blob/master/nb7-mllib-statistics/nb7-mllib-statistics.ipynb">previous notebook</a> we calculated a correlation matrix in order to find predictors that are highly correlated. There are many possible choices there in order to simplify our model. We can pick different combinations of correlated variables and leave just those that represent them. The reader can try different combinations. Here we will choose the following for illustrative purposes:</p>

<ul>
  <li>
    <p>From the description of the <a href="http://kdd.ics.uci.edu/databases/kddcup99/task.html">KDD Cup 99 task</a> we know that the variable <code class="highlighter-rouge">dst_host_same_src_port_rate</code> references the percentage of the last 100 connections to the same port, for the same destination host. In our correlation matrix (and auxiliary dataframes) we find that this one is highly and positively correlated to <code class="highlighter-rouge">src_bytes</code> and <code class="highlighter-rouge">srv_count</code>. The former is the number of bytes sent form source to destination. The later is the number of connections to the same service as the current connection in the past 2 seconds. We decide not to include <code class="highlighter-rouge">dst_host_same_src_port_rate</code> in our model since we include the other two.</p>
  </li>
  <li>
    <p>Variables <code class="highlighter-rouge">serror_rate</code> and <code class="highlighter-rouge">srv_error_rate</code> (% of connections that have <em>SYN</em> errors for same host and same service respectively) are highly positively correlated. Moreover, the set of variables that they highly correlate with are pretty much the same. They look like contributing very similarly to our model. We will keep just <code class="highlighter-rouge">serror_rate</code>.</p>
  </li>
  <li>
    <p>A similar situation happens with <code class="highlighter-rouge">rerror_rate</code> and <code class="highlighter-rouge">srv_rerror_rate</code> (% of connections that have <em>REJ</em> errors) so we will keep just <code class="highlighter-rouge">rerror_rate</code>.</p>
  </li>
  <li>
    <p>Same thing with variables prefixed with <code class="highlighter-rouge">dst_host_</code> for the previous ones (e.g. <code class="highlighter-rouge">dst_host_srv_serror_rate</code>).</p>
  </li>
</ul>

<p>We will stop here, although the reader can keep experimenting removing correlated variables has before (e.g. <code class="highlighter-rouge">same_srv_rate</code> and <code class="highlighter-rouge">diff_srv_rate</code> are good candidates. Our list of variables we will drop includes:</p>
<ul>
  <li><code class="highlighter-rouge">dst_host_same_src_port_rate</code>, (column 35).</li>
  <li><code class="highlighter-rouge">srv_serror_rate</code> (column 25).</li>
  <li><code class="highlighter-rouge">srv_rerror_rate</code> (column 27).</li>
  <li><code class="highlighter-rouge">dst_host_srv_serror_rate</code> (column 38).</li>
  <li><code class="highlighter-rouge">dst_host_srv_rerror_rate</code> (column 40).</li>
</ul>

<h4 id="evaluating-the-new-model">Evaluating the new model</h4>

<p>Let’s proceed with the evaluation of our reduced model. First we need to provide training and testing datasets containing just the selected variables. For that we will define a new function to parse the raw data that keeps just what we need.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse_interaction_corr</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">line_split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
    <span class="c"># leave_out = [1,2,3,25,27,35,38,40,41]</span>
    <span class="n">clean_line_split</span> <span class="o">=</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">line_split</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">25</span><span class="p">]</span><span class="o">+</span><span class="n">line_split</span><span class="p">[</span><span class="mi">26</span><span class="p">:</span><span class="mi">27</span><span class="p">]</span><span class="o">+</span><span class="n">line_split</span><span class="p">[</span><span class="mi">28</span><span class="p">:</span><span class="mi">35</span><span class="p">]</span><span class="o">+</span><span class="n">line_split</span><span class="p">[</span><span class="mi">36</span><span class="p">:</span><span class="mi">38</span><span class="p">]</span><span class="o">+</span><span class="n">line_split</span><span class="p">[</span><span class="mi">39</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span>
    <span class="n">attack</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span><span class="o">==</span><span class="s">'normal.'</span><span class="p">:</span>
        <span class="n">attack</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">LabeledPoint</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span> <span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clean_line_split</span><span class="p">]))</span>

<span class="n">corr_reduced_training_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">parse_interaction_corr</span><span class="p">)</span>
<span class="n">corr_reduced_test_data</span> <span class="o">=</span> <span class="n">test_raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">parse_interaction_corr</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p><em>Note: when selecting elements in the split, a list comprehension with a <code class="highlighter-rouge">leave_out</code> list for filtering is more Pythonic than slicing and concatenation indeed, but we have found it less efficient. This is very important when dealing with large datasets. The <code class="highlighter-rouge">parse_interaction</code> functions will be called for every element in the RDD, so we need to make them as efficient as possible.</em></p>

<p>Now we can train the model.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Build the model</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">logit_model_2</span> <span class="o">=</span> <span class="n">LogisticRegressionWithLBFGS</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">corr_reduced_training_data</span><span class="p">)</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Classifier trained in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Classifier trained in 319.124 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>And evaluate its accuracy on the test data.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">labels_and_preds</span> <span class="o">=</span> <span class="n">corr_reduced_test_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">logit_model_2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">features</span><span class="p">)))</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">test_accuracy</span> <span class="o">=</span> <span class="n">labels_and_preds</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span> <span class="n">v</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">corr_reduced_test_data</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Prediction made in {} seconds. Test accuracy is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">test_accuracy</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Prediction made in 34.102 seconds. Test accuracy is 0.8599
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>As expected, we have reduced accuracy and also training time. However this doesn’t seem a good trade! At least not for logistic regression and considering the predictors we decided to leave out. We have lost quite a lot of accuracy and have not gained a lot of execution time during training. Moreover prediction time didn’t improve.</p>

<h3 id="using-hypothesis-testing">Using hypothesis testing</h3>

<p>Hypothesis testing is a powerful tool in statistical inference and learning to determine whether a result is statistically significant. MLlib supports Pearson’s chi-squared (χ2) tests for goodness of fit and independence. The goodness of fit test requires an input type of <code class="highlighter-rouge">Vector</code>, whereas the independence test requires a <code class="highlighter-rouge">Matrix</code> as input. Moreover, MLlib also supports the input type <code class="highlighter-rouge">RDD[LabeledPoint]</code> to enable feature selection via chi-squared independence tests. Again, these methods are part of the <a href="https://spark.apache.org/docs/latest/api/python/pyspark.mllib.html#pyspark.mllib.stat.Statistics"><code class="highlighter-rouge">Statistics</code></a> package.</p>

<p>In our case we want to perform some sort of feature selection, so we will provide an RDD of <code class="highlighter-rouge">LabeledPoint</code>. Internally, MLlib will calculate a contingency matrix and perform the Persons’s chi-squared (χ2) test. Features need to be categorical. Real-valued features will be treated as categorical in each of its different values. There is a limit of 1000 different values, so we need either to leave out some features or categorise them. In this case, we will consider just features that either take boolean values or just a few different numeric values in our dataset. We could overcome this limitation by defining a more complex <code class="highlighter-rouge">parse_interaction</code> function that categorises each feature properly.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">"land"</span><span class="p">,</span><span class="s">"wrong_fragment"</span><span class="p">,</span>
             <span class="s">"urgent"</span><span class="p">,</span><span class="s">"hot"</span><span class="p">,</span><span class="s">"num_failed_logins"</span><span class="p">,</span><span class="s">"logged_in"</span><span class="p">,</span><span class="s">"num_compromised"</span><span class="p">,</span>
             <span class="s">"root_shell"</span><span class="p">,</span><span class="s">"su_attempted"</span><span class="p">,</span><span class="s">"num_root"</span><span class="p">,</span><span class="s">"num_file_creations"</span><span class="p">,</span>
             <span class="s">"num_shells"</span><span class="p">,</span><span class="s">"num_access_files"</span><span class="p">,</span><span class="s">"num_outbound_cmds"</span><span class="p">,</span>
             <span class="s">"is_hot_login"</span><span class="p">,</span><span class="s">"is_guest_login"</span><span class="p">,</span><span class="s">"count"</span><span class="p">,</span><span class="s">"srv_count"</span><span class="p">,</span><span class="s">"serror_rate"</span><span class="p">,</span>
             <span class="s">"srv_serror_rate"</span><span class="p">,</span><span class="s">"rerror_rate"</span><span class="p">,</span><span class="s">"srv_rerror_rate"</span><span class="p">,</span><span class="s">"same_srv_rate"</span><span class="p">,</span>
             <span class="s">"diff_srv_rate"</span><span class="p">,</span><span class="s">"srv_diff_host_rate"</span><span class="p">,</span><span class="s">"dst_host_count"</span><span class="p">,</span><span class="s">"dst_host_srv_count"</span><span class="p">,</span>
             <span class="s">"dst_host_same_srv_rate"</span><span class="p">,</span><span class="s">"dst_host_diff_srv_rate"</span><span class="p">,</span><span class="s">"dst_host_same_src_port_rate"</span><span class="p">,</span>
             <span class="s">"dst_host_srv_diff_host_rate"</span><span class="p">,</span><span class="s">"dst_host_serror_rate"</span><span class="p">,</span><span class="s">"dst_host_srv_serror_rate"</span><span class="p">,</span>
             <span class="s">"dst_host_rerror_rate"</span><span class="p">,</span><span class="s">"dst_host_srv_rerror_rate"</span><span class="p">]</span>
</code></pre></div>    </div>
  </div>

</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse_interaction_categorical</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">line_split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
    <span class="n">clean_line_split</span> <span class="o">=</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">41</span><span class="p">]</span>
    <span class="n">attack</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span><span class="o">==</span><span class="s">'normal.'</span><span class="p">:</span>
        <span class="n">attack</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">LabeledPoint</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span> <span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clean_line_split</span><span class="p">]))</span>

<span class="n">training_data_categorical</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">parse_interaction_categorical</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.mllib.stat</span> <span class="kn">import</span> <span class="n">Statistics</span>

<span class="n">chi</span> <span class="o">=</span> <span class="n">Statistics</span><span class="o">.</span><span class="n">chiSqTest</span><span class="p">(</span><span class="n">training_data_categorical</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Now we can check the resulting values after putting them into a <em>Pandas</em> data frame.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'display.max_colwidth'</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">records</span> <span class="o">=</span> <span class="p">[(</span><span class="n">result</span><span class="o">.</span><span class="n">statistic</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">pValue</span><span class="p">)</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">chi</span><span class="p">]</span>

<span class="n">chi_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">records</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">"Statistic"</span><span class="p">,</span><span class="s">"p-value"</span><span class="p">])</span>

<span class="n">chi_df</span> 
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">

      <div class="output output_html">
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Statistic</th>
      <th>p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>land</th>
      <td>       0.464984</td>
      <td> 0.495304</td>
    </tr>
    <tr>
      <th>wrong_fragment</th>
      <td>     306.855508</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>urgent</th>
      <td>      38.718442</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>hot</th>
      <td>   19463.314328</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>num_failed_logins</th>
      <td>     127.769106</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>logged_in</th>
      <td> 3273098.055702</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>num_compromised</th>
      <td>    2011.862724</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>root_shell</th>
      <td>    1044.917853</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>su_attempted</th>
      <td>     433.999968</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>num_root</th>
      <td>   22871.675646</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>num_file_creations</th>
      <td>    9179.739210</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>num_shells</th>
      <td>    1380.027801</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>num_access_files</th>
      <td>   18734.770753</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>num_outbound_cmds</th>
      <td>       0.000000</td>
      <td> 1.000000</td>
    </tr>
    <tr>
      <th>is_hot_login</th>
      <td>       8.070987</td>
      <td> 0.004498</td>
    </tr>
    <tr>
      <th>is_guest_login</th>
      <td>   13500.511066</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>count</th>
      <td> 4546398.359513</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>srv_count</th>
      <td> 2296059.697747</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>serror_rate</th>
      <td>  268419.919232</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>srv_serror_rate</th>
      <td>  302626.967659</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>rerror_rate</th>
      <td>    9860.453313</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>srv_rerror_rate</th>
      <td>   32476.385256</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>same_srv_rate</th>
      <td>  399912.444046</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>diff_srv_rate</th>
      <td>  390999.770051</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>srv_diff_host_rate</th>
      <td> 1365458.716670</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>dst_host_count</th>
      <td> 2520478.944345</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>dst_host_srv_count</th>
      <td> 1439086.154193</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>dst_host_same_srv_rate</th>
      <td> 1237931.905888</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>dst_host_diff_srv_rate</th>
      <td> 1339002.406545</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>dst_host_same_src_port_rate</th>
      <td> 2915195.296767</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>dst_host_srv_diff_host_rate</th>
      <td> 2226290.874366</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>dst_host_serror_rate</th>
      <td>  407454.601492</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>dst_host_srv_serror_rate</th>
      <td>  455099.001618</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>dst_host_rerror_rate</th>
      <td>  136478.956325</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>dst_host_srv_rerror_rate</th>
      <td>  254547.369785</td>
      <td> 0.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

    </div>
  </div>
</div>

<p>From that we conclude that predictors <code class="highlighter-rouge">land</code> and <code class="highlighter-rouge">num_outbound_cmds</code> could be removed from our model without affecting our accuracy dramatically. Let’s try this.</p>

<h4 id="evaluating-the-new-model-1">Evaluating the new model</h4>

<p>So the only modification to our first <code class="highlighter-rouge">parse_interaction</code> function will be to remove columns 6 and 19, corresponding to the two predictors that we want not to be part of our model.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse_interaction_chi</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">line_split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
    <span class="c"># leave_out = [1,2,3,6,19,41]</span>
    <span class="n">clean_line_split</span> <span class="o">=</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">19</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">41</span><span class="p">]</span>
    <span class="n">attack</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span><span class="o">==</span><span class="s">'normal.'</span><span class="p">:</span>
        <span class="n">attack</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">LabeledPoint</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span> <span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clean_line_split</span><span class="p">]))</span>

<span class="n">training_data_chi</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">parse_interaction_chi</span><span class="p">)</span>
<span class="n">test_data_chi</span> <span class="o">=</span> <span class="n">test_raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">parse_interaction_chi</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Now we build the logistic regression classifier again.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Build the model</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">logit_model_chi</span> <span class="o">=</span> <span class="n">LogisticRegressionWithLBFGS</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_data_chi</span><span class="p">)</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Classifier trained in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Classifier trained in 356.507 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>And evaluate in test data.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">labels_and_preds</span> <span class="o">=</span> <span class="n">test_data_chi</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">logit_model_chi</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">features</span><span class="p">)))</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">test_accuracy</span> <span class="o">=</span> <span class="n">labels_and_preds</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span> <span class="n">v</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">test_data_chi</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Prediction made in {} seconds. Test accuracy is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">test_accuracy</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Prediction made in 34.656 seconds. Test accuracy is 0.9164
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>So we can see that, by using hypothesis testing, we have been able to remove two predictors without diminishing testing accuracy at all. Training time improved a bit as well. This might now seem like a big model reduction, but it is something when dealing with big data sources. Moreover, we should be able to categorise those five predictors we have left out for different reasons and, either include them in the model or leave them out if they aren’t statistically significant.</p>

<p>Additionally, we could try to remove some of those predictors that are highly correlated, trying not to reduce accuracy too much. In the end, we should end up with a model easier to understand and use.</p>

<h1 id="mllib-decision-trees">MLlib: Decision Trees</h1>

<p>In this notebook we will use Spark’s machine learning library <a href="https://spark.apache.org/docs/latest/mllib-guide.html">MLlib</a> to build a <strong>Decision Tree</strong> classifier for network attack detection. We will use the complete <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html">KDD Cup 1999</a> datasets in order to test Spark capabilities with large datasets.</p>

<p>Decision trees are a popular machine learning tool in part because they are easy to interpret, handle categorical features, extend to the multiclass classification setting, do not require feature scaling, and are able to capture non-linearities and feature interactions. In this notebook, we will first train a classification tree including every single predictor. Then we will use our results to perform model selection. Once we find out the most important ones (the main splits in the tree) we will build a minimal tree using just three of them (the first two levels of the tree in order to compare performance and accuracy.</p>

<p>At the time of processing this notebook, our Spark cluster contains:</p>

<ul>
  <li>Eight nodes, with one of them acting as master and the rest as workers.</li>
  <li>Each node contains 8Gb of RAM, with 6Gb being used for each node.</li>
  <li>Each node has a 2.4Ghz Intel dual core processor.</li>
  <li>Running Apache Spark 1.3.1.</li>
</ul>

<h2 id="getting-the-data-and-creating-the-rdd-7">Getting the data and creating the RDD</h2>

<p>As we said, this time we will use the complete dataset provided for the <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html">KDD Cup 1999</a>, containing nearly half million network interactions. The file is provided as a Gzip file that we will download locally.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib</span>
</code></pre></div>    </div>
  </div>

</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span> <span class="p">(</span><span class="s">"http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data.gz"</span><span class="p">,</span> <span class="s">"kddcup.data.gz"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_file</span> <span class="o">=</span> <span class="s">"./kddcup.data.gz"</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Train data size is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">raw_data</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Train data size is 4898431
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>The <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html">KDD Cup 1999</a> also provide test data that we will load in a separate RDD.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ft</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="s">"http://kdd.ics.uci.edu/databases/kddcup99/corrected.gz"</span><span class="p">,</span> <span class="s">"corrected.gz"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_data_file</span> <span class="o">=</span> <span class="s">"./corrected.gz"</span>
<span class="n">test_raw_data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">test_data_file</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Test data size is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_raw_data</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Test data size is 311029
</code></pre></div>      </div>
    </div>
  </div>
</div>

<h2 id="detecting-network-attacks-using-decision-trees">Detecting network attacks using Decision Trees</h2>

<p>In this section we will train a <em>classification tree</em> that, as we did with <em>logistic regression</em>, will predict if a network interaction is either <code class="highlighter-rouge">normal</code> or <code class="highlighter-rouge">attack</code>.</p>

<p>Training a classification tree using <a href="https://spark.apache.org/docs/latest/mllib-decision-tree.html">MLlib</a> requires some parameters:</p>
<ul>
  <li>Training data</li>
  <li>Num classes</li>
  <li>Categorical features info: a map from column to categorical variables arity. This is optional, although it should increase model accuracy. However it requires that we know the levels in our categorical variables in advance. second we need to parse our data to convert labels to integer values within the arity range.</li>
  <li>Impurity metric</li>
  <li>Tree maximum depth</li>
  <li>And tree maximum number of bins</li>
</ul>

<p>In the next section we will see how to obtain all the labels within a dataset and convert them to numerical factors.</p>

<h3 id="preparing-the-data">Preparing the data</h3>

<p>As we said, in order to benefits from trees ability to seamlessly with categorical variables, we need to convert them to numerical factors. But first we need to obtain all the possible levels. We will use <em>set</em> transformations on a csv parsed RDD.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.mllib.regression</span> <span class="kn">import</span> <span class="n">LabeledPoint</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>

<span class="n">csv_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">))</span>
<span class="n">test_csv_data</span> <span class="o">=</span> <span class="n">test_raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">))</span>

<span class="n">protocols</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">services</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">flags</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</code></pre></div>    </div>
  </div>

</div>

<p>And now we can use this Python lists in our <code class="highlighter-rouge">create_labeled_point</code> function. If a factor level is not in the training data, we assign an especial level. Remember that we cannot use testing data for training our model, not even the factor levels. The testing data represents the unknown to us in a real case.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_labeled_point</span><span class="p">(</span><span class="n">line_split</span><span class="p">):</span>
    <span class="c"># leave_out = [41]</span>
    <span class="n">clean_line_split</span> <span class="o">=</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">41</span><span class="p">]</span>
    
    <span class="c"># convert protocol to numeric categorical variable</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">clean_line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">protocols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">clean_line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">clean_line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">protocols</span><span class="p">)</span>
        
    <span class="c"># convert service to numeric categorical variable</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">clean_line_split</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">clean_line_split</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">clean_line_split</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">services</span><span class="p">)</span>
    
    <span class="c"># convert flag to numeric categorical variable</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">clean_line_split</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">flags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">clean_line_split</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">clean_line_split</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
    
    <span class="c"># convert label to binary label</span>
    <span class="n">attack</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span><span class="o">==</span><span class="s">'normal.'</span><span class="p">:</span>
        <span class="n">attack</span> <span class="o">=</span> <span class="mf">0.0</span>
        
    <span class="k">return</span> <span class="n">LabeledPoint</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span> <span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clean_line_split</span><span class="p">]))</span>

<span class="n">training_data</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">create_labeled_point</span><span class="p">)</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">test_csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">create_labeled_point</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<h3 id="training-a-classifier-1">Training a classifier</h3>

<p>We are now ready to train our classification tree. We will keep the <code class="highlighter-rouge">maxDepth</code> value small. This will lead to smaller accuracy, but we will obtain less splits so later on we can better interpret the tree. In a production system we will try to increase this value in order to find a better accuracy.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.mllib.tree</span> <span class="kn">import</span> <span class="n">DecisionTree</span><span class="p">,</span> <span class="n">DecisionTreeModel</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="c"># Build the model</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">tree_model</span> <span class="o">=</span> <span class="n">DecisionTree</span><span class="o">.</span><span class="n">trainClassifier</span><span class="p">(</span><span class="n">training_data</span><span class="p">,</span> <span class="n">numClasses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                                          <span class="n">categoricalFeaturesInfo</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">protocols</span><span class="p">),</span> <span class="mi">2</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">services</span><span class="p">),</span> <span class="mi">3</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">)},</span>
                                          <span class="n">impurity</span><span class="o">=</span><span class="s">'gini'</span><span class="p">,</span> <span class="n">maxDepth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">maxBins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Classifier trained in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Classifier trained in 439.971 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<h3 id="evaluating-the-model">Evaluating the model</h3>

<p>In order to measure the classification error on our test data, we use <code class="highlighter-rouge">map</code> on the <code class="highlighter-rouge">test_data</code> RDD and the model to predict each test point class.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predictions</span> <span class="o">=</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">features</span><span class="p">))</span>
<span class="n">labels_and_preds</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="nb">zip</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Classification results are returned in pars, with the actual test label and the predicted one. This is used to calculate the classification error by using <code class="highlighter-rouge">filter</code> and <code class="highlighter-rouge">count</code> as follows.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">test_accuracy</span> <span class="o">=</span> <span class="n">labels_and_preds</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span> <span class="n">v</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Prediction made in {} seconds. Test accuracy is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">test_accuracy</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Prediction made in 38.651 seconds. Test accuracy is 0.9155
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p><em>NOTE: the zip transformation doesn’t work properly with pySpark 1.2.1. It does in 1.3</em></p>

<h3 id="interpreting-the-model">Interpreting the model</h3>

<p>Understanding our tree splits is a great exercise in order to explain our classification labels in terms of predictors and the values they take. Using the <code class="highlighter-rouge">toDebugString</code> method in our three model we can obtain a lot of information regarding splits, nodes, etc.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="s">"Learned classification tree model:"</span>
<span class="k">print</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">toDebugString</span><span class="p">()</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Learned classification tree model:
DecisionTreeModel classifier of depth 4 with 27 nodes
  If (feature 22 &lt;= 89.0)
   If (feature 3 in {2.0,3.0,4.0,7.0,9.0,10.0})
    If (feature 36 &lt;= 0.43)
     If (feature 28 &lt;= 0.19)
      Predict: 1.0
     Else (feature 28 &gt; 0.19)
      Predict: 0.0
    Else (feature 36 &gt; 0.43)
     If (feature 2 in {0.0,3.0,15.0,26.0,27.0,36.0,42.0,58.0,67.0})
      Predict: 0.0
     Else (feature 2 not in {0.0,3.0,15.0,26.0,27.0,36.0,42.0,58.0,67.0})
      Predict: 1.0
   Else (feature 3 not in {2.0,3.0,4.0,7.0,9.0,10.0})
    If (feature 2 in {50.0,51.0})
     Predict: 0.0
    Else (feature 2 not in {50.0,51.0})
     If (feature 32 &lt;= 168.0)
      Predict: 1.0
     Else (feature 32 &gt; 168.0)
      Predict: 0.0
  Else (feature 22 &gt; 89.0)
   If (feature 5 &lt;= 0.0)
    If (feature 11 &lt;= 0.0)
     If (feature 31 &lt;= 253.0)
      Predict: 1.0
     Else (feature 31 &gt; 253.0)
      Predict: 1.0
    Else (feature 11 &gt; 0.0)
     If (feature 2 in {12.0})
      Predict: 0.0
     Else (feature 2 not in {12.0})
      Predict: 1.0
   Else (feature 5 &gt; 0.0)
    If (feature 29 &lt;= 0.08)
     If (feature 2 in {3.0,4.0,26.0,36.0,42.0,58.0,68.0})
      Predict: 0.0
     Else (feature 2 not in {3.0,4.0,26.0,36.0,42.0,58.0,68.0})
      Predict: 1.0
    Else (feature 29 &gt; 0.08)
     Predict: 1.0

</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>For example, a network interaction with the following features (see description <a href="http://kdd.ics.uci.edu/databases/kddcup99/task.html">here</a>) will be classified as an attack by our model:</p>
<ul>
  <li><code class="highlighter-rouge">count</code>, the number of connections to the same host as the current connection in the past two seconds, being greater than 32.</li>
  <li><code class="highlighter-rouge">dst_bytes</code>, the number of data bytes from destination to source, is 0.</li>
  <li><code class="highlighter-rouge">service</code> is neither level 0 nor 52.</li>
  <li><code class="highlighter-rouge">logged_in</code> is false.<br />
From our services list we know that:</li>
</ul>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="s">"Service 0 is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">services</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span> <span class="s">"Service 52 is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">services</span><span class="p">[</span><span class="mi">52</span><span class="p">])</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Service 0 is urp_i
Service 52 is tftp_u
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>So we can characterise network interactions with more than 32 connections to the same server in the last 2 seconds, transferring zero bytes from destination to source, where service is neither <em>urp_i</em> nor <em>tftp_u</em>, and not logged in, as network attacks. A similar approach can be used for each tree terminal node.</p>

<p>We can see that <code class="highlighter-rouge">count</code> is the first node split in the tree. Remember that each partition is chosen greedily by selecting the best split from a set of possible splits, in order to maximize the information gain at a tree node (see more <a href="https://spark.apache.org/docs/latest/mllib-decision-tree.html#basic-algorithm">here</a>). At a second level we find variables <code class="highlighter-rouge">flag</code> (normal or error status of the connection) and <code class="highlighter-rouge">dst_bytes</code> (the number of data bytes from destination to source) and so on.</p>

<p>This explaining capability of a classification (or regression) tree is one of its main benefits. Understaining data is a key factor to build better models.</p>

<h2 id="building-a-minimal-model-using-the-three-main-splits">Building a minimal model using the three main splits</h2>

<p>So now that we know the main features predicting a network attack, thanks to our classification tree splits, let’s use them to build a minimal classification tree with just the main three variables: <code class="highlighter-rouge">count</code>, <code class="highlighter-rouge">dst_bytes</code>, and <code class="highlighter-rouge">flag</code>.</p>

<p>We need to define the appropriate function to create labeled points.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_labeled_point_minimal</span><span class="p">(</span><span class="n">line_split</span><span class="p">):</span>
    <span class="c"># leave_out = [41]</span>
    <span class="n">clean_line_split</span> <span class="o">=</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">22</span><span class="p">:</span><span class="mi">23</span><span class="p">]</span>
    
    <span class="c"># convert flag to numeric categorical variable</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">clean_line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">flags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">clean_line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">clean_line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
    
    <span class="c"># convert label to binary label</span>
    <span class="n">attack</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span><span class="o">==</span><span class="s">'normal.'</span><span class="p">:</span>
        <span class="n">attack</span> <span class="o">=</span> <span class="mf">0.0</span>
        
    <span class="k">return</span> <span class="n">LabeledPoint</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span> <span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clean_line_split</span><span class="p">]))</span>

<span class="n">training_data_minimal</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">create_labeled_point_minimal</span><span class="p">)</span>
<span class="n">test_data_minimal</span> <span class="o">=</span> <span class="n">test_csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">create_labeled_point_minimal</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>That we use to train the model.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Build the model</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">tree_model_minimal</span> <span class="o">=</span> <span class="n">DecisionTree</span><span class="o">.</span><span class="n">trainClassifier</span><span class="p">(</span><span class="n">training_data_minimal</span><span class="p">,</span> <span class="n">numClasses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                                          <span class="n">categoricalFeaturesInfo</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">)},</span>
                                          <span class="n">impurity</span><span class="o">=</span><span class="s">'gini'</span><span class="p">,</span> <span class="n">maxDepth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">maxBins</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Classifier trained in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Classifier trained in 226.519 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>Now we can predict on the testing data and calculate accuracy.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predictions_minimal</span> <span class="o">=</span> <span class="n">tree_model_minimal</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data_minimal</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">features</span><span class="p">))</span>
<span class="n">labels_and_preds_minimal</span> <span class="o">=</span> <span class="n">test_data_minimal</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="nb">zip</span><span class="p">(</span><span class="n">predictions_minimal</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">test_accuracy</span> <span class="o">=</span> <span class="n">labels_and_preds_minimal</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span> <span class="n">v</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">test_data_minimal</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Prediction made in {} seconds. Test accuracy is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">test_accuracy</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Prediction made in 23.202 seconds. Test accuracy is 0.909
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>So we have trained a classification tree with just the three most important predictors, in half of the time, and with a not so bad accuracy. In fact, a classification tree is a very good model selection tool!</p>

<h1 id="spark-sql-and-data-frames">Spark SQL and Data Frames</h1>

<p>This notebook will introduce Spark capabilities to deal with data in a structured way. Basically, everything turns around the concept of <em>Data Frame</em> and using <em>SQL language</em> to query them. We will see how the data frame abstraction, very popular in other data analytics ecosystems (e.g. R and Python/Pandas), it is very powerful when performing exploratory data analysis. In fact, it is very easy to express data queries when used together with the SQL language. Moreover, Spark distributes this column-based data structure transparently, in order to make the querying process as efficient as possible.</p>

<h2 id="getting-the-data-and-creating-the-rdd-8">Getting the data and creating the RDD</h2>

<p>As we did in previous notebooks, we will use the reduced dataset (10 percent) provided for the <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html">KDD Cup 1999</a>, containing nearly half million nework interactions. The file is provided as a Gzip file that we will download locally.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span> <span class="p">(</span><span class="s">"http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data_10_percent.gz"</span><span class="p">,</span> <span class="s">"kddcup.data_10_percent.gz"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_file</span> <span class="o">=</span> <span class="s">"./kddcup.data_10_percent.gz"</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</code></pre></div>    </div>
  </div>

</div>

<h2 id="getting-a-data-frame">Getting a Data Frame</h2>

<p>A Spark <code class="highlighter-rouge">DataFrame</code> is a distributed collection of data organized into named columns. It is conceptually equivalent to a table in a relational database or a data frame in R or Pandas. They can be constructed from a wide array of sources such as a existing RDD in our case.</p>

<p>The entry point into all SQL functionality in Spark is the <code class="highlighter-rouge">SQLContext</code> class. To create a basic instance, all we need is a <code class="highlighter-rouge">SparkContext</code> reference. Since we are running Spark in shell mode (using pySpark) we can use the global context object <code class="highlighter-rouge">sc</code> for this purpose.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SQLContext</span>
<span class="n">sqlContext</span> <span class="o">=</span> <span class="n">SQLContext</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<h3 id="inferring-the-schema">Inferring the schema</h3>

<p>With a <code class="highlighter-rouge">SQLContext</code>, we are ready to create a <code class="highlighter-rouge">DataFrame</code> from our existing RDD. But first we need to tell Spark SQL the schema in our data.</p>

<p>Spark SQL can convert an RDD of <code class="highlighter-rouge">Row</code> objects to a <code class="highlighter-rouge">DataFrame</code>. Rows are constructed by passing a list of key/value pairs as <em>kwargs</em> to the <code class="highlighter-rouge">Row</code> class. The keys define the column names, and the types are inferred by looking at the first row. Therefore, it is important that there is no missing data in the first row of the RDD in order to properly infer the schema.</p>

<p>In our case, we first need to split the comma separated data, and then use the information in KDD’s 1999 task description to obtain the <a href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup.names">column names</a>.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">Row</span>

<span class="n">csv_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">))</span>
<span class="n">row_data</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">Row</span><span class="p">(</span>
    <span class="n">duration</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> 
    <span class="n">protocol_type</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">service</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">flag</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
    <span class="n">src_bytes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
    <span class="n">dst_bytes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Once we have our RDD of <code class="highlighter-rouge">Row</code> we can infer and register the schema.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interactions_df</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>
<span class="n">interactions_df</span><span class="o">.</span><span class="n">registerTempTable</span><span class="p">(</span><span class="s">"interactions"</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>Now we can run SQL queries over our data frame that has been registered as a table.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Select tcp network interactions with more than 1 second duration and no transfer from destination</span>
<span class="n">tcp_interactions</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s">"""
    SELECT duration, dst_bytes FROM interactions WHERE protocol_type = 'tcp' AND duration &gt; 1000 AND dst_bytes = 0
"""</span><span class="p">)</span>
<span class="n">tcp_interactions</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>duration dst_bytes
5057     0        
5059     0        
5051     0        
5056     0        
5051     0        
5039     0        
5062     0        
5041     0        
5056     0        
5064     0        
5043     0        
5061     0        
5049     0        
5061     0        
5048     0        
5047     0        
5044     0        
5063     0        
5068     0        
5062     0        
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>The results of SQL queries are RDDs and support all the normal RDD operations.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Output duration together with dst_bytes</span>
<span class="n">tcp_interactions_out</span> <span class="o">=</span> <span class="n">tcp_interactions</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="s">"Duration: {}, Dest. bytes: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">dst_bytes</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ti_out</span> <span class="ow">in</span> <span class="n">tcp_interactions_out</span><span class="o">.</span><span class="n">collect</span><span class="p">():</span>
  <span class="k">print</span> <span class="n">ti_out</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Duration: 5057, Dest. bytes: 0
Duration: 5059, Dest. bytes: 0
Duration: 5051, Dest. bytes: 0
Duration: 5056, Dest. bytes: 0
Duration: 5051, Dest. bytes: 0
Duration: 5039, Dest. bytes: 0
Duration: 5062, Dest. bytes: 0
Duration: 5041, Dest. bytes: 0
Duration: 5056, Dest. bytes: 0
Duration: 5064, Dest. bytes: 0
Duration: 5043, Dest. bytes: 0
Duration: 5061, Dest. bytes: 0
Duration: 5049, Dest. bytes: 0
Duration: 5061, Dest. bytes: 0
Duration: 5048, Dest. bytes: 0
Duration: 5047, Dest. bytes: 0
Duration: 5044, Dest. bytes: 0
Duration: 5063, Dest. bytes: 0
Duration: 5068, Dest. bytes: 0
Duration: 5062, Dest. bytes: 0
Duration: 5046, Dest. bytes: 0
Duration: 5052, Dest. bytes: 0
Duration: 5044, Dest. bytes: 0
Duration: 5054, Dest. bytes: 0
Duration: 5039, Dest. bytes: 0
Duration: 5058, Dest. bytes: 0
Duration: 5051, Dest. bytes: 0
Duration: 5032, Dest. bytes: 0
Duration: 5063, Dest. bytes: 0
Duration: 5040, Dest. bytes: 0
Duration: 5051, Dest. bytes: 0
Duration: 5066, Dest. bytes: 0
Duration: 5044, Dest. bytes: 0
Duration: 5051, Dest. bytes: 0
Duration: 5036, Dest. bytes: 0
Duration: 5055, Dest. bytes: 0
Duration: 2426, Dest. bytes: 0
Duration: 5047, Dest. bytes: 0
Duration: 5057, Dest. bytes: 0
Duration: 5037, Dest. bytes: 0
Duration: 5057, Dest. bytes: 0
Duration: 5062, Dest. bytes: 0
Duration: 5051, Dest. bytes: 0
Duration: 5051, Dest. bytes: 0
Duration: 5053, Dest. bytes: 0
Duration: 5064, Dest. bytes: 0
Duration: 5044, Dest. bytes: 0
Duration: 5051, Dest. bytes: 0
Duration: 5033, Dest. bytes: 0
Duration: 5066, Dest. bytes: 0
Duration: 5063, Dest. bytes: 0
Duration: 5056, Dest. bytes: 0
Duration: 5042, Dest. bytes: 0
Duration: 5063, Dest. bytes: 0
Duration: 5060, Dest. bytes: 0
Duration: 5056, Dest. bytes: 0
Duration: 5049, Dest. bytes: 0
Duration: 5043, Dest. bytes: 0
Duration: 5039, Dest. bytes: 0
Duration: 5041, Dest. bytes: 0
Duration: 42448, Dest. bytes: 0
Duration: 42088, Dest. bytes: 0
Duration: 41065, Dest. bytes: 0
Duration: 40929, Dest. bytes: 0
Duration: 40806, Dest. bytes: 0
Duration: 40682, Dest. bytes: 0
Duration: 40571, Dest. bytes: 0
Duration: 40448, Dest. bytes: 0
Duration: 40339, Dest. bytes: 0
Duration: 40232, Dest. bytes: 0
Duration: 40121, Dest. bytes: 0
Duration: 36783, Dest. bytes: 0
Duration: 36674, Dest. bytes: 0
Duration: 36570, Dest. bytes: 0
Duration: 36467, Dest. bytes: 0
Duration: 36323, Dest. bytes: 0
Duration: 36204, Dest. bytes: 0
Duration: 32038, Dest. bytes: 0
Duration: 31925, Dest. bytes: 0
Duration: 31809, Dest. bytes: 0
Duration: 31709, Dest. bytes: 0
Duration: 31601, Dest. bytes: 0
Duration: 31501, Dest. bytes: 0
Duration: 31401, Dest. bytes: 0
Duration: 31301, Dest. bytes: 0
Duration: 31194, Dest. bytes: 0
Duration: 31061, Dest. bytes: 0
Duration: 30935, Dest. bytes: 0
Duration: 30835, Dest. bytes: 0
Duration: 30735, Dest. bytes: 0
Duration: 30619, Dest. bytes: 0
Duration: 30518, Dest. bytes: 0
Duration: 30418, Dest. bytes: 0
Duration: 30317, Dest. bytes: 0
Duration: 30217, Dest. bytes: 0
Duration: 30077, Dest. bytes: 0
Duration: 25420, Dest. bytes: 0
Duration: 22921, Dest. bytes: 0
Duration: 22821, Dest. bytes: 0
Duration: 22721, Dest. bytes: 0
Duration: 22616, Dest. bytes: 0
Duration: 22516, Dest. bytes: 0
Duration: 22416, Dest. bytes: 0
Duration: 22316, Dest. bytes: 0
Duration: 22216, Dest. bytes: 0
Duration: 21987, Dest. bytes: 0
Duration: 21887, Dest. bytes: 0
Duration: 21767, Dest. bytes: 0
Duration: 21661, Dest. bytes: 0
Duration: 21561, Dest. bytes: 0
Duration: 21455, Dest. bytes: 0
Duration: 21334, Dest. bytes: 0
Duration: 21223, Dest. bytes: 0
Duration: 21123, Dest. bytes: 0
Duration: 20983, Dest. bytes: 0
Duration: 14682, Dest. bytes: 0
Duration: 14420, Dest. bytes: 0
Duration: 14319, Dest. bytes: 0
Duration: 14198, Dest. bytes: 0
Duration: 14098, Dest. bytes: 0
Duration: 13998, Dest. bytes: 0
Duration: 13898, Dest. bytes: 0
Duration: 13796, Dest. bytes: 0
Duration: 13678, Dest. bytes: 0
Duration: 13578, Dest. bytes: 0
Duration: 13448, Dest. bytes: 0
Duration: 13348, Dest. bytes: 0
Duration: 13241, Dest. bytes: 0
Duration: 13141, Dest. bytes: 0
Duration: 13033, Dest. bytes: 0
Duration: 12933, Dest. bytes: 0
Duration: 12833, Dest. bytes: 0
Duration: 12733, Dest. bytes: 0
Duration: 12001, Dest. bytes: 0
Duration: 5678, Dest. bytes: 0
Duration: 5010, Dest. bytes: 0
Duration: 1298, Dest. bytes: 0
Duration: 1031, Dest. bytes: 0
Duration: 36438, Dest. bytes: 0
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>We can easily have a look at our data frame schema using <code class="highlighter-rouge">printSchema</code>.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">interactions_df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root
 |-- dst_bytes: long (nullable = true)
 |-- duration: long (nullable = true)
 |-- flag: string (nullable = true)
 |-- protocol_type: string (nullable = true)
 |-- service: string (nullable = true)
 |-- src_bytes: long (nullable = true)

</code></pre></div>      </div>
    </div>
  </div>
</div>

<h2 id="queries-as-dataframe-operations">Queries as <code class="highlighter-rouge">DataFrame</code> operations</h2>

<p>Spark <code class="highlighter-rouge">DataFrame</code> provides a domain-specific language for structured data manipulation. This language includes methods we can concatenate in order to do selection, filtering, grouping, etc. For example, let’s say we want to count how many interactions are there for each protocol type. We can proceed as follows.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">interactions_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">"protocol_type"</span><span class="p">,</span> <span class="s">"duration"</span><span class="p">,</span> <span class="s">"dst_bytes"</span><span class="p">)</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s">"protocol_type"</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Query performed in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>protocol_type count 
udp           20354 
tcp           190065
icmp          283602
Query performed in 20.568 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>Now imagine that we want to count how many interactions last more than 1 second, with no data transfer from destination, grouped by protocol type. We can just add to filter calls to the previous.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">interactions_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">"protocol_type"</span><span class="p">,</span> <span class="s">"duration"</span><span class="p">,</span> <span class="s">"dst_bytes"</span><span class="p">)</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">interactions_df</span><span class="o">.</span><span class="n">duration</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">interactions_df</span><span class="o">.</span><span class="n">dst_bytes</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s">"protocol_type"</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Query performed in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>protocol_type count
tcp           139  
Query performed in 16.641 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>We can use this to perform some <a href="http://en.wikipedia.org/wiki/Exploratory_data_analysis">exploratory data analysis</a>. Let’s count how many attack and normal interactions we have. First we need to add the label column to our data.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_label_type</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span><span class="o">!=</span><span class="s">"normal."</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"attack"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"normal"</span>
    
<span class="n">row_labeled_data</span> <span class="o">=</span> <span class="n">csv_data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">Row</span><span class="p">(</span>
    <span class="n">duration</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> 
    <span class="n">protocol_type</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">service</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">flag</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
    <span class="n">src_bytes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
    <span class="n">dst_bytes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
    <span class="n">label</span><span class="o">=</span><span class="n">get_label_type</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">41</span><span class="p">])</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">interactions_labeled_df</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">row_labeled_data</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>

</div>

<p>This time we don’t need to register the schema since we are going to use the OO query interface.</p>

<p>Let’s check the previous actually works by counting attack and normal data in our data frame.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">interactions_labeled_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">"label"</span><span class="p">)</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s">"label"</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Query performed in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>label  count 
attack 396743
normal 97278 
Query performed in 17.325 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>Now we want to count them by label and protocol type, in order to see how important the protocol type is to detect when an interaction is or not an attack.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">interactions_labeled_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">"label"</span><span class="p">,</span> <span class="s">"protocol_type"</span><span class="p">)</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s">"label"</span><span class="p">,</span> <span class="s">"protocol_type"</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Query performed in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>label  protocol_type count 
attack udp           1177  
attack tcp           113252
attack icmp          282314
normal udp           19177 
normal tcp           76813 
normal icmp          1288  
Query performed in 17.253 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>At first sight it seems that <em>udp</em> interactions are in lower proportion between network attacks versus other protocol types.</p>

<p>And we can do much more sophisticated groupings. For example, add to the previous a “split” based on data transfer from target.</p>

<div class="cell code_cell">
  <div class="input_area">
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">interactions_labeled_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">"label"</span><span class="p">,</span> <span class="s">"protocol_type"</span><span class="p">,</span> <span class="s">"dst_bytes"</span><span class="p">)</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s">"label"</span><span class="p">,</span> <span class="s">"protocol_type"</span><span class="p">,</span> <span class="n">interactions_labeled_df</span><span class="o">.</span><span class="n">dst_bytes</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="k">print</span> <span class="s">"Query performed in {} seconds"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>    </div>
  </div>

  <div class="output_wrapper">
    <div class="output_subarea">
      <div class="output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>label  protocol_type (dst_bytes = 0) count 
normal icmp          true            1288  
attack udp           true            1166  
attack udp           false           11    
normal udp           true            3594  
normal udp           false           15583 
attack tcp           true            110583
attack tcp           false           2669  
normal tcp           true            9313  
normal tcp           false           67500 
attack icmp          true            282314
Query performed in 17.284 seconds
</code></pre></div>      </div>
    </div>
  </div>
</div>

<p>We see how relevant is this new split to determine if a network interaction is an attack.</p>

<p>We will stop here, but we can see how powerful this type of queries are in order to explore our data. Actually we can replicate all the splits we saw in previous notebooks, when introducing classification trees, just by selecting, groping, and filtering our dataframe. For a more detailed (but less real-world) list of Spark’s <code class="highlighter-rouge">DataFrame</code> operations and data sources, have a look at the official documentation <a href="https://spark.apache.org/docs/latest/sql-programming-guide.html#dataframe-operations">here</a>.</p>

                <nav class="c-page__nav">
  
    
    <a id="js-page__nav__prev" class="c-page__nav__prev" href="/blog2/11ReadBook/11%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%AD%E6%96%87%E7%89%88">
      〈 <span class="u-margin-right-tiny"></span> 深度学习中文版
    </a>
  

  
    
    <a id="js-page__nav__next" class="c-page__nav__next" href="/blog2/11ReadBook/51%E6%89%80%E8%B0%93%E6%83%85%E5%95%86%E9%AB%98,%E5%B0%B1%E6%98%AF%E4%BC%9A%E8%AF%B4%E8%AF%9D">
      所谓情商高，就是会说话 <span class="u-margin-right-tiny"></span> 〉
    </a>
  
</nav>

            </div>
        </div>
    </main>
</div>

</body>
</html>
